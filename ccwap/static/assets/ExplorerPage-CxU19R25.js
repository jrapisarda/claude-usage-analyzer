import{u as _e,j as e}from"./query-vendor-ChV-W4bE.js";import{r as o,L as Ae}from"./react-vendor-yhu9f3WU.js";import{P as rs}from"./PageLayout-BsEZUeZ3.js";import{M as ue,a as L}from"./MetricCardGrid-B8JwtULn.js";import{C as v}from"./ChartContainer-AoSTwNTM.js";import{D as Re}from"./DataTable-D7g_ybz4.js";import{E as $e}from"./EmptyState-DbNFxFaC.js";import{E as ns}from"./ErrorState-B-JOcFuA.js";import{S as os}from"./SavedViewsBar-Bo7tL8JV.js";import{C as Pe,a as Oe,b as Be,c as Ie}from"./card-Db3E3ZGZ.js";import{m as is,i as ye,j as ve,W as Ne,u as cs,f as u,Y as ds,_ as us,$ as xs,a0 as ps,a1 as ms,B as ne,e as Qe,a as be,c as hs,a2 as gs,a3 as js,X as fs,d as bs,a4 as _s}from"./index-Dqq8KNVg.js";import{S as se}from"./skeleton-BdyjHeQf.js";import{S as xe,a as pe,b as me,c as he,e as ys,f as vs,d as te}from"./select-DG8x8Pg5.js";import{a as Ns}from"./sessions-Vtbm-SOP.js";import{f as ze,C as n,T as N}from"./chartConfig-C_qPkli-.js";import{i as Ge,X as M,Y as E,T as S,j as Fe,A as Ve,b as qe,L as Y,B as ge,e as je,P as Ss,f as ks,C as Cs,d as ws,k as Ts,l as Ds,m as Ks,n as Ls,o as Ms,p as Es}from"./chart-vendor-CnSh9PGG.js";import{C as As}from"./chevron-down-DrKfjUNp.js";import"./table-p2SWBOMv.js";import"./index-DYCzR_nc.js";import"./check-tCoda7YF.js";const Rs=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],$s=is("external-link",Rs);function Ps(t){return _e({queryKey:Ne.query(t),queryFn:()=>ye(`/explorer${ve({metric:t.metric,group_by:t.group_by,split_by:t.split_by,from:t.from,to:t.to,projects:t.projects,models:t.models,branches:t.branches,languages:t.languages})}`),enabled:!!t.metric&&!!t.group_by})}function Os(t){return _e({queryKey:Ne.drilldown(t),queryFn:()=>ye(`/explorer/drilldown${ve({metric:t.metric,group_by:t.group_by,group_value:t.group_value,split_by:t.split_by,split_value:t.split_value,from:t.from,to:t.to,projects:t.projects,models:t.models,branches:t.branches,languages:t.languages,page:t.page??1,limit:t.limit??25})}`),enabled:!!t.metric&&!!t.group_by&&!!t.group_value&&(!t.split_by||!!t.split_value)})}function Bs(t,l){return _e({queryKey:Ne.filters(t,l),queryFn:()=>ye(`/explorer/filters${ve({from:t,to:l})}`)})}const We=[{value:"cost",label:"Cost ($)",group:"Turns"},{value:"input_tokens",label:"Input Tokens",group:"Turns"},{value:"output_tokens",label:"Output Tokens",group:"Turns"},{value:"cache_read_tokens",label:"Cache Read Tokens",group:"Turns"},{value:"cache_write_tokens",label:"Cache Write Tokens",group:"Turns"},{value:"ephemeral_5m_tokens",label:"Ephemeral 5m Tokens",group:"Turns"},{value:"ephemeral_1h_tokens",label:"Ephemeral 1h Tokens",group:"Turns"},{value:"thinking_chars",label:"Thinking Chars",group:"Turns"},{value:"turns_count",label:"Turns Count",group:"Turns"},{value:"loc_written",label:"LOC Written",group:"Tools"},{value:"tool_calls_count",label:"Tool Calls",group:"Tools"},{value:"errors",label:"Errors",group:"Tools"},{value:"lines_added",label:"Lines Added",group:"Tools"},{value:"lines_deleted",label:"Lines Deleted",group:"Tools"},{value:"sessions_count",label:"Sessions",group:"Sessions"},{value:"duration_seconds",label:"Duration (s)",group:"Sessions"}],He=[{value:"date",label:"Date"},{value:"model",label:"Model"},{value:"project",label:"Project"},{value:"branch",label:"Branch"},{value:"language",label:"Language"},{value:"tool_name",label:"Tool Name"},{value:"cc_version",label:"CC Version"},{value:"entry_type",label:"Entry Type"},{value:"is_agent",label:"Agent/User"}],Is=new Set(["date","model","project","branch","cc_version","entry_type","is_agent"]),zs=new Set(["date","model","project","branch","language","tool_name","cc_version","entry_type","is_agent"]),Gs=new Set(["date","project","branch","cc_version","is_agent"]),Fs=new Set(["cost","input_tokens","output_tokens","cache_read_tokens","cache_write_tokens","ephemeral_5m_tokens","ephemeral_1h_tokens","thinking_chars","turns_count"]),Vs=new Set(["loc_written","tool_calls_count","errors","lines_added","lines_deleted"]),qs=20;function Ws(t){return t?Fs.has(t)?Is:Vs.has(t)?zs:Gs:new Set}function ae(t,l){return l==="cost"?be(t):l==="duration_seconds"?hs(t):u(t)}function le(t){return Array.isArray(t)?t.map(l=>String(l).trim()).filter(Boolean):typeof t=="string"?t.split(",").map(l=>l.trim()).filter(Boolean):[]}function fe(t){if(typeof t!="string")return null;const l=t.trim();return l.length>0?l:null}function Ye(t){if(!t)return"N/A";const l=new Date(t);return Number.isNaN(l.getTime())?t:l.toLocaleString()}function re({label:t,options:l,selected:m,onChange:w}){const[A,R]=o.useState(!1),I=o.useCallback(i=>{w(m.includes(i)?m.filter(Q=>Q!==i):[...m,i])},[m,w]);return e.jsxs(gs,{open:A,onOpenChange:R,children:[e.jsx(js,{asChild:!0,children:e.jsxs(ne,{variant:"outline",role:"combobox","aria-expanded":A,className:bs("w-full justify-between text-sm font-normal h-9",m.length>0&&"ring-1 ring-primary/30"),children:[e.jsx("span",{className:"truncate",children:m.length>0?`${t} (${m.length})`:t}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0 ml-1",children:[m.length>0&&e.jsx(fs,{className:"h-3 w-3 text-muted-foreground hover:text-foreground",onClick:i=>{i.stopPropagation(),w([])}}),e.jsx(As,{className:"h-3.5 w-3.5 text-muted-foreground"})]})]})}),e.jsx(_s,{className:"w-64 p-0",align:"start",children:e.jsx(Qe,{className:"max-h-60",children:e.jsx("div",{className:"p-1",children:l.length===0?e.jsx("p",{className:"px-3 py-2 text-xs text-muted-foreground",children:"No options"}):l.map(i=>e.jsxs("label",{className:"flex items-center gap-2 px-3 py-1.5 hover:bg-accent/50 cursor-pointer text-sm rounded-sm",children:[e.jsx("input",{type:"checkbox",checked:m.includes(i.value),onChange:()=>I(i.value),className:"rounded border-border"}),e.jsx("span",{className:"flex-1 truncate",children:i.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i.count})]},i.value))})})})]})}function pt(){const{dateRange:t}=cs(),[l,m]=o.useState(null),[w,A]=o.useState(null),[R,I]=o.useState(null),[i,Q]=o.useState([]),[$,Se]=o.useState([]),[P,ke]=o.useState([]),[O,Ce]=o.useState([]),[b,oe]=o.useState(null),[U,z]=o.useState(1),[Ue,X]=o.useState(!1),[T,D]=o.useState(null),B=Ws(l),x=w&&B.has(w)?w:null,_=R&&B.has(R)&&R!==x?R:null,we={metric:l,group_by:x,split_by:_,from:t.from,to:t.to,projects:i.length?i.join(","):null,models:$.length?$.join(","):null,branches:P.length?P.join(","):null,languages:O.length?O.join(","):null},{data:p,isLoading:Xe,error:Te}=Ps(we),{data:G}=Bs(t.from,t.to),{data:k,isLoading:ie,error:De}=Os({...we,group_value:b?.group??null,split_value:b?.split??null,page:U,limit:qs}),{data:h,isLoading:Ze,error:Ke}=Ns(T??"");o.useEffect(()=>{oe(null),z(1),X(!1),D(null)},[l,x,_,t.from,t.to,i,$,P,O]),o.useEffect(()=>{if(!b||T)return;const s=k?.sessions?.[0]?.session_id??null;s&&D(s)},[b,k?.sessions,T]);const K=x==="date",g=!!_,c=We.find(s=>s.value===l)?.label??l??"",C=o.useCallback((s,a)=>{const r=String(s??"").trim();r&&(oe({group:r,split:a}),z(1),D(null),X(!0))},[]),Je=o.useCallback(s=>{m(fe(s.metric)),A(fe(s.group_by)),I(fe(s.split_by)),Q(le(s.projects)),Se(le(s.models)),ke(le(s.branches)),Ce(le(s.languages)),oe(null),z(1),X(!1),D(null)},[]),es=o.useMemo(()=>({metric:l,group_by:x,split_by:_,projects:i,models:$,branches:P,languages:O}),[l,x,_,i,$,P,O]),Z=o.useCallback((s,a)=>{const r=s?.payload?.date??s?.date;r&&C(String(r),a)},[C]),J=o.useCallback((s,a)=>{const r=s?.payload?.name??s?.name;r&&C(String(r),a)},[C]),{timeData:ee,catData:ce,pieData:Le,treemapData:ss,radarData:de,splitKeys:F,tableRows:Me}=o.useMemo(()=>{if(!p||p.rows.length===0)return{timeData:[],catData:[],pieData:[],treemapData:[],radarData:[],splitKeys:[],tableRows:[]};const s=p.rows,a=p.metadata.splits;if(K&&g){const d=new Map;for(const f of s){d.has(f.group)||d.set(f.group,{date:f.group});const W=d.get(f.group);W[f.split??""]=f.value}return{timeData:ze(Array.from(d.values()).sort((f,W)=>f.date.localeCompare(W.date)),a),catData:[],pieData:[],treemapData:[],radarData:[],splitKeys:a,tableRows:s}}if(K)return{timeData:[...s].map(j=>({date:j.group,value:j.value})).sort((j,f)=>j.date.localeCompare(f.date)),catData:[],pieData:[],treemapData:[],radarData:[],splitKeys:[],tableRows:s};if(g){const d=new Map;for(const y of s){d.has(y.group)||d.set(y.group,{name:y.group,total:0});const H=d.get(y.group);H[y.split??""]=y.value,H.total=(H.total||0)+y.value}const j=ze(Array.from(d.values()).sort((y,H)=>H.total-y.total),a),f=j.slice(0,20),W=j.slice(0,8);return{timeData:[],catData:f,pieData:[],treemapData:[],radarData:W,splitKeys:a,tableRows:s}}const r=[...s].map(d=>({name:d.group,value:d.value})).sort((d,j)=>j.value-d.value),V=r.slice(0,20),q=r.slice(0,10),ls=r.slice(0,30).map((d,j)=>({...d,fill:n[j%n.length]}));return{timeData:[],catData:V,pieData:q,treemapData:ls,radarData:[],splitKeys:[],tableRows:s}},[p,K,g]),ts=o.useMemo(()=>{const s=[{accessorKey:"group",header:x??"Group",cell:({row:a})=>e.jsx(ne,{variant:"link",className:"h-auto p-0 text-left",onClick:()=>C(a.original.group,a.original.split??null),children:a.original.group})}];return g&&s.push({accessorKey:"split",header:_??"Split",cell:({row:a})=>e.jsx("span",{children:a.original.split})}),s.push({accessorKey:"value",header:()=>e.jsx("span",{className:"text-right block",children:c}),cell:({row:a})=>e.jsx("span",{className:"font-mono text-right block",children:ae(a.original.value,l)})}),s},[x,_,g,c,l,C]),as=o.useMemo(()=>[{accessorKey:"session_id",header:"Session",cell:({row:s})=>e.jsx("button",{type:"button",className:"font-mono text-xs text-primary hover:underline",onClick:()=>D(s.original.session_id),children:s.original.session_id})},{id:"open",header:"",cell:({row:s})=>e.jsx(Ae,{to:`/sessions/${s.original.session_id}`,className:"inline-flex items-center text-muted-foreground hover:text-foreground",title:"Open session page",children:e.jsx($s,{className:"h-3.5 w-3.5"})})},{accessorKey:"project",header:"Project",cell:({row:s})=>e.jsx("span",{className:"truncate block max-w-[180px]",children:s.original.project})},{accessorKey:"bucket_value",header:()=>e.jsx("span",{className:"text-right block",children:c}),cell:({row:s})=>e.jsx("span",{className:"font-mono text-right block",children:ae(s.original.bucket_value,l??"turns_count")})},{accessorKey:"errors",header:()=>e.jsx("span",{className:"text-right block",children:"Errors"}),cell:({row:s})=>e.jsx("span",{className:"font-mono text-right block",children:u(s.original.errors)})}],[l,c]);return e.jsxs(e.Fragment,{children:[e.jsxs(rs,{title:"Data Explorer",subtitle:"Query any metric by any dimension",children:[e.jsx(os,{page:"explorer",currentFilters:es,onApply:Je,from:t.from,to:t.to,defaultMetricForAlert:l??"cost"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Metric"}),e.jsxs(xe,{value:l??"__none__",onValueChange:s=>{m(s==="__none__"?null:s),A(null),I(null)},children:[e.jsx(pe,{children:e.jsx(me,{placeholder:"Select metric..."})}),e.jsx(he,{children:["Turns","Tools","Sessions"].map(s=>e.jsxs(ys,{children:[e.jsx(vs,{children:s}),We.filter(a=>a.group===s).map(a=>e.jsx(te,{value:a.value,children:a.label},a.value))]},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Group By"}),e.jsxs(xe,{value:x??"__none__",onValueChange:s=>A(s==="__none__"?null:s),disabled:!l,children:[e.jsx(pe,{children:e.jsx(me,{placeholder:"Select dimension..."})}),e.jsx(he,{children:He.map(s=>e.jsxs(te,{value:s.value,disabled:!B.has(s.value),children:[s.label,B.has(s.value)?"":" (N/A)"]},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Split By (optional)"}),e.jsxs(xe,{value:_??"__none__",onValueChange:s=>I(s==="__none__"?null:s),disabled:!l||!x,children:[e.jsx(pe,{children:e.jsx(me,{placeholder:"None"})}),e.jsxs(he,{children:[e.jsx(te,{value:"__none__",children:"None"}),He.filter(s=>s.value!==x).map(s=>e.jsxs(te,{value:s.value,disabled:!B.has(s.value),children:[s.label,B.has(s.value)?"":" (N/A)"]},s.value))]})]})]})]}),G&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[e.jsx(re,{label:"Projects",options:G.projects,selected:i,onChange:Q}),e.jsx(re,{label:"Models",options:G.models,selected:$,onChange:Se}),e.jsx(re,{label:"Branches",options:G.branches,selected:P,onChange:ke}),e.jsx(re,{label:"Languages",options:G.languages,selected:O,onChange:Ce})]}),!l||!x?e.jsx($e,{message:"Select a metric and dimension to explore"}):Xe?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ue,{skeleton:!0,count:4}),e.jsx(se,{className:"h-80 w-full"})]}):Te?e.jsx(ns,{message:Te.message}):!p||p.rows.length===0?e.jsx($e,{message:"No data for current selection"}):e.jsxs(e.Fragment,{children:[e.jsxs(ue,{className:"mb-6",children:[e.jsx(L,{title:"Total",value:ae(p.metadata.total,l)}),e.jsx(L,{title:"Data Points",value:u(p.metadata.row_count)}),e.jsx(L,{title:"Groups",value:u(p.metadata.groups.length)}),e.jsx(L,{title:g?"Splits":"Avg per Group",value:g?u(p.metadata.splits.length):ae(p.metadata.total/Math.max(p.metadata.groups.length,1),l)})]}),K&&!g&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(v,{title:`${c} Over Time`,height:320,children:e.jsxs(Ge,{data:ee,children:[e.jsx(M,{dataKey:"date",tick:{fontSize:10}}),e.jsx(E,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(Fe,{type:"monotone",dataKey:"value",stroke:n[0],strokeWidth:2,dot:{r:3},name:c,onClick:s=>Z(s,null)})]})}),e.jsx(v,{title:`${c} Over Time`,height:320,children:e.jsxs(Ve,{data:ee,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"explorerGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:n[0],stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:n[0],stopOpacity:0})]})}),e.jsx(M,{dataKey:"date",tick:{fontSize:10}}),e.jsx(E,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(qe,{type:"monotone",dataKey:"value",stroke:n[0],fill:"url(#explorerGrad)",name:c,onClick:s=>Z(s,null)})]})})]}),K&&g&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(v,{title:`${c} by ${_}`,height:320,children:e.jsxs(Ge,{data:ee,children:[e.jsx(M,{dataKey:"date",tick:{fontSize:10}}),e.jsx(E,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(Y,{}),F.map((s,a)=>e.jsx(Fe,{type:"monotone",dataKey:s,stroke:n[a%n.length],strokeWidth:2,dot:!1,name:s,onClick:r=>Z(r,s)},s))]})}),e.jsx(v,{title:`${c} Stacked`,height:320,children:e.jsxs(Ve,{data:ee,children:[e.jsx(M,{dataKey:"date",tick:{fontSize:10}}),e.jsx(E,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(Y,{}),F.map((s,a)=>e.jsx(qe,{type:"monotone",dataKey:s,stackId:"1",stroke:n[a%n.length],fill:n[a%n.length],fillOpacity:.4,name:s,onClick:r=>Z(r,s)},s))]})})]}),!K&&!g&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(v,{title:`${c} by ${x}`,height:320,children:e.jsxs(ge,{data:ce,layout:"vertical",children:[e.jsx(M,{type:"number",tick:{fontSize:10}}),e.jsx(E,{dataKey:"name",type:"category",width:100,tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(je,{dataKey:"value",fill:n[0],radius:[0,4,4,0],name:c,onClick:s=>J(s,null)})]})}),e.jsx(v,{title:`${c} Distribution`,height:320,children:e.jsxs(Ss,{children:[e.jsx(ks,{data:Le,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,label:({name:s,percent:a})=>`${s} ${(a*100).toFixed(0)}%`,labelLine:{strokeWidth:1},onClick:s=>J(s,null),children:Le.map((s,a)=>e.jsx(Cs,{fill:n[a%n.length]},a))}),e.jsx(S,{contentStyle:N})]})}),e.jsxs(Pe,{children:[e.jsxs(Oe,{className:"pb-3 pt-4 px-4",children:[e.jsxs(Be,{className:"text-sm font-medium text-muted-foreground",children:[c," Treemap"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Top 30 by size"})]}),e.jsx(Ie,{className:"px-4 pb-4",children:e.jsx("div",{className:"h-80",children:e.jsx(ws,{width:"100%",height:"100%",children:e.jsx(Ts,{data:ss,dataKey:"value",nameKey:"name",stroke:"var(--color-border)",content:({x:s,y:a,width:r,height:V,name:q,fill:Ee})=>e.jsxs("g",{children:[e.jsx("rect",{x:s,y:a,width:r,height:V,fill:Ee,rx:2,className:"cursor-pointer",onClick:()=>{q&&C(String(q),null)}}),r>=30&&V>=20&&e.jsx("text",{x:s+r/2,y:a+V/2,textAnchor:"middle",dominantBaseline:"middle",fill:"white",fontSize:10,children:String(q??"").slice(0,Math.floor(r/7))})]})})})})})]})]}),!K&&g&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(v,{title:`${c} Grouped`,height:320,children:e.jsxs(ge,{data:ce,children:[e.jsx(M,{dataKey:"name",tick:{fontSize:10},angle:-30,textAnchor:"end",height:60}),e.jsx(E,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(Y,{}),F.map((s,a)=>e.jsx(je,{dataKey:s,fill:n[a%n.length],radius:[4,4,0,0],name:s,onClick:r=>J(r,s)},s))]})}),e.jsx(v,{title:`${c} Stacked`,height:320,children:e.jsxs(ge,{data:ce,children:[e.jsx(M,{dataKey:"name",tick:{fontSize:10},angle:-30,textAnchor:"end",height:60}),e.jsx(E,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(Y,{}),F.map((s,a)=>e.jsx(je,{dataKey:s,stackId:"stack",fill:n[a%n.length],name:s,onClick:r=>J(r,s)},s))]})}),de.length>0&&de.length<=8&&e.jsx(v,{title:`${c} Radar`,height:320,children:e.jsxs(Ds,{data:de,children:[e.jsx(Ks,{}),e.jsx(Ls,{dataKey:"name",tick:{fontSize:10}}),e.jsx(Ms,{tick:{fontSize:9}}),F.map((s,a)=>e.jsx(Es,{dataKey:s,stroke:n[a%n.length],fill:n[a%n.length],fillOpacity:.2,name:s},s)),e.jsx(Y,{}),e.jsx(S,{contentStyle:N})]})})]}),e.jsxs(Pe,{children:[e.jsxs(Oe,{className:"pb-3 pt-4 px-4",children:[e.jsx(Be,{className:"text-sm font-medium text-muted-foreground",children:"Raw Data"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Click a row to drill into sessions (",Me.length," rows, max 100 shown)"]})]}),e.jsx(Ie,{className:"px-4 pb-4",children:e.jsx(Re,{columns:ts,data:Me.slice(0,100),emptyMessage:"No data",onRowClick:s=>C(s.group,s.split??null),getRowClassName:s=>b&&s.group===b.group&&(s.split??null)===(b.split??null)?"bg-accent/40":""})})]})]})]}),e.jsx(ds,{open:Ue,onOpenChange:s=>{X(s),s||D(null)},children:e.jsx(us,{side:"right",className:"w-[95vw] sm:max-w-5xl p-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs(xs,{className:"px-4 py-3 border-b border-border",children:[e.jsx(ps,{className:"text-base",children:"Explorer Drill-down"}),e.jsx(ms,{children:b?`${x}: ${b.group}${g?` | ${_}: ${b.split??"N/A"}`:""}`:"Select a chart bucket or data row"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-0 flex-1 min-h-0",children:[e.jsxs("div",{className:"border-b lg:border-b-0 lg:border-r border-border min-h-0 flex flex-col",children:[e.jsx("div",{className:"px-4 py-3 border-b border-border",children:e.jsxs(ue,{className:"grid-cols-3",children:[e.jsx(L,{title:"Sessions",value:u(k?.pagination.total_count??0)}),e.jsx(L,{title:"Page",value:`${k?.pagination.page??U} / ${Math.max(k?.pagination.total_pages??1,1)}`}),e.jsx(L,{title:"Metric",value:c||"N/A"})]})}),e.jsx("div",{className:"p-3 min-h-0 flex-1 overflow-auto",children:b?De?e.jsx("p",{className:"text-sm text-destructive",children:De.message}):e.jsxs(e.Fragment,{children:[e.jsx(Re,{columns:as,data:k?.sessions??[],isLoading:ie,emptyMessage:"No sessions for this bucket",onRowClick:s=>D(s.session_id),getRowClassName:s=>T===s.session_id?"bg-accent/40":""}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3",children:[e.jsx(ne,{variant:"outline",size:"sm",onClick:()=>z(s=>Math.max(1,s-1)),disabled:ie||U<=1,children:"Previous"}),e.jsx(ne,{variant:"outline",size:"sm",onClick:()=>z(s=>s+1),disabled:ie||!k||U>=(k.pagination.total_pages||1),children:"Next"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a bucket to load sessions."})})]}),e.jsxs("div",{className:"min-h-0 flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Turn and Tool Details"}),T&&e.jsx(Ae,{to:`/sessions/${T}`,className:"text-xs text-primary hover:underline",children:"Open session page"})]}),e.jsx(Qe,{className:"flex-1 p-4",children:T?Ke?e.jsx("p",{className:"text-sm text-destructive",children:Ke.message}):Ze||!h?e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{className:"h-16 w-full"}),e.jsx(se,{className:"h-24 w-full"}),e.jsx(se,{className:"h-24 w-full"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-md border border-border p-3 bg-card",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Session:"})," ",e.jsx("span",{className:"font-mono",children:h.session_id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Branch:"})," ",h.git_branch??"unknown"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Project:"})," ",h.project_display??h.project_path]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Started:"})," ",Ye(h.first_timestamp)]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mt-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Cost"}),e.jsx("span",{className:"font-mono",children:be(h.total_cost)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Turns"}),e.jsx("span",{className:"font-mono",children:u(h.total_turns)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Tools"}),e.jsx("span",{className:"font-mono",children:u(h.total_tool_calls)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Errors"}),e.jsx("span",{className:"font-mono",children:u(h.total_errors)})]})]})]}),h.turns.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No turns found for this session."}):h.turns.map(s=>e.jsxs("div",{className:"rounded-md border border-border p-3 bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs mb-2",children:[e.jsx("span",{className:"font-mono",children:s.uuid}),e.jsx("span",{className:"text-muted-foreground",children:Ye(s.timestamp)})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs mb-2",children:[e.jsx("span",{className:"rounded border border-border px-2 py-0.5",children:s.entry_type}),s.model&&e.jsx("span",{className:"rounded border border-border px-2 py-0.5",children:s.model}),e.jsxs("span",{className:"rounded border border-border px-2 py-0.5",children:["Cost ",be(s.cost)]}),s.stop_reason&&e.jsxs("span",{className:"rounded border border-border px-2 py-0.5",children:["Stop ",s.stop_reason]})]}),s.user_prompt_preview&&e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Prompt: ",s.user_prompt_preview]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs mb-2",children:[e.jsxs("span",{children:["Input ",u(s.input_tokens)]}),e.jsxs("span",{children:["Output ",u(s.output_tokens)]}),e.jsxs("span",{children:["Cache Read ",u(s.cache_read_tokens)]}),e.jsxs("span",{children:["Thinking ",u(s.thinking_chars)]})]}),s.tool_calls.length>0?e.jsx("div",{className:"space-y-1.5",children:s.tool_calls.map((a,r)=>e.jsxs("div",{className:"rounded border border-border/80 px-2 py-1.5 text-xs bg-background/60",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-medium",children:a.tool_name}),e.jsx("span",{className:a.success?"text-green-600":"text-destructive",children:a.success?"success":"failed"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1 text-muted-foreground",children:[a.language&&e.jsx("span",{children:a.language}),a.file_path&&e.jsx("span",{className:"font-mono",children:a.file_path}),e.jsxs("span",{children:["LOC ",u(a.loc_written)]}),e.jsxs("span",{children:["+",u(a.lines_added)," / -",u(a.lines_deleted)]})]}),!a.success&&a.error_category&&e.jsxs("p",{className:"text-destructive mt-1",children:[a.error_category,a.error_message?`: ${a.error_message}`:""]})]},`${s.uuid}-${r}`))}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"No tool calls on this turn."})]},s.uuid))]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a session to inspect replay details."})})]})]})]})})})]})}export{pt as default};
