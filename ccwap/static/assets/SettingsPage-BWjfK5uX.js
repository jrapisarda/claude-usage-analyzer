import{u as z,c as M,b as B,j as e}from"./query-vendor-ChV-W4bE.js";import{r as o}from"./react-vendor-yhu9f3WU.js";import{P as _}from"./PageLayout-CKQ82rM8.js";import{m as R,q as D,h as P,g as w,B as u,R as A,f as L,k as C}from"./index-Bpa7eUOS.js";import{E as O}from"./ErrorState-DjaCiOCU.js";import{C as f,a as N,b,c as v,d as q,e as F}from"./card-BPiuFm8S.js";import{I as h}from"./input-BHG1VFct.js";import{B as S}from"./badge-Cn-RNLir.js";import{S as y}from"./skeleton-DdhmaHDM.js";import{T as V,a as H,b as T,c as g,d as I,e as x}from"./table-Y6f_cB1E.js";import{D as $}from"./download-C-raSRr6.js";import{T as K,P as Q}from"./trash-2-Dg3TYs5J.js";import"./chart-vendor-CnSh9PGG.js";const W=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],J=R("bell",W);const U=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],G=R("save",U);function X(){return z({queryKey:D.all,queryFn:()=>P("/settings")})}function Y(){const l=B();return M({mutationFn:r=>P("/settings/pricing",{method:"PUT",body:JSON.stringify(r)}),onSuccess:()=>l.invalidateQueries({queryKey:D.all})})}function Z(){return M({mutationFn:()=>P("/settings/rebuild",{method:"POST"})})}function ee({pricing:l}){const r=Y(),[n,d]=o.useState(null),[t,m]=o.useState({input:0,output:0,cache_read:0,cache_write:0}),a=o.useCallback((i,s)=>{d(i),m({...s})},[]),j=o.useCallback(()=>{n&&r.mutate({model:n,pricing:t},{onSuccess:()=>d(null)})},[n,t,r]),p=Object.entries(l).sort((i,s)=>i[0].localeCompare(s[0]));return e.jsx("div",{className:"rounded-md border border-border overflow-hidden",children:e.jsxs(V,{children:[e.jsx(H,{children:e.jsxs(T,{children:[e.jsx(g,{children:"Model"}),e.jsx(g,{className:"text-right",children:"Input $/M"}),e.jsx(g,{className:"text-right",children:"Output $/M"}),e.jsx(g,{className:"text-right",children:"Cache Read $/M"}),e.jsx(g,{className:"text-right",children:"Cache Write $/M"}),e.jsx(g,{className:"text-right",children:"Actions"})]})}),e.jsx(I,{children:p.map(([i,s])=>e.jsxs(T,{children:[e.jsx(x,{className:"font-mono text-xs",children:i}),n===i?e.jsxs(e.Fragment,{children:[["input","output","cache_read","cache_write"].map(c=>e.jsx(x,{children:e.jsx(h,{type:"number",step:"0.01",value:t[c],onChange:E=>m(k=>({...k,[c]:parseFloat(E.target.value)||0})),className:"w-full text-right font-mono text-sm"})},c)),e.jsx(x,{className:"text-right",children:e.jsx(u,{variant:"ghost",size:"icon",onClick:j,disabled:r.isPending,children:e.jsx(G,{className:"h-4 w-4"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(x,{className:"font-mono text-right",children:["$",s.input.toFixed(2)]}),e.jsxs(x,{className:"font-mono text-right",children:["$",s.output.toFixed(2)]}),e.jsxs(x,{className:"font-mono text-right",children:["$",s.cache_read.toFixed(2)]}),e.jsxs(x,{className:"font-mono text-right",children:["$",s.cache_write.toFixed(2)]}),e.jsx(x,{className:"text-right",children:e.jsx(u,{variant:"link",size:"sm",onClick:()=>a(i,s),children:"Edit"})})]})]},i))})]})})}function se(){const l=o.useCallback(r=>{window.open(`/api/settings/export?format=${r}`,"_blank")},[]);return e.jsxs(f,{children:[e.jsxs(N,{children:[e.jsx(b,{className:"text-sm",children:"Full Database Export"}),e.jsx(F,{children:"Download a complete export of your database in CSV or JSON format."})]}),e.jsx(v,{children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>l("csv"),children:[e.jsx($,{className:"mr-1.5 h-4 w-4"}),"Export CSV"]}),e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>l("json"),children:[e.jsx($,{className:"mr-1.5 h-4 w-4"}),"Export JSON"]})]})})]})}function te(){const[l,r]=C("ccwap:custom-presets",[]),[n,d]=o.useState(""),[t,m]=o.useState(""),[a,j]=o.useState(""),p=o.useCallback(()=>{!n.trim()||!t||!a||(r(s=>[...s,{label:n.trim(),from:t,to:a}]),d(""),m(""),j(""))},[n,t,a,r]),i=o.useCallback(s=>{r(c=>c.filter((E,k)=>k!==s))},[r]);return e.jsxs(f,{children:[e.jsxs(N,{children:[e.jsx(b,{className:"text-sm",children:"Custom Date Presets"}),e.jsx(F,{children:"Create custom date range presets for quick access in the date picker."})]}),e.jsxs(v,{children:[l.length>0&&e.jsx("div",{className:"space-y-2 mb-4",children:l.map((s,c)=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-md bg-muted/50 border border-border",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:s.label}),e.jsxs("span",{className:"text-muted-foreground ml-2",children:[s.from," to ",s.to]})]}),e.jsx(u,{variant:"ghost",size:"icon",onClick:()=>i(c),className:"text-muted-foreground hover:text-destructive",children:e.jsx(K,{className:"h-4 w-4"})})]},c))}),l.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground italic mb-4",children:"No custom presets defined."}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[140px]",children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Label"}),e.jsx(h,{type:"text",value:n,onChange:s=>d(s.target.value),placeholder:"e.g. Q1 2026"})]}),e.jsxs("div",{className:"min-w-[140px]",children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"From"}),e.jsx(h,{type:"date",value:t,onChange:s=>m(s.target.value)})]}),e.jsxs("div",{className:"min-w-[140px]",children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"To"}),e.jsx(h,{type:"date",value:a,onChange:s=>j(s.target.value)})]}),e.jsxs(u,{onClick:p,disabled:!n.trim()||!t||!a,size:"sm",children:[e.jsx(Q,{className:"mr-1 h-4 w-4"}),"Add"]})]})]})]})}function ae(){const[l,r]=C("ccwap:alert-daily-cost",0),[n,d]=C("ccwap:alert-weekly-cost",0),[t,m]=C("ccwap:alert-error-rate",0);return e.jsxs(f,{children:[e.jsxs(N,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(b,{className:"text-sm",children:"Notification Thresholds"})]}),e.jsx(F,{children:"Set alert thresholds for cost and error monitoring. A value of 0 means no alert."})]}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm text-muted-foreground w-48",children:"Daily Cost Alert ($)"}),e.jsx(h,{type:"number",min:"0",step:"0.01",value:l,onChange:a=>r(parseFloat(a.target.value)||0),className:"w-32 text-right font-mono"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm text-muted-foreground w-48",children:"Weekly Cost Alert ($)"}),e.jsx(h,{type:"number",min:"0",step:"0.01",value:n,onChange:a=>d(parseFloat(a.target.value)||0),className:"w-32 text-right font-mono"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm text-muted-foreground w-48",children:"Error Rate Alert (%)"}),e.jsx(h,{type:"number",min:"0",max:"100",step:"0.1",value:t,onChange:a=>m(parseFloat(a.target.value)||0),className:"w-32 text-right font-mono"})]})]})})]})}function ge(){const{data:l,isLoading:r,error:n,refetch:d}=X(),t=Z();if(r)return e.jsxs(_,{title:"Settings",subtitle:"Pricing, display preferences, and data management",children:[e.jsx(y,{className:"h-4 w-32 mb-6"}),e.jsx(y,{className:"h-64 w-full mb-6"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(y,{className:"h-48 w-full"}),e.jsx(y,{className:"h-48 w-full"})]})]});if(n)return e.jsx(O,{message:n.message,onRetry:()=>d()});if(!l)return null;const{pricing:m,etl_status:a,db_stats:j,version:p}=l,i=s=>s<1024?`${s} B`:s<1048576?`${(s/1024).toFixed(1)} KB`:`${(s/1048576).toFixed(1)} MB`;return e.jsxs(_,{title:"Settings",subtitle:"Pricing, display preferences, and data management",children:[p&&e.jsxs(S,{variant:"secondary",className:"mb-6",children:["CCWAP v",p]}),e.jsxs(f,{className:"mb-6",children:[e.jsx(N,{children:e.jsx(b,{className:"text-sm",children:"Model Pricing (per million tokens)"})}),e.jsx(v,{children:e.jsx(ee,{pricing:m})})]}),e.jsx(w,{className:"my-6"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(f,{children:[e.jsx(N,{children:e.jsx(b,{className:"text-sm",children:"ETL Status"})}),e.jsx(v,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Files Processed"}),e.jsxs("span",{className:"font-mono",children:[a.files_processed," / ",a.files_total]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Run"}),e.jsx("span",{className:"font-mono",children:a.last_run||"Never"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Database Size"}),e.jsx("span",{className:"font-mono",children:i(a.database_size_bytes)})]})]})}),e.jsxs(q,{className:"flex-col items-start gap-2",children:[e.jsxs(u,{variant:"outline",size:"sm",onClick:()=>t.mutate(),disabled:t.isPending,children:[e.jsx(A,{className:`mr-1.5 h-4 w-4 ${t.isPending?"animate-spin":""}`}),t.isPending?"Rebuilding...":"Rebuild Database"]}),t.isSuccess&&e.jsx(S,{variant:"secondary",className:"text-green-500",children:"Rebuild complete"}),t.isError&&e.jsx(S,{variant:"destructive",children:"Rebuild failed"})]})]}),e.jsxs(f,{children:[e.jsx(N,{children:e.jsx(b,{className:"text-sm",children:"Database Statistics"})}),e.jsx(v,{children:e.jsx("div",{className:"space-y-2 text-sm",children:Object.entries(j).map(([s,c])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground capitalize",children:s.replace(/_/g," ")}),e.jsx("span",{className:"font-mono",children:L(c)})]},s))})})]})]}),e.jsx(w,{className:"my-6"}),e.jsx("div",{className:"mb-6",children:e.jsx(se,{})}),e.jsx(w,{className:"my-6"}),e.jsx("div",{className:"mb-6",children:e.jsx(te,{})}),e.jsx(w,{className:"my-6"}),e.jsx("div",{className:"mb-6",children:e.jsx(ae,{})})]})}export{ge as default};
