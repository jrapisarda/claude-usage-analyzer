import{j as t}from"./query-vendor-ChV-W4bE.js";import{r as C}from"./react-vendor-yhu9f3WU.js";import{P as f}from"./PageLayout-DpNVgws2.js";import{M as b,a as o}from"./MetricCardGrid-CkxpAq0G.js";import{C as i}from"./ChartContainer-BU7sgYBD.js";import{E}from"./ErrorState-xs03gdYo.js";import{u as N,f as l,b as S,a as h}from"./index-DCX10x8R.js";import{u as k}from"./advanced-CRB9HaGg.js";import{T as n,C as c}from"./chartConfig-CHOlO3Nn.js";import{B as p,X as m,Y as d,T as x,e as y,S as T,Z as v,q as R}from"./chart-vendor-CnSh9PGG.js";import"./skeleton-B0hp-ihd.js";function W(){const{dateRange:g}=N(),{data:e,isLoading:u,error:j}=k(g),_=C.useMemo(()=>{const r=e?.heatmap??[],a=Math.max(...r.map(s=>s.errors),1);return r.slice(0,40).map(s=>({...s,intensity:s.errors/a}))},[e?.heatmap]);return j?t.jsx(E,{message:j.message}):u||!e?t.jsx(f,{title:"Reliability",subtitle:"What breaks, where, and at what cost",children:t.jsx(b,{skeleton:!0,count:4,className:"mb-6"})}):t.jsxs(f,{title:"Reliability",subtitle:"What breaks, where, and at what cost",children:[t.jsxs(b,{className:"mb-6",children:[t.jsx(o,{title:"Tool Calls",value:l(e.summary.total_tool_calls)}),t.jsx(o,{title:"Errors",value:l(e.summary.total_errors)}),t.jsx(o,{title:"Error Rate",value:S(e.summary.error_rate)}),t.jsx(o,{title:"Error Cost",value:h(e.summary.error_cost)})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[t.jsx(i,{title:"Pareto: Failing Tools",height:280,isEmpty:e.pareto_tools.length===0,children:t.jsxs(p,{data:e.pareto_tools,children:[t.jsx(m,{dataKey:"label",tick:{fontSize:10},angle:-20,textAnchor:"end",height:60}),t.jsx(d,{tick:{fontSize:10}}),t.jsx(x,{contentStyle:n}),t.jsx(y,{dataKey:"count",fill:c[0],name:"Errors"})]})}),t.jsx(i,{title:"Pareto: Error Categories by Cost",height:280,isEmpty:e.heatmap.length===0,children:t.jsxs(T,{children:[t.jsx(m,{type:"number",dataKey:"errors",name:"Errors",tick:{fontSize:10}}),t.jsx(d,{type:"number",dataKey:"error_cost",name:"Error Cost",tick:{fontSize:10}}),t.jsx(v,{type:"number",dataKey:"errors",range:[30,220]}),t.jsx(x,{contentStyle:n,formatter:(r,a)=>[a==="error_cost"?h(r??0):l(r??0),a]}),t.jsx(R,{data:e.heatmap.slice(0,80),fill:c[2]})]})})]}),t.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[t.jsx(i,{title:"Top Failing Workflows",height:280,isEmpty:e.top_failing_workflows.length===0,children:t.jsxs(p,{data:e.top_failing_workflows.slice(0,12),layout:"vertical",children:[t.jsx(m,{type:"number",tick:{fontSize:10}}),t.jsx(d,{type:"category",dataKey:"workflow",width:140,tick:{fontSize:10}}),t.jsx(x,{contentStyle:n}),t.jsx(y,{dataKey:"failures",fill:c[1]})]})}),t.jsx(i,{title:"Failure Distribution by Branch",height:280,isEmpty:e.by_branch.length===0,children:t.jsxs(p,{data:e.by_branch,children:[t.jsx(m,{dataKey:"branch",tick:{fontSize:10},angle:-20,textAnchor:"end",height:60}),t.jsx(d,{tick:{fontSize:10}}),t.jsx(x,{contentStyle:n}),t.jsx(y,{dataKey:"errors",fill:c[3],name:"Errors"})]})})]}),t.jsxs("div",{className:"rounded-md border border-border overflow-hidden",children:[t.jsx("div",{className:"px-4 py-2 border-b border-border text-sm font-medium text-muted-foreground",children:"Reliability Heatmap (Tool x Error Category)"}),t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-border",children:[t.jsx("th",{className:"px-3 py-2 text-left",children:"Tool"}),t.jsx("th",{className:"px-3 py-2 text-left",children:"Category"}),t.jsx("th",{className:"px-3 py-2 text-right",children:"Errors"}),t.jsx("th",{className:"px-3 py-2 text-right",children:"Cost"})]})}),t.jsx("tbody",{children:_.map((r,a)=>t.jsxs("tr",{style:{backgroundColor:`rgba(239, 68, 68, ${Math.min(.08+r.intensity*.35,.45)})`},className:"border-b border-border/60",children:[t.jsx("td",{className:"px-3 py-2 font-mono text-xs",children:r.tool_name}),t.jsx("td",{className:"px-3 py-2",children:r.error_category}),t.jsx("td",{className:"px-3 py-2 text-right font-mono",children:l(r.errors)}),t.jsx("td",{className:"px-3 py-2 text-right font-mono",children:h(r.error_cost)})]},`${r.tool_name}-${r.error_category}-${a}`))})]})})]})]})}export{W as default};
