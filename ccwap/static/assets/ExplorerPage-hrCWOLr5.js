import{j as e}from"./query-vendor-ChV-W4bE.js";import{r as o,L as Le}from"./react-vendor-yhu9f3WU.js";import{P as ss}from"./PageLayout-DfUqXGNp.js";import{M as ue,a as E}from"./MetricCardGrid-DsyWLa6x.js";import{C as y}from"./ChartContainer-LUT-0W_K.js";import{D as Ee}from"./DataTable--0w-l0AJ.js";import{E as Me}from"./EmptyState-YNq6IBuM.js";import{E as as}from"./ErrorState-Cnbe0SU1.js";import{S as ts}from"./SavedViewsBar-CbPf9EWo.js";import{C as Ae,a as Ke,b as Re,c as Pe}from"./card-ClagOsYo.js";import{m as ls,u as rs,f as u,y as ns,z as os,A as is,D as cs,E as ds,B as ne,e as We,a as be,c as us,P as ms,F as xs,X as ps,d as hs,G as gs}from"./index-DJRpnyjL.js";import{S as se}from"./skeleton-DoFMmdLy.js";import{S as me,a as xe,b as pe,c as he,e as js,f as fs,d as ae}from"./select-DBirhmOi.js";import{u as bs,a as vs,b as _s}from"./explorer-B_ZinCHy.js";import{a as ys}from"./sessions-DQYgJfpS.js";import{f as Oe,C as n,T as N}from"./chartConfig-C_qPkli-.js";import{i as $e,X as M,Y as A,T as S,j as Be,A as Ie,b as ze,L as U,B as ge,e as je,P as Ns,f as Ss,C as ks,d as Cs,k as ws,l as Ds,m as Ts,n as Ls,o as Es,p as Ms}from"./chart-vendor-Dwd1Lo9s.js";import{C as As}from"./chevron-down-DCpKWUKo.js";import"./table-BOi6on67.js";import"./index-37RbL-a3.js";import"./check-68rC0p17.js";const Ks=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],Rs=ls("external-link",Ks),Ge=[{value:"cost",label:"Cost ($)",group:"Turns"},{value:"input_tokens",label:"Input Tokens",group:"Turns"},{value:"output_tokens",label:"Output Tokens",group:"Turns"},{value:"cache_read_tokens",label:"Cache Read Tokens",group:"Turns"},{value:"cache_write_tokens",label:"Cache Write Tokens",group:"Turns"},{value:"ephemeral_5m_tokens",label:"Ephemeral 5m Tokens",group:"Turns"},{value:"ephemeral_1h_tokens",label:"Ephemeral 1h Tokens",group:"Turns"},{value:"thinking_chars",label:"Thinking Chars",group:"Turns"},{value:"turns_count",label:"Turns Count",group:"Turns"},{value:"loc_written",label:"LOC Written",group:"Tools"},{value:"tool_calls_count",label:"Tool Calls",group:"Tools"},{value:"errors",label:"Errors",group:"Tools"},{value:"lines_added",label:"Lines Added",group:"Tools"},{value:"lines_deleted",label:"Lines Deleted",group:"Tools"},{value:"sessions_count",label:"Sessions",group:"Sessions"},{value:"duration_seconds",label:"Duration (s)",group:"Sessions"}],Ve=[{value:"date",label:"Date"},{value:"model",label:"Model"},{value:"project",label:"Project"},{value:"branch",label:"Branch"},{value:"language",label:"Language"},{value:"tool_name",label:"Tool Name"},{value:"cc_version",label:"CC Version"},{value:"entry_type",label:"Entry Type"},{value:"is_agent",label:"Agent/User"}],Ps=new Set(["date","model","project","branch","cc_version","entry_type","is_agent"]),Os=new Set(["date","model","project","branch","language","tool_name","cc_version","entry_type","is_agent"]),$s=new Set(["date","project","branch","cc_version","is_agent"]),Bs=new Set(["cost","input_tokens","output_tokens","cache_read_tokens","cache_write_tokens","ephemeral_5m_tokens","ephemeral_1h_tokens","thinking_chars","turns_count"]),Is=new Set(["loc_written","tool_calls_count","errors","lines_added","lines_deleted"]),zs=20;function Gs(l){return l?Bs.has(l)?Ps:Is.has(l)?Os:$s:new Set}function te(l,t){return t==="cost"?be(l):t==="duration_seconds"?us(l):u(l)}function le(l){return Array.isArray(l)?l.map(t=>String(t).trim()).filter(Boolean):typeof l=="string"?l.split(",").map(t=>t.trim()).filter(Boolean):[]}function fe(l){if(typeof l!="string")return null;const t=l.trim();return t.length>0?t:null}function Fe(l){if(!l)return"N/A";const t=new Date(l);return Number.isNaN(t.getTime())?l:t.toLocaleString()}function re({label:l,options:t,selected:p,onChange:w}){const[K,R]=o.useState(!1),I=o.useCallback(i=>{w(p.includes(i)?p.filter(X=>X!==i):[...p,i])},[p,w]);return e.jsxs(ms,{open:K,onOpenChange:R,children:[e.jsx(xs,{asChild:!0,children:e.jsxs(ne,{variant:"outline",role:"combobox","aria-expanded":K,className:hs("w-full justify-between text-sm font-normal h-9",p.length>0&&"ring-1 ring-primary/30"),children:[e.jsx("span",{className:"truncate",children:p.length>0?`${l} (${p.length})`:l}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0 ml-1",children:[p.length>0&&e.jsx(ps,{className:"h-3 w-3 text-muted-foreground hover:text-foreground",onClick:i=>{i.stopPropagation(),w([])}}),e.jsx(As,{className:"h-3.5 w-3.5 text-muted-foreground"})]})]})}),e.jsx(gs,{className:"w-64 p-0",align:"start",children:e.jsx(We,{className:"max-h-60",children:e.jsx("div",{className:"p-1",children:t.length===0?e.jsx("p",{className:"px-3 py-2 text-xs text-muted-foreground",children:"No options"}):t.map(i=>e.jsxs("label",{className:"flex items-center gap-2 px-3 py-1.5 hover:bg-accent/50 cursor-pointer text-sm rounded-sm",children:[e.jsx("input",{type:"checkbox",checked:p.includes(i.value),onChange:()=>I(i.value),className:"rounded border-border"}),e.jsx("span",{className:"flex-1 truncate",children:i.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:i.count})]},i.value))})})})]})}function da(){const{dateRange:l}=rs(),[t,p]=o.useState(null),[w,K]=o.useState(null),[R,I]=o.useState(null),[i,X]=o.useState([]),[P,ve]=o.useState([]),[O,_e]=o.useState([]),[$,ye]=o.useState([]),[b,oe]=o.useState(null),[Y,z]=o.useState(1),[He,Z]=o.useState(!1),[D,T]=o.useState(null),B=Gs(t),m=w&&B.has(w)?w:null,v=R&&B.has(R)&&R!==m?R:null,Ne={metric:t,group_by:m,split_by:v,from:l.from,to:l.to,projects:i.length?i.join(","):null,models:P.length?P.join(","):null,branches:O.length?O.join(","):null,languages:$.length?$.join(","):null},{data:x,isLoading:qe,error:Se}=bs(Ne),{data:G}=vs(l.from,l.to),{data:k,isLoading:ie,error:ke}=_s({...Ne,group_value:b?.group??null,split_value:b?.split??null,page:Y,limit:zs}),{data:h,isLoading:Ue,error:Ce}=ys(D??"");o.useEffect(()=>{oe(null),z(1),Z(!1),T(null)},[t,m,v,l.from,l.to,i,P,O,$]),o.useEffect(()=>{if(!b||D)return;const s=k?.sessions?.[0]?.session_id??null;s&&T(s)},[b,k?.sessions,D]);const L=m==="date",g=!!v,c=Ge.find(s=>s.value===t)?.label??t??"",C=o.useCallback((s,a)=>{const r=String(s??"").trim();r&&(oe({group:r,split:a}),z(1),T(null),Z(!0))},[]),Xe=o.useCallback(s=>{p(fe(s.metric)),K(fe(s.group_by)),I(fe(s.split_by)),X(le(s.projects)),ve(le(s.models)),_e(le(s.branches)),ye(le(s.languages)),oe(null),z(1),Z(!1),T(null)},[]),Ye=o.useMemo(()=>({metric:t,group_by:m,split_by:v,projects:i,models:P,branches:O,languages:$}),[t,m,v,i,P,O,$]),Q=o.useCallback((s,a)=>{const r=s?.payload?.date??s?.date;r&&C(String(r),a)},[C]),J=o.useCallback((s,a)=>{const r=s?.payload?.name??s?.name;r&&C(String(r),a)},[C]),{timeData:ee,catData:ce,pieData:we,treemapData:Ze,radarData:de,splitKeys:V,tableRows:De}=o.useMemo(()=>{if(!x||x.rows.length===0)return{timeData:[],catData:[],pieData:[],treemapData:[],radarData:[],splitKeys:[],tableRows:[]};const s=x.rows,a=x.metadata.splits;if(L&&g){const d=new Map;for(const f of s){d.has(f.group)||d.set(f.group,{date:f.group});const H=d.get(f.group);H[f.split??""]=f.value}return{timeData:Oe(Array.from(d.values()).sort((f,H)=>f.date.localeCompare(H.date)),a),catData:[],pieData:[],treemapData:[],radarData:[],splitKeys:a,tableRows:s}}if(L)return{timeData:[...s].map(j=>({date:j.group,value:j.value})).sort((j,f)=>j.date.localeCompare(f.date)),catData:[],pieData:[],treemapData:[],radarData:[],splitKeys:[],tableRows:s};if(g){const d=new Map;for(const _ of s){d.has(_.group)||d.set(_.group,{name:_.group,total:0});const q=d.get(_.group);q[_.split??""]=_.value,q.total=(q.total||0)+_.value}const j=Oe(Array.from(d.values()).sort((_,q)=>q.total-_.total),a),f=j.slice(0,20),H=j.slice(0,8);return{timeData:[],catData:f,pieData:[],treemapData:[],radarData:H,splitKeys:a,tableRows:s}}const r=[...s].map(d=>({name:d.group,value:d.value})).sort((d,j)=>j.value-d.value),F=r.slice(0,20),W=r.slice(0,10),es=r.slice(0,30).map((d,j)=>({...d,fill:n[j%n.length]}));return{timeData:[],catData:F,pieData:W,treemapData:es,radarData:[],splitKeys:[],tableRows:s}},[x,L,g]),Qe=o.useMemo(()=>{const s=[{accessorKey:"group",header:m??"Group",cell:({row:a})=>e.jsx(ne,{variant:"link",className:"h-auto p-0 text-left",onClick:()=>C(a.original.group,a.original.split??null),children:a.original.group})}];return g&&s.push({accessorKey:"split",header:v??"Split",cell:({row:a})=>e.jsx("span",{children:a.original.split})}),s.push({accessorKey:"value",header:()=>e.jsx("span",{className:"text-right block",children:c}),cell:({row:a})=>e.jsx("span",{className:"font-mono text-right block",children:te(a.original.value,t)})}),s},[m,v,g,c,t,C]),Je=o.useMemo(()=>[{accessorKey:"session_id",header:"Session",cell:({row:s})=>e.jsx("button",{type:"button",className:"font-mono text-xs text-primary hover:underline",onClick:()=>T(s.original.session_id),children:s.original.session_id})},{id:"open",header:"",cell:({row:s})=>e.jsx(Le,{to:`/sessions/${s.original.session_id}`,className:"inline-flex items-center text-muted-foreground hover:text-foreground",title:"Open session page",children:e.jsx(Rs,{className:"h-3.5 w-3.5"})})},{accessorKey:"project",header:"Project",cell:({row:s})=>e.jsx("span",{className:"truncate block max-w-[180px]",children:s.original.project})},{accessorKey:"bucket_value",header:()=>e.jsx("span",{className:"text-right block",children:c}),cell:({row:s})=>e.jsx("span",{className:"font-mono text-right block",children:te(s.original.bucket_value,t??"turns_count")})},{accessorKey:"errors",header:()=>e.jsx("span",{className:"text-right block",children:"Errors"}),cell:({row:s})=>e.jsx("span",{className:"font-mono text-right block",children:u(s.original.errors)})}],[t,c]);return e.jsxs(e.Fragment,{children:[e.jsxs(ss,{title:"Data Explorer",subtitle:"Query any metric by any dimension",children:[e.jsx(ts,{page:"explorer",currentFilters:Ye,onApply:Xe,from:l.from,to:l.to,defaultMetricForAlert:t??"cost"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Metric"}),e.jsxs(me,{value:t??"__none__",onValueChange:s=>{p(s==="__none__"?null:s),K(null),I(null)},children:[e.jsx(xe,{children:e.jsx(pe,{placeholder:"Select metric..."})}),e.jsx(he,{children:["Turns","Tools","Sessions"].map(s=>e.jsxs(js,{children:[e.jsx(fs,{children:s}),Ge.filter(a=>a.group===s).map(a=>e.jsx(ae,{value:a.value,children:a.label},a.value))]},s))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Group By"}),e.jsxs(me,{value:m??"__none__",onValueChange:s=>K(s==="__none__"?null:s),disabled:!t,children:[e.jsx(xe,{children:e.jsx(pe,{placeholder:"Select dimension..."})}),e.jsx(he,{children:Ve.map(s=>e.jsxs(ae,{value:s.value,disabled:!B.has(s.value),children:[s.label,B.has(s.value)?"":" (N/A)"]},s.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Split By (optional)"}),e.jsxs(me,{value:v??"__none__",onValueChange:s=>I(s==="__none__"?null:s),disabled:!t||!m,children:[e.jsx(xe,{children:e.jsx(pe,{placeholder:"None"})}),e.jsxs(he,{children:[e.jsx(ae,{value:"__none__",children:"None"}),Ve.filter(s=>s.value!==m).map(s=>e.jsxs(ae,{value:s.value,disabled:!B.has(s.value),children:[s.label,B.has(s.value)?"":" (N/A)"]},s.value))]})]})]})]}),G&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[e.jsx(re,{label:"Projects",options:G.projects,selected:i,onChange:X}),e.jsx(re,{label:"Models",options:G.models,selected:P,onChange:ve}),e.jsx(re,{label:"Branches",options:G.branches,selected:O,onChange:_e}),e.jsx(re,{label:"Languages",options:G.languages,selected:$,onChange:ye})]}),!t||!m?e.jsx(Me,{message:"Select a metric and dimension to explore"}):qe?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ue,{skeleton:!0,count:4}),e.jsx(se,{className:"h-80 w-full"})]}):Se?e.jsx(as,{message:Se.message}):!x||x.rows.length===0?e.jsx(Me,{message:"No data for current selection"}):e.jsxs(e.Fragment,{children:[e.jsxs(ue,{className:"mb-6",children:[e.jsx(E,{title:"Total",value:te(x.metadata.total,t)}),e.jsx(E,{title:"Data Points",value:u(x.metadata.row_count)}),e.jsx(E,{title:"Groups",value:u(x.metadata.groups.length)}),e.jsx(E,{title:g?"Splits":"Avg per Group",value:g?u(x.metadata.splits.length):te(x.metadata.total/Math.max(x.metadata.groups.length,1),t)})]}),L&&!g&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(y,{title:`${c} Over Time`,height:320,children:e.jsxs($e,{data:ee,children:[e.jsx(M,{dataKey:"date",tick:{fontSize:10}}),e.jsx(A,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(Be,{type:"monotone",dataKey:"value",stroke:n[0],strokeWidth:2,dot:{r:3},name:c,onClick:s=>Q(s,null)})]})}),e.jsx(y,{title:`${c} Over Time`,height:320,children:e.jsxs(Ie,{data:ee,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"explorerGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:n[0],stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:n[0],stopOpacity:0})]})}),e.jsx(M,{dataKey:"date",tick:{fontSize:10}}),e.jsx(A,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(ze,{type:"monotone",dataKey:"value",stroke:n[0],fill:"url(#explorerGrad)",name:c,onClick:s=>Q(s,null)})]})})]}),L&&g&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(y,{title:`${c} by ${v}`,height:320,children:e.jsxs($e,{data:ee,children:[e.jsx(M,{dataKey:"date",tick:{fontSize:10}}),e.jsx(A,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(U,{}),V.map((s,a)=>e.jsx(Be,{type:"monotone",dataKey:s,stroke:n[a%n.length],strokeWidth:2,dot:!1,name:s,onClick:r=>Q(r,s)},s))]})}),e.jsx(y,{title:`${c} Stacked`,height:320,children:e.jsxs(Ie,{data:ee,children:[e.jsx(M,{dataKey:"date",tick:{fontSize:10}}),e.jsx(A,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(U,{}),V.map((s,a)=>e.jsx(ze,{type:"monotone",dataKey:s,stackId:"1",stroke:n[a%n.length],fill:n[a%n.length],fillOpacity:.4,name:s,onClick:r=>Q(r,s)},s))]})})]}),!L&&!g&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(y,{title:`${c} by ${m}`,height:320,children:e.jsxs(ge,{data:ce,layout:"vertical",children:[e.jsx(M,{type:"number",tick:{fontSize:10}}),e.jsx(A,{dataKey:"name",type:"category",width:100,tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(je,{dataKey:"value",fill:n[0],radius:[0,4,4,0],name:c,onClick:s=>J(s,null)})]})}),e.jsx(y,{title:`${c} Distribution`,height:320,children:e.jsxs(Ns,{children:[e.jsx(Ss,{data:we,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,label:({name:s,percent:a})=>`${s} ${(a*100).toFixed(0)}%`,labelLine:{strokeWidth:1},onClick:s=>J(s,null),children:we.map((s,a)=>e.jsx(ks,{fill:n[a%n.length]},a))}),e.jsx(S,{contentStyle:N})]})}),e.jsxs(Ae,{children:[e.jsxs(Ke,{className:"pb-3 pt-4 px-4",children:[e.jsxs(Re,{className:"text-sm font-medium text-muted-foreground",children:[c," Treemap"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Top 30 by size"})]}),e.jsx(Pe,{className:"px-4 pb-4",children:e.jsx("div",{className:"h-80",children:e.jsx(Cs,{width:"100%",height:"100%",children:e.jsx(ws,{data:Ze,dataKey:"value",nameKey:"name",stroke:"var(--color-border)",content:({x:s,y:a,width:r,height:F,name:W,fill:Te})=>e.jsxs("g",{children:[e.jsx("rect",{x:s,y:a,width:r,height:F,fill:Te,rx:2,className:"cursor-pointer",onClick:()=>{W&&C(String(W),null)}}),r>=30&&F>=20&&e.jsx("text",{x:s+r/2,y:a+F/2,textAnchor:"middle",dominantBaseline:"middle",fill:"white",fontSize:10,children:String(W??"").slice(0,Math.floor(r/7))})]})})})})})]})]}),!L&&g&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(y,{title:`${c} Grouped`,height:320,children:e.jsxs(ge,{data:ce,children:[e.jsx(M,{dataKey:"name",tick:{fontSize:10},angle:-30,textAnchor:"end",height:60}),e.jsx(A,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(U,{}),V.map((s,a)=>e.jsx(je,{dataKey:s,fill:n[a%n.length],radius:[4,4,0,0],name:s,onClick:r=>J(r,s)},s))]})}),e.jsx(y,{title:`${c} Stacked`,height:320,children:e.jsxs(ge,{data:ce,children:[e.jsx(M,{dataKey:"name",tick:{fontSize:10},angle:-30,textAnchor:"end",height:60}),e.jsx(A,{tick:{fontSize:10}}),e.jsx(S,{contentStyle:N}),e.jsx(U,{}),V.map((s,a)=>e.jsx(je,{dataKey:s,stackId:"stack",fill:n[a%n.length],name:s,onClick:r=>J(r,s)},s))]})}),de.length>0&&de.length<=8&&e.jsx(y,{title:`${c} Radar`,height:320,children:e.jsxs(Ds,{data:de,children:[e.jsx(Ts,{}),e.jsx(Ls,{dataKey:"name",tick:{fontSize:10}}),e.jsx(Es,{tick:{fontSize:9}}),V.map((s,a)=>e.jsx(Ms,{dataKey:s,stroke:n[a%n.length],fill:n[a%n.length],fillOpacity:.2,name:s},s)),e.jsx(U,{}),e.jsx(S,{contentStyle:N})]})})]}),e.jsxs(Ae,{children:[e.jsxs(Ke,{className:"pb-3 pt-4 px-4",children:[e.jsx(Re,{className:"text-sm font-medium text-muted-foreground",children:"Raw Data"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Click a row to drill into sessions (",De.length," rows, max 100 shown)"]})]}),e.jsx(Pe,{className:"px-4 pb-4",children:e.jsx(Ee,{columns:Qe,data:De.slice(0,100),emptyMessage:"No data",onRowClick:s=>C(s.group,s.split??null),getRowClassName:s=>b&&s.group===b.group&&(s.split??null)===(b.split??null)?"bg-accent/40":""})})]})]})]}),e.jsx(ns,{open:He,onOpenChange:s=>{Z(s),s||T(null)},children:e.jsx(os,{side:"right",className:"w-[95vw] sm:max-w-5xl p-0",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs(is,{className:"px-4 py-3 border-b border-border",children:[e.jsx(cs,{className:"text-base",children:"Explorer Drill-down"}),e.jsx(ds,{children:b?`${m}: ${b.group}${g?` | ${v}: ${b.split??"N/A"}`:""}`:"Select a chart bucket or data row"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-0 flex-1 min-h-0",children:[e.jsxs("div",{className:"border-b lg:border-b-0 lg:border-r border-border min-h-0 flex flex-col",children:[e.jsx("div",{className:"px-4 py-3 border-b border-border",children:e.jsxs(ue,{className:"grid-cols-3",children:[e.jsx(E,{title:"Sessions",value:u(k?.pagination.total_count??0)}),e.jsx(E,{title:"Page",value:`${k?.pagination.page??Y} / ${Math.max(k?.pagination.total_pages??1,1)}`}),e.jsx(E,{title:"Metric",value:c||"N/A"})]})}),e.jsx("div",{className:"p-3 min-h-0 flex-1 overflow-auto",children:b?ke?e.jsx("p",{className:"text-sm text-destructive",children:ke.message}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{columns:Je,data:k?.sessions??[],isLoading:ie,emptyMessage:"No sessions for this bucket",onRowClick:s=>T(s.session_id),getRowClassName:s=>D===s.session_id?"bg-accent/40":""}),e.jsxs("div",{className:"flex items-center justify-end gap-2 mt-3",children:[e.jsx(ne,{variant:"outline",size:"sm",onClick:()=>z(s=>Math.max(1,s-1)),disabled:ie||Y<=1,children:"Previous"}),e.jsx(ne,{variant:"outline",size:"sm",onClick:()=>z(s=>s+1),disabled:ie||!k||Y>=(k.pagination.total_pages||1),children:"Next"})]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a bucket to load sessions."})})]}),e.jsxs("div",{className:"min-h-0 flex flex-col",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-border flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Turn and Tool Details"}),D&&e.jsx(Le,{to:`/sessions/${D}`,className:"text-xs text-primary hover:underline",children:"Open session page"})]}),e.jsx(We,{className:"flex-1 p-4",children:D?Ce?e.jsx("p",{className:"text-sm text-destructive",children:Ce.message}):Ue||!h?e.jsxs("div",{className:"space-y-3",children:[e.jsx(se,{className:"h-16 w-full"}),e.jsx(se,{className:"h-24 w-full"}),e.jsx(se,{className:"h-24 w-full"})]}):e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-md border border-border p-3 bg-card",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Session:"})," ",e.jsx("span",{className:"font-mono",children:h.session_id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Branch:"})," ",h.git_branch??"unknown"]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Project:"})," ",h.project_display??h.project_path]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Started:"})," ",Fe(h.first_timestamp)]})]}),e.jsxs("div",{className:"grid grid-cols-4 gap-2 mt-3 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Cost"}),e.jsx("span",{className:"font-mono",children:be(h.total_cost)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Turns"}),e.jsx("span",{className:"font-mono",children:u(h.total_turns)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Tools"}),e.jsx("span",{className:"font-mono",children:u(h.total_tool_calls)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block",children:"Errors"}),e.jsx("span",{className:"font-mono",children:u(h.total_errors)})]})]})]}),h.turns.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No turns found for this session."}):h.turns.map(s=>e.jsxs("div",{className:"rounded-md border border-border p-3 bg-card",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 text-xs mb-2",children:[e.jsx("span",{className:"font-mono",children:s.uuid}),e.jsx("span",{className:"text-muted-foreground",children:Fe(s.timestamp)})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs mb-2",children:[e.jsx("span",{className:"rounded border border-border px-2 py-0.5",children:s.entry_type}),s.model&&e.jsx("span",{className:"rounded border border-border px-2 py-0.5",children:s.model}),e.jsxs("span",{className:"rounded border border-border px-2 py-0.5",children:["Cost ",be(s.cost)]}),s.stop_reason&&e.jsxs("span",{className:"rounded border border-border px-2 py-0.5",children:["Stop ",s.stop_reason]})]}),s.user_prompt_preview&&e.jsxs("p",{className:"text-xs text-muted-foreground mb-2",children:["Prompt: ",s.user_prompt_preview]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs mb-2",children:[e.jsxs("span",{children:["Input ",u(s.input_tokens)]}),e.jsxs("span",{children:["Output ",u(s.output_tokens)]}),e.jsxs("span",{children:["Cache Read ",u(s.cache_read_tokens)]}),e.jsxs("span",{children:["Thinking ",u(s.thinking_chars)]})]}),s.tool_calls.length>0?e.jsx("div",{className:"space-y-1.5",children:s.tool_calls.map((a,r)=>e.jsxs("div",{className:"rounded border border-border/80 px-2 py-1.5 text-xs bg-background/60",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{className:"font-medium",children:a.tool_name}),e.jsx("span",{className:a.success?"text-green-600":"text-destructive",children:a.success?"success":"failed"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-1 text-muted-foreground",children:[a.language&&e.jsx("span",{children:a.language}),a.file_path&&e.jsx("span",{className:"font-mono",children:a.file_path}),e.jsxs("span",{children:["LOC ",u(a.loc_written)]}),e.jsxs("span",{children:["+",u(a.lines_added)," / -",u(a.lines_deleted)]})]}),!a.success&&a.error_category&&e.jsxs("p",{className:"text-destructive mt-1",children:[a.error_category,a.error_message?`: ${a.error_message}`:""]})]},`${s.uuid}-${r}`))}):e.jsx("p",{className:"text-xs text-muted-foreground",children:"No tool calls on this turn."})]},s.uuid))]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Select a session to inspect replay details."})})]})]})]})})})]})}export{da as default};
