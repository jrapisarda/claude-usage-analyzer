import{j as e}from"./query-vendor-ChV-W4bE.js";import{r as n,L as g}from"./react-vendor-yhu9f3WU.js";import{P as k}from"./PageLayout-CP8ZAjnu.js";import"./table-BUskT_TB.js";import{u as S,S as E,f as r,a as i,b as d,c as P}from"./index-BNVVTlCA.js";import{E as R}from"./ErrorState-DPtgyu34.js";import{E as L}from"./EmptyState-Cd9vj59h.js";import{E as K}from"./ExportDropdown-BF7YLJzi.js";import{I as O}from"./input-Bq3Vdxgs.js";import{u as T}from"./projects-BFLuU2wz.js";import"./chart-vendor-CnSh9PGG.js";import"./index-CR7wKcdR.js";import"./index-BUO-8FAh.js";import"./check-Cz8gpq5W.js";import"./download-DZrbdbpf.js";function $({project:s}){const c=[["Sessions",r(s.sessions)],["Messages",r(s.messages)],["User Turns",r(s.user_turns)],["Duration",P(s.duration_seconds)],["Cost",i(s.cost)],["Avg Turn Cost",i(s.avg_turn_cost)],["Cost/kLOC",i(s.cost_per_kloc)],["Tokens/LOC",r(s.tokens_per_loc)],["LOC Written",r(s.loc_written)],["LOC Delivered",r(s.loc_delivered)],["Lines Added",r(s.lines_added)],["Lines Deleted",r(s.lines_deleted)],["Files Created",r(s.files_created)],["Files Edited",r(s.files_edited)],["Input Tokens",r(s.input_tokens)],["Output Tokens",r(s.output_tokens)],["Cache Read",r(s.cache_read_tokens)],["Cache Write",r(s.cache_write_tokens)],["Cache Hit Rate",d(s.cache_hit_rate)],["Thinking Chars",r(s.thinking_chars)],["Tool Calls",r(s.tool_calls)],["Errors",r(s.error_count)],["Error Rate",d(s.error_rate)],["Agent Spawns",r(s.agent_spawns)]];return e.jsxs("div",{className:"bg-accent/30 p-4 border-t border-border",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-x-6 gap-y-2",children:c.map(([l,m])=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:l}),e.jsx("span",{className:"font-mono",children:m})]},l))}),e.jsx("div",{className:"mt-3",children:e.jsx(g,{to:`/sessions?project=${encodeURIComponent(s.project_path)}`,className:"text-sm text-primary hover:underline",children:"View Sessions →"})})]})}const b=[{id:"project_display",accessorKey:"project_display",header:"Project",enableSorting:!1,cell:({row:s})=>{const c=s.original;return e.jsx(g,{to:`/projects/${btoa(unescape(encodeURIComponent(c.project_path)))}`,onClick:l=>l.stopPropagation(),className:"text-primary hover:underline font-medium truncate block max-w-xs",children:c.project_display})}},{accessorKey:"sessions",header:()=>e.jsx("div",{className:"text-right",children:"Sessions"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:r(s())})},{accessorKey:"cost",header:()=>e.jsx("div",{className:"text-right",children:"Cost"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:i(s())})},{accessorKey:"loc_written",header:()=>e.jsx("div",{className:"text-right",children:"LOC"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:r(s())})},{accessorKey:"messages",header:()=>e.jsx("div",{className:"text-right",children:"Messages"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:r(s())})},{accessorKey:"tool_calls",header:()=>e.jsx("div",{className:"text-right",children:"Tool Calls"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:r(s())})},{accessorKey:"error_rate",header:()=>e.jsx("div",{className:"text-right",children:"Error Rate"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:d(s())})},{accessorKey:"cost_per_kloc",header:()=>e.jsx("div",{className:"text-right",children:"$/kLOC"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:i(s())})},{accessorKey:"cache_hit_rate",header:()=>e.jsx("div",{className:"text-right",children:"Cache Hit"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:d(s())})}];function X(){const{dateRange:s}=S(),[c,l]=n.useState("cost"),[m,w]=n.useState("desc"),[x,h]=n.useState(1),[u,y]=n.useState(""),[_,v]=n.useState(null),{data:o,isLoading:C,error:j}=T(s,c,m,x,u||void 0),f=n.useCallback((t,a)=>{l(t),w(a),h(1)},[]);return n.useCallback(t=>{h(t+1)},[]),j?e.jsx(R,{message:j.message}):e.jsxs(k,{title:"Projects",subtitle:"Project-level metrics and drill-down",actions:o?.projects&&e.jsx(K,{page:"projects",getData:()=>(o?.projects||[]).map(t=>({project:t.project_display,sessions:t.sessions,cost:t.cost,loc_written:t.loc_written,error_rate:t.error_rate,messages:t.messages,tool_calls:t.tool_calls,cost_per_kloc:t.cost_per_kloc})),columns:["project","sessions","cost","loc_written","error_rate","messages","tool_calls","cost_per_kloc"]}),children:[e.jsxs("div",{className:"mb-4 relative max-w-sm",children:[e.jsx(E,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(O,{value:u,onChange:t=>{y(t.target.value),h(1)},placeholder:"Search projects...",className:"pl-9"})]}),!o||o.projects.length===0?C?null:e.jsx(L,{message:"No projects found"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-md border border-border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-border bg-muted/50",children:b.map(t=>{const a="accessorKey"in t?t.accessorKey:t.id,N=c===a,p=t.enableSorting!==!1&&a!=="project_display";return e.jsx("th",{onClick:()=>{p&&(N?f(a,m==="asc"?"desc":"asc"):f(a,"desc"))},className:`px-4 py-3 font-medium text-muted-foreground text-sm whitespace-nowrap ${a==="project_display"?"text-left":"text-right"} ${p?"cursor-pointer hover:text-foreground transition-colors":""}`,children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[typeof t.header=="function"?t.header({}):t.header,p&&N&&e.jsx("span",{className:"text-xs",children:m==="asc"?"▲":"▼"})]})},a)})})}),e.jsx("tbody",{children:o.projects.map(t=>e.jsxs(n.Fragment,{children:[e.jsxs("tr",{onClick:()=>v(a=>a===t.project_path?null:t.project_path),className:`border-b border-border cursor-pointer transition-colors ${_===t.project_path?"bg-accent/20":"hover:bg-accent/10"}`,children:[e.jsx("td",{className:"px-4 py-3 font-medium truncate max-w-xs",children:e.jsx(g,{to:`/projects/${btoa(unescape(encodeURIComponent(t.project_path)))}`,onClick:a=>a.stopPropagation(),className:"text-primary hover:underline",children:t.project_display})}),e.jsx("td",{className:"px-4 py-3 font-mono text-right whitespace-nowrap",children:r(t.sessions)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right whitespace-nowrap",children:i(t.cost)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right whitespace-nowrap",children:r(t.loc_written)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right whitespace-nowrap",children:r(t.messages)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right whitespace-nowrap",children:r(t.tool_calls)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right whitespace-nowrap",children:d(t.error_rate)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right whitespace-nowrap",children:i(t.cost_per_kloc)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right whitespace-nowrap",children:d(t.cache_hit_rate)})]}),_===t.project_path&&e.jsx("tr",{children:e.jsx("td",{colSpan:b.length,className:"p-0",children:e.jsx($,{project:t})})},`${t.project_path}-expanded`)]},t.project_path))})]})}),o.pagination.total_pages>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",o.pagination.page," of ",o.pagination.total_pages," (",o.pagination.total_count," projects)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(t=>Math.max(1,t-1)),disabled:x<=1,className:"p-2 rounded border border-border hover:bg-accent disabled:opacity-30 disabled:cursor-not-allowed",children:"<"}),e.jsx("button",{onClick:()=>h(t=>Math.min(o.pagination.total_pages,t+1)),disabled:x>=o.pagination.total_pages,className:"p-2 rounded border border-border hover:bg-accent disabled:opacity-30 disabled:cursor-not-allowed",children:">"})]})]})]})]})}export{X as default};
