import{u as C,j as e}from"./query-vendor-DAETOSEH.js";import{j as A,g as K,h as w,u as E,L as q,f as a,b as L}from"./index-DZMFuYgm.js";import{P as D}from"./PageLayout-DEtLmFLB.js";import{M as n}from"./MetricCard-BoawkqIY.js";import{C as l}from"./ChartCard-Cn7QorEQ.js";import{E as I}from"./ErrorState-xqkb_4mP.js";import{T as d,C as i,f as B}from"./chartConfig-CHOlO3Nn.js";import{b as o,B as S,X as u,Y as y,T as c,e as k,A as $,d as b,P as M,f as R,C as Y,L as T,i as Q,j as X}from"./chart-vendor-Df4oWUqu.js";import"./react-vendor-CGr-4ZyM.js";function H(t){return C({queryKey:A.data(t),queryFn:()=>K(`/analytics${w({from:t.from,to:t.to})}`)})}function V(t){return C({queryKey:A.thinkingTrend(t),queryFn:()=>K(`/analytics/thinking-trend${w({from:t.from,to:t.to})}`)})}function W(t){return C({queryKey:A.cacheTrend(t),queryFn:()=>K(`/analytics/cache-trend${w({from:t.from,to:t.to})}`)})}function re(){const{dateRange:t}=E(),{data:h,isLoading:r,error:m}=H(t),{data:v}=V(t),{data:_}=W(t);if(r)return e.jsx(q,{message:"Loading analytics..."});if(m)return e.jsx(I,{message:m.message});if(!h)return null;const{thinking:x,truncation:f,sidechains:p,cache_tiers:N,branches:z,versions:F,skills_agents:j}=h;return e.jsxs(D,{title:"Deep Analytics",subtitle:"Advanced metrics and analysis",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-3 mb-4",children:[e.jsx(n,{title:"Total Thinking",value:a(x.total_thinking_chars),subtitle:"characters"}),e.jsx(n,{title:"Avg / Turn",value:a(x.avg_thinking_per_turn)}),e.jsx(n,{title:"Turns w/ Thinking",value:a(x.turns_with_thinking)}),e.jsx(n,{title:"Thinking Rate",value:L(x.thinking_rate)})]}),e.jsx(l,{title:"Thinking by Model",children:x.by_model.length>0?e.jsx("div",{className:"h-64",children:e.jsx(o,{width:"100%",height:"100%",children:e.jsxs(S,{data:x.by_model,layout:"vertical",margin:{left:80},children:[e.jsx(u,{type:"number",tick:{fontSize:10},tickFormatter:a}),e.jsx(y,{type:"category",dataKey:"model",tick:{fontSize:10},width:75}),e.jsx(c,{contentStyle:d,formatter:s=>a(s??0)}),e.jsx(k,{dataKey:"thinking_chars",fill:i[0],name:"Thinking Chars",radius:[0,4,4,0]})]})})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No thinking data"})})]}),e.jsx(l,{title:"Thinking Trend",subtitle:"Daily thinking chars over time",children:v&&v.length>0?e.jsx("div",{className:"h-72",children:e.jsx(o,{width:"100%",height:"100%",children:e.jsxs($,{data:Z(v),children:[e.jsx(u,{dataKey:"date",tick:{fontSize:10}}),e.jsx(y,{tick:{fontSize:10},tickFormatter:a}),e.jsx(c,{contentStyle:d,formatter:s=>a(s??0)}),e.jsx(b,{type:"monotone",dataKey:"thinking_chars",stroke:i[0],fill:i[0],fillOpacity:.2})]})})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No trend data"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(l,{title:"Truncation Analysis",subtitle:`${f.total_turns} total turns`,children:f.by_stop_reason.length>0?e.jsx("div",{className:"h-64",children:e.jsx(o,{width:"100%",height:"100%",children:e.jsxs(M,{children:[e.jsx(R,{data:f.by_stop_reason,dataKey:"count",nameKey:"stop_reason",innerRadius:50,outerRadius:80,paddingAngle:2,label:({name:s,percent:g})=>`${s??""} ${((g??0)*100).toFixed(0)}%`,children:f.by_stop_reason.map((s,g)=>e.jsx(Y,{fill:i[g%i.length]},g))}),e.jsx(c,{contentStyle:d}),e.jsx(T,{})]})})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No truncation data"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-3 mb-4",children:[e.jsx(n,{title:"Total Sidechains",value:a(p.total_sidechains)}),e.jsx(n,{title:"Sidechain Rate",value:L(p.sidechain_rate)})]}),e.jsx(l,{title:"Sidechains by Project",children:p.by_project.length>0?e.jsx("div",{className:"h-48",children:e.jsx(o,{width:"100%",height:"100%",children:e.jsxs(S,{data:p.by_project.slice(0,10),children:[e.jsx(u,{dataKey:"project",tick:{fontSize:9},interval:0,angle:-20,textAnchor:"end",height:50}),e.jsx(y,{tick:{fontSize:10}}),e.jsx(c,{contentStyle:d}),e.jsx(k,{dataKey:"sidechain_count",fill:i[3],name:"Sidechains",radius:[4,4,0,0]})]})})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No sidechain data"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsx(n,{title:"Ephemeral 5m",value:a(N.ephemeral_5m_tokens),subtitle:"tokens"}),e.jsx(n,{title:"Ephemeral 1h",value:a(N.ephemeral_1h_tokens),subtitle:"tokens"}),e.jsx(n,{title:"Standard Cache",value:a(N.standard_cache_tokens),subtitle:"tokens"})]}),e.jsx(l,{title:"Cache Tier Trend",subtitle:"Daily token volumes by cache tier",children:_&&_.length>0?e.jsx("div",{className:"h-48",children:e.jsx(o,{width:"100%",height:"100%",children:e.jsxs($,{data:B(_,["ephemeral_5m","ephemeral_1h","standard_cache"]),children:[e.jsx(u,{dataKey:"date",tick:{fontSize:10}}),e.jsx(y,{tick:{fontSize:10},tickFormatter:a}),e.jsx(c,{contentStyle:d,formatter:s=>a(s??0)}),e.jsx(b,{type:"monotone",dataKey:"ephemeral_5m",stackId:"1",stroke:i[0],fill:i[0],fillOpacity:.6,name:"5min Ephemeral"}),e.jsx(b,{type:"monotone",dataKey:"ephemeral_1h",stackId:"1",stroke:i[1],fill:i[1],fillOpacity:.6,name:"1hr Ephemeral"}),e.jsx(b,{type:"monotone",dataKey:"standard_cache",stackId:"1",stroke:i[2],fill:i[2],fillOpacity:.6,name:"Standard Cache"}),e.jsx(T,{})]})})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No cache trend data"})})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3 mb-4",children:[e.jsx(n,{title:"Agent Spawns",value:a(j.total_agent_spawns)}),e.jsx(n,{title:"Skill Invocations",value:a(j.total_skill_invocations)}),e.jsx(n,{title:"Agent Cost",value:`$${j.agent_cost.toFixed(4)}`})]}),e.jsx(l,{title:"Skills & Agents by Date",children:j.by_date.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-border",children:Object.keys(j.by_date[0]).map(s=>e.jsx("th",{className:"text-left px-3 py-2 font-medium text-muted-foreground",children:s},s))})}),e.jsx("tbody",{children:j.by_date.slice(0,20).map((s,g)=>e.jsx("tr",{className:"border-b border-border hover:bg-accent/10",children:Object.values(s).map((O,P)=>e.jsx("td",{className:"px-3 py-2 font-mono",children:String(O??"")},P))},g))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No skills data"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(l,{title:"Branch Analytics",children:z.branches.length>0?e.jsx("div",{className:"h-64",children:e.jsx(o,{width:"100%",height:"100%",children:e.jsxs(S,{data:z.branches.slice(0,10),layout:"vertical",margin:{left:80},children:[e.jsx(u,{type:"number",tick:{fontSize:10}}),e.jsx(y,{type:"category",dataKey:"branch",tick:{fontSize:10},width:75}),e.jsx(c,{contentStyle:d}),e.jsx(k,{dataKey:"cost",fill:i[0],name:"Cost",radius:[0,4,4,0]}),e.jsx(k,{dataKey:"sessions",fill:i[1],name:"Sessions",radius:[0,4,4,0]}),e.jsx(T,{})]})})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No branch data"})}),e.jsx(l,{title:"CC Version Impact",subtitle:"Avg turn cost by Claude Code version",children:F.versions.length>0?e.jsx("div",{className:"h-64",children:e.jsx(o,{width:"100%",height:"100%",children:e.jsxs(Q,{data:F.versions,children:[e.jsx(u,{dataKey:"version",tick:{fontSize:9},interval:0,angle:-20,textAnchor:"end",height:50}),e.jsx(y,{tick:{fontSize:10},tickFormatter:s=>`$${s.toFixed(3)}`}),e.jsx(c,{contentStyle:d,formatter:s=>`$${(s??0).toFixed(4)}`}),e.jsx(X,{type:"monotone",dataKey:"avg_turn_cost",stroke:i[4],strokeWidth:2,dot:{r:3},name:"Avg Turn Cost"})]})})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No version data"})})]})]})}function Z(t){const h=new Map;for(const r of t)h.set(r.date,(h.get(r.date)||0)+r.thinking_chars);return Array.from(h,([r,m])=>({date:r,thinking_chars:m})).sort((r,m)=>r.date.localeCompare(m.date))}export{re as default};
