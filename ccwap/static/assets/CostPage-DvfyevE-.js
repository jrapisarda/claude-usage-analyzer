import{u as $,j as e}from"./query-vendor-ChV-W4bE.js";import{P as O}from"./PageLayout-CKQ82rM8.js";import{M as z,a as w}from"./MetricCardGrid-DAgrh55f.js";import{C as v}from"./ChartContainer-DT93XJhW.js";import{E as I}from"./ErrorState-DjaCiOCU.js";import{E as Y}from"./ExportDropdown-DnSuL1-6.js";import{C as P,a as B,b as G,c as q}from"./card-BPiuFm8S.js";import{j as A,h as K,i as E,k as H,a as s,b as T,u as Q}from"./index-Bpa7eUOS.js";import{r as S}from"./react-vendor-yhu9f3WU.js";import{T as N}from"./chartConfig-CHOlO3Nn.js";import{A as F,X as k,Y as _,T as b,b as M,P as X,f as J,C as U,B as L,e as R,g as W,h as V}from"./chart-vendor-CnSh9PGG.js";import"./skeleton-DdhmaHDM.js";import"./index-CW8GAOI9.js";import"./index-DHRk0rsW.js";import"./check-CQsps3zJ.js";import"./download-C-raSRr6.js";function Z(a){return $({queryKey:A.data(a),queryFn:()=>K(`/cost${E({from:a.from,to:a.to})}`)})}function ee(a){return $({queryKey:A.anomalies(a),queryFn:()=>K(`/cost/anomalies${E({from:a.from,to:a.to})}`)})}function te(a){return $({queryKey:A.cumulative(a),queryFn:()=>K(`/cost/cumulative${E({from:a.from,to:a.to})}`)})}function se(a,r){return $({queryKey:A.cacheSimulation(a,r),queryFn:()=>K(`/cost/cache-simulation${E({target_hit_rate:a,from:r.from,to:r.to})}`)})}function ae({spent:a}){const[r,C]=H("ccwap:monthly-budget",0),[o,n]=S.useState(!1),[i,u]=S.useState(""),c=S.useRef(null);S.useEffect(()=>{o&&c.current&&(c.current.focus(),c.current.select())},[o]);const h=()=>{u(r>0?r.toString():""),n(!0)},f=()=>{const l=parseFloat(i);!isNaN(l)&&l>=0&&C(l),n(!1)},g=l=>{l.key==="Enter"&&f(),l.key==="Escape"&&n(!1)},j=r-a,d=r>0?a/r*100:0,p=new Date(new Date().getFullYear(),new Date().getMonth()+1,0).getDate(),m=new Date().getDate(),y=m>0?a/m:0,x=y*p,t=d>90?"bg-red-500":d>70?"bg-yellow-500":"bg-green-500";return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Budget Tracker"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Monthly Budget"}),o?e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"text-lg font-mono",children:"$"}),e.jsx("input",{ref:c,type:"number",min:"0",step:"0.01",value:i,onChange:l=>u(l.target.value),onBlur:f,onKeyDown:g,className:"font-mono text-lg w-28 bg-transparent border-b border-border outline-none focus:border-primary"})]}):e.jsx("p",{className:"font-mono text-lg cursor-pointer hover:text-primary transition-colors",onClick:h,title:"Click to edit budget",children:r>0?s(r):"Set budget..."})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Spent"}),e.jsx("p",{className:"font-mono text-lg",children:s(a)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Remaining"}),e.jsx("p",{className:`font-mono text-lg ${r>0&&j<0?"text-red-500":""}`,children:r>0?s(j):"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Burn Rate"}),e.jsxs("p",{className:"font-mono text-lg",children:[s(y),"/day"]}),r>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Projected: ",s(x)]})]})]}),r>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsxs("span",{children:[Math.min(d,100).toFixed(1),"% used"]}),e.jsxs("span",{children:[s(a)," / ",s(r)]})]}),e.jsx("div",{className:"w-full h-3 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${t}`,style:{width:`${Math.min(d,100)}%`}})})]})]})}function re({dateRange:a}){const[r,C]=S.useState(80),{data:o,isLoading:n}=se(r/100,a);return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Cache What-If Calculator"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Target Cache Hit Rate"}),e.jsxs("span",{className:"font-mono text-sm",children:[r,"%"]})]}),e.jsx("input",{type:"range",min:0,max:100,step:1,value:r,onChange:i=>C(Number(i.target.value)),className:"w-full accent-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"})]})]}),n&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Calculating..."}),o&&e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Actual Cost"}),e.jsx("p",{className:"font-mono text-lg",children:s(o.actual_cost)}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Hit rate: ",T(o.actual_cache_rate)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Simulated Cost"}),e.jsx("p",{className:"font-mono text-lg",children:s(o.simulated_cost)}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Hit rate: ",T(o.simulated_cache_rate)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Savings"}),e.jsx("p",{className:`font-mono text-lg ${o.savings>0?"text-green-500":o.savings<0?"text-red-500":""}`,children:s(o.savings)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Savings %"}),e.jsx("p",{className:`font-mono text-lg ${o.savings>0?"text-green-500":o.savings<0?"text-red-500":""}`,children:o.actual_cost>0?T(o.savings/o.actual_cost):"0.0%"})]})]})]})}const D={input:"var(--color-token-input)",output:"var(--color-token-output)",cache_read:"var(--color-token-cache-read)",cache_write:"var(--color-token-cache-write)"};function Ne(){const{dateRange:a}=Q(),{data:r,isLoading:C,error:o}=Z(a),{data:n}=ee(a),{data:i}=te(a),[u]=H("ccwap:monthly-budget",0);if(o)return e.jsx(I,{message:o.message});if(C||!r)return e.jsx(O,{title:"Cost Analysis",subtitle:"Detailed cost breakdowns and forecasting",children:e.jsx(z,{skeleton:!0,count:4,className:"mb-6"})});const{summary:c,by_token_type:h,by_model:f,trend:g,by_project:j,cache_savings:d,forecast:p}=r,m=n?.filter(t=>t.is_anomaly)??[],y=n&&n.length>0?n[0].threshold:0,x=[{name:"Input",value:h.input_cost,color:D.input},{name:"Output",value:h.output_cost,color:D.output},{name:"Cache Read",value:h.cache_read_cost,color:D.cache_read},{name:"Cache Write",value:h.cache_write_cost,color:D.cache_write}].filter(t=>t.value>0);return e.jsxs(O,{title:"Cost Analysis",subtitle:"Detailed cost breakdowns and forecasting",actions:e.jsx(Y,{page:"cost",getData:()=>[...g.map(t=>({date:t.date,cost:t.cost})),...f.map(t=>({type:"by_model",model:t.model,cost:t.cost})),...j.map(t=>({type:"by_project",project:t.project_display,cost:t.cost}))]}),children:[e.jsxs(z,{className:"mb-6",children:[e.jsx(w,{title:"Total Cost",value:s(c.total_cost)}),e.jsx(w,{title:"Avg Daily",value:s(c.avg_daily_cost)}),e.jsx(w,{title:"Today",value:s(c.cost_today)}),e.jsx(w,{title:"Projected Monthly",value:s(c.projected_monthly)})]}),e.jsxs(P,{className:"mb-6",children:[e.jsx(B,{className:"pb-3",children:e.jsx(G,{className:"text-sm font-medium text-muted-foreground",children:"Spend Forecast"})}),e.jsx(q,{children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Daily Avg"}),e.jsx("p",{className:"font-mono text-lg",children:s(p.daily_avg)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"7-Day"}),e.jsx("p",{className:"font-mono text-lg",children:s(p.projected_7d)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"14-Day"}),e.jsx("p",{className:"font-mono text-lg",children:s(p.projected_14d)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"30-Day"}),e.jsx("p",{className:"font-mono text-lg",children:s(p.projected_30d)})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(v,{title:"Cost Trend",height:256,isEmpty:g.length===0,emptyMessage:"No cost trend data",children:e.jsxs(F,{data:g,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"costTrendGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-1)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-1)",stopOpacity:0})]})}),e.jsx(k,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(_,{tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(b,{contentStyle:N,formatter:t=>[t!=null?s(t):"","Cost"]}),e.jsx(M,{type:"monotone",dataKey:"cost",stroke:"var(--color-chart-1)",fill:"url(#costTrendGrad)",strokeWidth:2,isAnimationActive:g.length<365})]})}),e.jsx(v,{title:"Cost by Token Type",height:192,isEmpty:x.length===0,emptyMessage:"No token type data",children:e.jsxs(X,{children:[e.jsx(J,{data:x,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,strokeWidth:0,children:x.map((t,l)=>e.jsx(U,{fill:t.color},l))}),e.jsx(b,{contentStyle:{...N},formatter:t=>[t!=null?s(t):""]})]})})]}),x.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3 -mt-4 mb-6 ml-4",children:x.map(t=>e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),t.name,": ",s(t.value)]},t.name))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(v,{title:"Cost by Model",height:256,isEmpty:f.length===0,emptyMessage:"No model data",children:e.jsxs(L,{data:f.slice(0,10),layout:"vertical",children:[e.jsx(k,{type:"number",tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)"}),e.jsx(_,{type:"category",dataKey:"model",tick:{fontSize:10},width:120,stroke:"var(--color-muted-foreground)"}),e.jsx(b,{contentStyle:N,formatter:t=>[t!=null?s(t):"","Cost"]}),e.jsx(R,{dataKey:"cost",fill:"var(--color-chart-1)",radius:[0,4,4,0]})]})}),e.jsx(v,{title:"Cost by Project (Top 10)",height:256,isEmpty:j.length===0,emptyMessage:"No project data",children:e.jsxs(L,{data:j.slice(0,10),layout:"vertical",children:[e.jsx(k,{type:"number",tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)"}),e.jsx(_,{type:"category",dataKey:"project_display",tick:{fontSize:10},width:120,stroke:"var(--color-muted-foreground)"}),e.jsx(b,{contentStyle:N,formatter:t=>[t!=null?s(t):"","Cost"]}),e.jsx(R,{dataKey:"cost",fill:"var(--color-chart-2)",radius:[0,4,4,0]})]})})]}),e.jsxs(P,{className:"mb-6",children:[e.jsx(B,{className:"pb-3",children:e.jsx(G,{className:"text-sm font-medium text-muted-foreground",children:"Cache Savings"})}),e.jsx(q,{children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Cache Hit Rate"}),e.jsx("p",{className:"font-mono text-lg",children:T(d.cache_hit_rate)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Estimated Savings"}),e.jsx("p",{className:"font-mono text-lg text-green-500",children:s(d.estimated_savings)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Cost w/o Cache"}),e.jsx("p",{className:"font-mono text-lg",children:s(d.cost_without_cache)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Actual Cost"}),e.jsx("p",{className:"font-mono text-lg",children:s(d.actual_cost)})]})]})})]}),e.jsx("div",{className:"mb-6",children:e.jsx(ae,{spent:c.cost_this_month})}),n&&n.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx(v,{title:"Anomaly Detection",height:256,children:e.jsxs(F,{data:n,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"anomalyGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-1)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-1)",stopOpacity:0})]})}),e.jsx(k,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(_,{tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(b,{contentStyle:N,formatter:t=>[s(t??0),"Cost"]}),e.jsx(M,{type:"monotone",dataKey:"cost",stroke:"var(--color-chart-1)",fill:"url(#anomalyGrad)",strokeWidth:2,isAnimationActive:n.length<365}),y>0&&e.jsx(W,{y,stroke:"var(--color-chart-4)",strokeDasharray:"5 5",label:{value:"Threshold",position:"right",fill:"var(--color-muted-foreground)",fontSize:10}}),m.map(t=>e.jsx(V,{x:t.date,y:t.cost,r:5,fill:"var(--color-destructive, #ef4444)",stroke:"none"},t.date))]})}),m.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 ml-4",children:[m.length," anomal",m.length===1?"y":"ies"," detected above ",s(y)," threshold"]})]}),i&&i.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(v,{title:"Cumulative Cost",height:256,children:e.jsxs(F,{data:i,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"cumulativeGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-2)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-2)",stopOpacity:0})]})}),e.jsx(k,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(_,{tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)",width:60}),e.jsx(b,{contentStyle:N,formatter:(t,l)=>[s(t??0),l==="cumulative"?"Cumulative":"Daily"]}),e.jsx(M,{type:"monotone",dataKey:"cumulative",stroke:"var(--color-chart-2)",fill:"url(#cumulativeGrad)",strokeWidth:2,name:"cumulative",isAnimationActive:i.length<365}),u>0&&e.jsx(W,{y:u,stroke:"var(--color-chart-4)",strokeDasharray:"5 5",label:{value:`Budget: ${s(u)}`,position:"right",fill:"var(--color-muted-foreground)",fontSize:10}})]})})}),e.jsx("div",{className:"mb-6",children:e.jsx(re,{dateRange:a})})]})}export{Ne as default};
