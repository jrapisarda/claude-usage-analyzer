import{j as e}from"./query-vendor-ChV-W4bE.js";import{r as C,L as N}from"./react-vendor-yhu9f3WU.js";import{P as m}from"./PageLayout-D9m6_tUv.js";import{C as d}from"./ChartContainer-CZHP22W9.js";import{M as h,a as i}from"./MetricCardGrid-B_H6C3FR.js";import{D as v}from"./DataTable-DaAT2w4Q.js";import{E as k}from"./ErrorState-BLJWzcFK.js";import{u as S,f as a,b as u,a as y}from"./index-fSpeN2Hc.js";import{b as L}from"./advanced-FWnTxelS.js";import{T as x,C as p}from"./chartConfig-C_qPkli-.js";import{S as K,X as g,Y as f,Z as T,T as j,q as E,B as O,e as P}from"./chart-vendor-CnSh9PGG.js";import"./skeleton-D4mSERnM.js";import"./table-ClnvA-zJ.js";const w=[{accessorKey:"session_id",header:"Session",cell:({row:t})=>e.jsx(N,{to:`/sessions/${t.original.session_id}`,className:"font-mono text-xs text-primary hover:underline",children:t.original.session_id})},{accessorKey:"project",header:"Project",cell:({row:t})=>e.jsx("span",{className:"truncate block max-w-[220px]",children:t.original.project})},{accessorKey:"model",header:"Model",cell:({row:t})=>e.jsx("span",{className:"font-mono text-xs",children:t.original.model})},{accessorKey:"cost",header:()=>e.jsx("div",{className:"text-right",children:"Cost"}),cell:({row:t})=>e.jsx("div",{className:"text-right font-mono",children:y(t.original.cost)})},{accessorKey:"output_tokens",header:()=>e.jsx("div",{className:"text-right",children:"Output"}),cell:({row:t})=>e.jsx("div",{className:"text-right font-mono",children:a(t.original.output_tokens)})},{accessorKey:"thinking_chars",header:()=>e.jsx("div",{className:"text-right",children:"Thinking"}),cell:({row:t})=>e.jsx("div",{className:"text-right font-mono",children:a(t.original.thinking_chars)})},{accessorKey:"loc_written",header:()=>e.jsx("div",{className:"text-right",children:"LOC"}),cell:({row:t})=>e.jsx("div",{className:"text-right font-mono",children:a(t.original.loc_written)})}];function G(){const{dateRange:t}=S(),{data:r,isLoading:b,error:n}=L(t),c=r?.by_stop_reason.slice(0,10)??[],_=r&&r.summary.total_sessions>0?r.summary.high_cost_low_output_sessions/r.summary.total_sessions:0,l=C.useMemo(()=>(r?.scatter??[]).map(s=>({...s,bubble:Math.max(20,Math.min(200,Math.floor(s.thinking_chars/150)))})),[r?.scatter]);return n?e.jsx(k,{message:n.message}):b||!r?e.jsx(m,{title:"Prompt Efficiency",subtitle:"Find expensive prompt patterns and low-output sessions",children:e.jsx(h,{skeleton:!0,count:4,className:"mb-6"})}):e.jsxs(m,{title:"Prompt Efficiency",subtitle:"Detect expensive prompt patterns and truncation/overthinking overhead",children:[e.jsxs(h,{className:"mb-6",children:[e.jsx(i,{title:"Sessions",value:a(r.summary.total_sessions)}),e.jsx(i,{title:"With Thinking",value:a(r.summary.sessions_with_thinking)}),e.jsx(i,{title:"With Truncation",value:a(r.summary.sessions_with_truncation)}),e.jsx(i,{title:"High-Cost Low-Output",value:u(_)})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(d,{title:"Cost vs LOC (bubble=thinking chars)",height:320,isEmpty:l.length===0,children:e.jsxs(K,{children:[e.jsx(g,{type:"number",dataKey:"cost",name:"Cost",tick:{fontSize:10}}),e.jsx(f,{type:"number",dataKey:"loc_written",name:"LOC",tick:{fontSize:10}}),e.jsx(T,{type:"number",dataKey:"bubble",range:[30,280]}),e.jsx(j,{contentStyle:x,formatter:(s,o)=>o==="cost"?[y(s??0),"Cost"]:o==="loc_written"?[a(s??0),"LOC"]:[a(s??0),o],labelFormatter:(s,o)=>o?.[0]?.payload?.session_id??"session"}),e.jsx(E,{data:l,fill:p[0]})]})}),e.jsx(d,{title:"Stop Reason / Truncation Profile",height:320,isEmpty:c.length===0,children:e.jsxs(O,{data:c,children:[e.jsx(g,{dataKey:"stop_reason",tick:{fontSize:10},angle:-20,textAnchor:"end",height:60}),e.jsx(f,{tick:{fontSize:10}}),e.jsx(j,{contentStyle:x,formatter:(s,o)=>o==="percentage"?u(s??0):a(s??0)}),e.jsx(P,{dataKey:"count",fill:p[2],name:"Count"})]})})]}),e.jsxs("div",{className:"rounded-md border border-border p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Funnel Cards"}),e.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-3",children:r.funnel.map(s=>e.jsxs("div",{className:"rounded border border-border p-3 bg-card",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s.stage}),e.jsx("p",{className:"font-mono text-lg",children:a(s.value)})]},s.stage))})]}),e.jsx(v,{columns:w,data:r.outliers,emptyMessage:"No outliers detected"})]})}export{G as default};
