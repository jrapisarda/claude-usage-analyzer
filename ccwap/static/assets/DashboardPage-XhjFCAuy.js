import{j as e}from"./query-vendor-ChV-W4bE.js";import{r as E,L as M}from"./react-vendor-yhu9f3WU.js";import{P as S}from"./PageLayout-DPasqS-O.js";import{M as L,a as g}from"./MetricCardGrid-GOuSrQkO.js";import{C as T}from"./ChartContainer-B3BCIAzK.js";import{E as G}from"./ErrorState-C7Oppa98.js";import{E as O}from"./EmptyState-C9M8yoIu.js";import{C as v,a as y,b as N,c as b}from"./card-Byyeu849.js";import{B as R}from"./badge-DqpYExzj.js";import{u as W,f as D,a as C,b as P,c as H,t as V}from"./index-nDEx28AN.js";import{u as F,a as z,b as B}from"./dashboard-B-842VGh.js";import{H as J}from"./HeatmapGrid-BcMaC_sn.js";import{T as K}from"./chartConfig-CHOlO3Nn.js";import{A,b as $,X as Y,Y as I,T as U}from"./chart-vendor-CnSh9PGG.js";import"./skeleton-CAkgKQJz.js";function X(d){if(d.length===0)return{data:[],maxValue:0,colLabels:[]};const m=[...d].sort((t,o)=>t.date.localeCompare(o.date)),h=new Date(m[0].date+"T00:00:00"),f=(h.getDay()+6)%7,n=new Date(h);n.setDate(n.getDate()-f);const c=new Map;let i=0;for(const t of m)c.set(t.date,t.sessions),t.sessions>i&&(i=t.sessions);const r=[],x=[],p=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(let t=0;t<13;t++){const o=new Date(n);if(o.setDate(o.getDate()+t*7),t===0)r.push(p[o.getMonth()]);else{const a=new Date(n);a.setDate(a.getDate()+(t-1)*7),o.getMonth()!==a.getMonth()?r.push(p[o.getMonth()]):r.push("")}for(let a=0;a<7;a++){const l=new Date(n);l.setDate(l.getDate()+t*7+a);const j=V(l),u=c.get(j)??0;u>0&&x.push({row:a,col:t,value:u})}}return{data:x,maxValue:i,colLabels:r}}const q=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function pe(){const{dateRange:d}=W(),{data:m,isLoading:h,error:f}=F(d),{data:n}=z(d),{data:c}=B(90),i=E.useMemo(()=>X(c??[]),[c]);if(f)return e.jsx(G,{message:f.message});if(h||!m)return e.jsx(S,{title:"Dashboard",subtitle:"Overview of your Claude Code usage",children:e.jsx(L,{skeleton:!0,count:4,className:"mb-6"})});const{vitals:r,sparkline_7d:x,top_projects:p,cost_trend:t,recent_sessions:o}=m,a=new Map((n??[]).map(s=>[s.metric,{pct_change:s.pct_change}])),l=a.get("sessions"),j=a.get("cost"),u=a.get("loc_written"),_=a.get("error_rate");return e.jsxs(S,{title:"Dashboard",subtitle:"Overview of your Claude Code usage",children:[e.jsxs(L,{className:"mb-6",children:[e.jsx(g,{title:"Sessions",value:D(r.sessions),subtitle:`${D(r.user_turns)} user turns`,delta:l?{value:l.pct_change}:void 0}),e.jsx(g,{title:"Total Cost",value:C(r.cost),delta:j?{value:j.pct_change}:void 0}),e.jsx(g,{title:"LOC Written",value:D(r.loc_written),delta:u?{value:u.pct_change}:void 0}),e.jsx(g,{title:"Error Rate",value:P(r.error_rate),delta:_?{value:_.pct_change}:void 0})]}),c&&c.length>0&&e.jsxs(v,{className:"mb-6",children:[e.jsx(y,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium text-muted-foreground",children:"Activity (last 90 days)"})}),e.jsx(b,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx(J,{data:i.data,maxValue:i.maxValue,rowLabels:q,colLabels:i.colLabels,cellSize:18,formatValue:s=>`${s} session${s!==1?"s":""}`,formatTooltip:(s,k,w)=>`${s}${k?` ${k}`:""}: ${w} session${w!==1?"s":""}`})})})]}),x.length>1&&e.jsxs(v,{className:"mb-6",children:[e.jsx(y,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium text-muted-foreground",children:"7-Day Cost"})}),e.jsx(b,{className:"h-16",children:e.jsx(T,{height:64,className:"border-0 p-0",children:e.jsxs(A,{data:x,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"sparkGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-1)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-1)",stopOpacity:0})]})}),e.jsx($,{type:"monotone",dataKey:"value",stroke:"var(--color-chart-1)",fill:"url(#sparkGrad)",strokeWidth:2})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(T,{title:"Cost Trend",height:256,isEmpty:t.length===0,emptyMessage:"No cost trend data",children:e.jsxs(A,{data:t,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"costGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-1)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-1)",stopOpacity:0})]})}),e.jsx(Y,{dataKey:"date",tick:{fontSize:11},tickFormatter:s=>s?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(I,{tick:{fontSize:11},tickFormatter:s=>`$${s??0}`,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(U,{contentStyle:K,formatter:s=>[s!=null?C(s):"","Cost"]}),e.jsx($,{type:"monotone",dataKey:"cost",stroke:"var(--color-chart-1)",fill:"url(#costGrad)",strokeWidth:2,isAnimationActive:t.length<365})]})}),e.jsxs(v,{children:[e.jsx(y,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium text-muted-foreground",children:"Top Projects"})}),e.jsx(b,{children:p.length===0?e.jsx(O,{message:"No project data"}):e.jsx("div",{className:"space-y-1",children:p.map(s=>e.jsxs(M,{to:`/projects?search=${encodeURIComponent(s.project_display)}`,className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"truncate font-medium",children:s.project_display}),e.jsxs("span",{className:"text-xs text-muted-foreground shrink-0",children:[s.sessions," sessions"]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[D(s.loc_written)," LOC"]}),e.jsx("span",{className:"font-mono text-sm",children:C(s.cost)})]})]},s.project_path))})})]})]}),e.jsxs(v,{children:[e.jsx(y,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium text-muted-foreground",children:"Recent Sessions"})}),e.jsx(b,{children:o.length===0?e.jsx(O,{message:"No sessions"}):e.jsx("div",{className:"space-y-1",children:o.map(s=>e.jsxs(M,{to:`/sessions/${s.session_id}`,className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"truncate font-medium",children:s.project_display||"Unknown"}),s.is_agent&&e.jsx(R,{variant:"secondary",className:"bg-purple-500/20 text-purple-400 text-[10px] px-1.5 py-0.5",children:"agent"}),e.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:s.model})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.turns," turns"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:H(s.duration_seconds)}),e.jsx("span",{className:"font-mono text-sm",children:C(s.cost)})]})]},s.session_id))})})]})]})}export{pe as default};
