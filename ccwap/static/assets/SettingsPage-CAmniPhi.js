import{u as y,c as j,b as w,j as e}from"./query-vendor-DAETOSEH.js";import{r as c}from"./react-vendor-CGr-4ZyM.js";import{P as C}from"./PageLayout-DEtLmFLB.js";import{d as N,m as v,g as h,L as k,R as S,f as P}from"./index-DZMFuYgm.js";import{E as F}from"./ErrorState-xqkb_4mP.js";import{u as p}from"./useLocalStorage-iD_z970y.js";import{D as f}from"./download-Bat12fqC.js";import{T as E,P as _}from"./trash-2-C1zs9qV9.js";import"./chart-vendor-Df4oWUqu.js";const $=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],M=N("bell",$);const R=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],D=N("save",R);function L(){return y({queryKey:v.all,queryFn:()=>h("/settings")})}function T(){const a=w();return j({mutationFn:r=>h("/settings/pricing",{method:"PUT",body:JSON.stringify(r)}),onSuccess:()=>a.invalidateQueries({queryKey:v.all})})}function A(){return j({mutationFn:()=>h("/settings/rebuild",{method:"POST"})})}function O({pricing:a}){const r=T(),[n,d]=c.useState(null),[i,l]=c.useState({input:0,output:0,cache_read:0,cache_write:0}),o=c.useCallback((t,s)=>{d(t),l({...s})},[]),u=c.useCallback(()=>{n&&r.mutate({model:n,pricing:i},{onSuccess:()=>d(null)})},[n,i,r]),x=Object.entries(a).sort((t,s)=>t[0].localeCompare(s[0]));return e.jsx("div",{className:"rounded-lg border border-border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50 border-b border-border",children:[e.jsx("th",{className:"text-left px-4 py-3 font-medium text-muted-foreground",children:"Model"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-muted-foreground",children:"Input $/M"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-muted-foreground",children:"Output $/M"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-muted-foreground",children:"Cache Read $/M"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-muted-foreground",children:"Cache Write $/M"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-muted-foreground",children:"Actions"})]})}),e.jsx("tbody",{children:x.map(([t,s])=>e.jsxs("tr",{className:"border-b border-border hover:bg-accent/10",children:[e.jsx("td",{className:"px-4 py-3 font-mono text-xs",children:t}),n===t?e.jsxs(e.Fragment,{children:[["input","output","cache_read","cache_write"].map(m=>e.jsx("td",{className:"px-4 py-2",children:e.jsx("input",{type:"number",step:"0.01",value:i[m],onChange:b=>l(g=>({...g,[m]:parseFloat(b.target.value)||0})),className:"w-full px-2 py-1 text-sm text-right font-mono rounded border border-border bg-background focus:outline-none focus:ring-1 focus:ring-ring"})},m)),e.jsx("td",{className:"px-4 py-2 text-right",children:e.jsx("button",{onClick:u,disabled:r.isPending,className:"p-1 rounded text-primary hover:bg-primary/10",children:e.jsx(D,{className:"h-4 w-4"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs("td",{className:"px-4 py-3 font-mono text-right",children:["$",s.input.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 font-mono text-right",children:["$",s.output.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 font-mono text-right",children:["$",s.cache_read.toFixed(2)]}),e.jsxs("td",{className:"px-4 py-3 font-mono text-right",children:["$",s.cache_write.toFixed(2)]}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("button",{onClick:()=>o(t,s),className:"text-xs text-primary hover:underline",children:"Edit"})})]})]},t))})]})})})}function V(){const a=c.useCallback(r=>{window.open(`/api/settings/export?format=${r}`,"_blank")},[]);return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Full Database Export"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Download a complete export of your database in CSV or JSON format."}),e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:()=>a("csv"),className:"flex items-center gap-2 px-3 py-2 text-sm rounded-md border border-border hover:bg-accent",children:[e.jsx(f,{className:"h-4 w-4"}),"Export CSV"]}),e.jsxs("button",{onClick:()=>a("json"),className:"flex items-center gap-2 px-3 py-2 text-sm rounded-md border border-border hover:bg-accent",children:[e.jsx(f,{className:"h-4 w-4"}),"Export JSON"]})]})]})}function q(){const[a,r]=p("ccwap:custom-presets",[]),[n,d]=c.useState(""),[i,l]=c.useState(""),[o,u]=c.useState(""),x=c.useCallback(()=>{!n.trim()||!i||!o||(r(s=>[...s,{label:n.trim(),from:i,to:o}]),d(""),l(""),u(""))},[n,i,o,r]),t=c.useCallback(s=>{r(m=>m.filter((b,g)=>g!==s))},[r]);return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Custom Date Presets"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Create custom date range presets for quick access in the date picker."}),a.length>0&&e.jsx("div",{className:"space-y-2 mb-4",children:a.map((s,m)=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-md bg-muted/50 border border-border",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:s.label}),e.jsxs("span",{className:"text-muted-foreground ml-2",children:[s.from," to ",s.to]})]}),e.jsx("button",{onClick:()=>t(m),className:"p-1 rounded text-muted-foreground hover:text-destructive hover:bg-destructive/10",children:e.jsx(E,{className:"h-4 w-4"})})]},m))}),a.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground italic mb-4",children:"No custom presets defined."}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[140px]",children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Label"}),e.jsx("input",{type:"text",value:n,onChange:s=>d(s.target.value),placeholder:"e.g. Q1 2026",className:"w-full px-2 py-1.5 text-sm rounded border border-border bg-background focus:outline-none focus:ring-1 focus:ring-ring"})]}),e.jsxs("div",{className:"min-w-[140px]",children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"From"}),e.jsx("input",{type:"date",value:i,onChange:s=>l(s.target.value),className:"w-full px-2 py-1.5 text-sm rounded border border-border bg-background focus:outline-none focus:ring-1 focus:ring-ring"})]}),e.jsxs("div",{className:"min-w-[140px]",children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"To"}),e.jsx("input",{type:"date",value:o,onChange:s=>u(s.target.value),className:"w-full px-2 py-1.5 text-sm rounded border border-border bg-background focus:outline-none focus:ring-1 focus:ring-ring"})]}),e.jsxs("button",{onClick:x,disabled:!n.trim()||!i||!o,className:"flex items-center gap-1 px-3 py-1.5 text-sm rounded-md bg-primary text-primary-foreground hover:bg-primary/90 disabled:opacity-50",children:[e.jsx(_,{className:"h-4 w-4"}),"Add"]})]})]})}function B(){const[a,r]=p("ccwap:alert-daily-cost",0),[n,d]=p("ccwap:alert-weekly-cost",0),[i,l]=p("ccwap:alert-error-rate",0);return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"Notification Thresholds"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Set alert thresholds for cost and error monitoring. A value of 0 means no alert."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm text-muted-foreground w-48",children:"Daily Cost Alert ($)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:a,onChange:o=>r(parseFloat(o.target.value)||0),className:"w-32 px-2 py-1.5 text-sm font-mono text-right rounded border border-border bg-background focus:outline-none focus:ring-1 focus:ring-ring"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm text-muted-foreground w-48",children:"Weekly Cost Alert ($)"}),e.jsx("input",{type:"number",min:"0",step:"0.01",value:n,onChange:o=>d(parseFloat(o.target.value)||0),className:"w-32 px-2 py-1.5 text-sm font-mono text-right rounded border border-border bg-background focus:outline-none focus:ring-1 focus:ring-ring"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm text-muted-foreground w-48",children:"Error Rate Alert (%)"}),e.jsx("input",{type:"number",min:"0",max:"100",step:"0.1",value:i,onChange:o=>l(parseFloat(o.target.value)||0),className:"w-32 px-2 py-1.5 text-sm font-mono text-right rounded border border-border bg-background focus:outline-none focus:ring-1 focus:ring-ring"})]})]})]})}function X(){const{data:a,isLoading:r,error:n}=L(),d=A();if(r)return e.jsx(k,{message:"Loading settings..."});if(n)return e.jsx(F,{message:n.message});if(!a)return null;const{pricing:i,etl_status:l,db_stats:o,version:u}=a,x=t=>t<1024?`${t} B`:t<1048576?`${(t/1024).toFixed(1)} KB`:`${(t/1048576).toFixed(1)} MB`;return e.jsxs(C,{title:"Settings",subtitle:"Pricing, display preferences, and data management",children:[u&&e.jsxs("div",{className:"mb-6 text-sm text-muted-foreground",children:["CCWAP v",u]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Model Pricing (per million tokens)"}),e.jsx(O,{pricing:i})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"ETL Status"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Files Processed"}),e.jsxs("span",{className:"font-mono",children:[l.files_processed," / ",l.files_total]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Run"}),e.jsx("span",{className:"font-mono",children:l.last_run||"Never"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Database Size"}),e.jsx("span",{className:"font-mono",children:x(l.database_size_bytes)})]})]}),e.jsxs("button",{onClick:()=>d.mutate(),disabled:d.isPending,className:"mt-4 flex items-center gap-2 px-3 py-2 text-sm rounded-md border border-border hover:bg-accent disabled:opacity-50",children:[e.jsx(S,{className:`h-4 w-4 ${d.isPending?"animate-spin":""}`}),d.isPending?"Rebuilding...":"Rebuild Database"]}),d.isSuccess&&e.jsx("p",{className:"mt-2 text-xs text-green-500",children:"Rebuild complete"}),d.isError&&e.jsx("p",{className:"mt-2 text-xs text-red-400",children:"Rebuild failed"})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Database Statistics"}),e.jsx("div",{className:"space-y-2 text-sm",children:Object.entries(o).map(([t,s])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground capitalize",children:t.replace(/_/g," ")}),e.jsx("span",{className:"font-mono",children:P(s)})]},t))})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(V,{})}),e.jsx("div",{className:"mb-6",children:e.jsx(q,{})}),e.jsx("div",{className:"mb-6",children:e.jsx(B,{})})]})}export{X as default};
