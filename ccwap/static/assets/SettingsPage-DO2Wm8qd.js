import{u as Y,c as I,b as G,j as e}from"./query-vendor-ChV-W4bE.js";import{r as n}from"./react-vendor-yhu9f3WU.js";import{P as B}from"./PageLayout-DfUqXGNp.js";import{m as O,s as q,i as A,g as _,B as m,R as X,f as Z,k as E}from"./index-DJRpnyjL.js";import{E as ee}from"./ErrorState-Cnbe0SU1.js";import{C as w,a as C,b as y,c as k,d as se,e as D}from"./card-ClagOsYo.js";import{I as p}from"./input-CCeci3Va.js";import{B as R}from"./badge-DItZaj-O.js";import{S}from"./skeleton-DoFMmdLy.js";import{T as te,a as ae,b as P,c as v,d as re,e as d}from"./table-BOi6on67.js";import{P as H,T as le}from"./trash-2-AmMwXlba.js";import{D as V}from"./download-Ci4CM7zw.js";import"./chart-vendor-Dwd1Lo9s.js";const ne=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],ie=O("bell",ne);const ce=[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]],z=O("save",ce);function oe(){return Y({queryKey:q.all,queryFn:()=>A("/settings")})}function de(){const i=G();return I({mutationFn:t=>A("/settings/pricing",{method:"PUT",body:JSON.stringify(t)}),onSuccess:()=>i.invalidateQueries({queryKey:q.all})})}function me(){return I({mutationFn:()=>A("/settings/rebuild",{method:"POST"})})}const M={input:0,output:0,cache_read:0,cache_write_5m:0,cache_write_1h:0};function xe({pricing:i}){const t=de(),[c,x]=n.useState(null),[r,j]=n.useState({...M}),[a,g]=n.useState(!1),[h,f]=n.useState(""),[s,u]=n.useState({...M}),[F,N]=n.useState(null),W=n.useCallback((l,o)=>{g(!1),N(null),x(l),j({...o})},[]),K=n.useCallback(()=>{c&&t.mutate({model:c,pricing:r},{onSuccess:()=>x(null)})},[c,r,t]),T=Object.entries(i).sort((l,o)=>l[0].localeCompare(o[0])),Q=n.useCallback(()=>{x(null),N(null),f(""),u({...M}),g(!0)},[]),$=n.useCallback(()=>{N(null),f(""),u({...M}),g(!1)},[]),L=n.useCallback(()=>{const l=h.trim();if(!l){N("Model name is required.");return}if(T.some(([b])=>b.toLowerCase()===l.toLowerCase())){N("Model already exists. Use Edit.");return}N(null),t.mutate({model:l,pricing:s},{onSuccess:()=>$()})},[$,T,h,s,t]);return e.jsxs("div",{className:"rounded-md border border-border overflow-hidden",children:[e.jsx("div",{className:"flex justify-end gap-2 border-b border-border p-3",children:a?e.jsxs(e.Fragment,{children:[e.jsx(m,{variant:"ghost",size:"sm",onClick:$,disabled:t.isPending,children:"Cancel"}),e.jsxs(m,{size:"sm",onClick:L,disabled:t.isPending||!h.trim(),children:[e.jsx(z,{className:"mr-1.5 h-4 w-4"}),"Save Model"]})]}):e.jsxs(m,{variant:"outline",size:"sm",onClick:Q,disabled:t.isPending,children:[e.jsx(H,{className:"mr-1.5 h-4 w-4"}),"Add Model"]})}),e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(P,{children:[e.jsx(v,{children:"Model"}),e.jsx(v,{className:"text-right",children:"Input $/M"}),e.jsx(v,{className:"text-right",children:"5m Write $/M"}),e.jsx(v,{className:"text-right",children:"1h Write $/M"}),e.jsx(v,{className:"text-right",children:"Hits/Refresh $/M"}),e.jsx(v,{className:"text-right",children:"Output $/M"}),e.jsx(v,{className:"text-right",children:"Actions"})]})}),e.jsxs(re,{children:[a&&e.jsxs(P,{children:[e.jsx(d,{children:e.jsx(p,{type:"text",value:h,onChange:l=>f(l.target.value),placeholder:"claude-model-name",className:"font-mono text-xs"})}),["input","cache_write_5m","cache_write_1h","cache_read","output"].map(l=>e.jsx(d,{children:e.jsx(p,{type:"number",step:"0.01",value:s[l],onChange:o=>u(b=>({...b,[l]:parseFloat(o.target.value)||0})),className:"w-full text-right font-mono text-sm"})},`new-${l}`)),e.jsx(d,{className:"text-right",children:e.jsx(m,{variant:"ghost",size:"icon",onClick:L,disabled:t.isPending||!h.trim(),children:e.jsx(z,{className:"h-4 w-4"})})})]}),a&&F&&e.jsx(P,{children:e.jsx(d,{colSpan:7,className:"text-xs text-destructive",children:F})}),T.map(([l,o])=>e.jsxs(P,{children:[e.jsx(d,{className:"font-mono text-xs",children:l}),c===l?e.jsxs(e.Fragment,{children:[["input","cache_write_5m","cache_write_1h","cache_read","output"].map(b=>e.jsx(d,{children:e.jsx(p,{type:"number",step:"0.01",value:r[b],onChange:J=>j(U=>({...U,[b]:parseFloat(J.target.value)||0})),className:"w-full text-right font-mono text-sm"})},b)),e.jsx(d,{className:"text-right",children:e.jsx(m,{variant:"ghost",size:"icon",onClick:K,disabled:t.isPending,children:e.jsx(z,{className:"h-4 w-4"})})})]}):e.jsxs(e.Fragment,{children:[e.jsxs(d,{className:"font-mono text-right",children:["$",o.input.toFixed(2)]}),e.jsxs(d,{className:"font-mono text-right",children:["$",o.cache_write_5m.toFixed(2)]}),e.jsxs(d,{className:"font-mono text-right",children:["$",o.cache_write_1h.toFixed(2)]}),e.jsxs(d,{className:"font-mono text-right",children:["$",o.cache_read.toFixed(2)]}),e.jsxs(d,{className:"font-mono text-right",children:["$",o.output.toFixed(2)]}),e.jsx(d,{className:"text-right",children:e.jsx(m,{variant:"link",size:"sm",onClick:()=>W(l,o),children:"Edit"})})]})]},l))]})]})]})}function he(){const i=n.useCallback(t=>{window.open(`/api/settings/export?format=${t}`,"_blank")},[]);return e.jsxs(w,{children:[e.jsxs(C,{children:[e.jsx(y,{className:"text-sm",children:"Full Database Export"}),e.jsx(D,{children:"Download a complete export of your database in CSV or JSON format."})]}),e.jsx(k,{children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>i("csv"),children:[e.jsx(V,{className:"mr-1.5 h-4 w-4"}),"Export CSV"]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>i("json"),children:[e.jsx(V,{className:"mr-1.5 h-4 w-4"}),"Export JSON"]})]})})]})}function ue(){const[i,t]=E("ccwap:custom-presets",[]),[c,x]=n.useState(""),[r,j]=n.useState(""),[a,g]=n.useState(""),h=n.useCallback(()=>{!c.trim()||!r||!a||(t(s=>[...s,{label:c.trim(),from:r,to:a}]),x(""),j(""),g(""))},[c,r,a,t]),f=n.useCallback(s=>{t(u=>u.filter((F,N)=>N!==s))},[t]);return e.jsxs(w,{children:[e.jsxs(C,{children:[e.jsx(y,{className:"text-sm",children:"Custom Date Presets"}),e.jsx(D,{children:"Create custom date range presets for quick access in the date picker."})]}),e.jsxs(k,{children:[i.length>0&&e.jsx("div",{className:"space-y-2 mb-4",children:i.map((s,u)=>e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 rounded-md bg-muted/50 border border-border",children:[e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:s.label}),e.jsxs("span",{className:"text-muted-foreground ml-2",children:[s.from," to ",s.to]})]}),e.jsx(m,{variant:"ghost",size:"icon",onClick:()=>f(u),className:"text-muted-foreground hover:text-destructive",children:e.jsx(le,{className:"h-4 w-4"})})]},u))}),i.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground italic mb-4",children:"No custom presets defined."}),e.jsxs("div",{className:"flex flex-wrap gap-2 items-end",children:[e.jsxs("div",{className:"flex-1 min-w-[140px]",children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Label"}),e.jsx(p,{type:"text",value:c,onChange:s=>x(s.target.value),placeholder:"e.g. Q1 2026"})]}),e.jsxs("div",{className:"min-w-[140px]",children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"From"}),e.jsx(p,{type:"date",value:r,onChange:s=>j(s.target.value)})]}),e.jsxs("div",{className:"min-w-[140px]",children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"To"}),e.jsx(p,{type:"date",value:a,onChange:s=>g(s.target.value)})]}),e.jsxs(m,{onClick:h,disabled:!c.trim()||!r||!a,size:"sm",children:[e.jsx(H,{className:"mr-1 h-4 w-4"}),"Add"]})]})]})]})}function je(){const[i,t]=E("ccwap:alert-daily-cost",0),[c,x]=E("ccwap:alert-weekly-cost",0),[r,j]=E("ccwap:alert-error-rate",0);return e.jsxs(w,{children:[e.jsxs(C,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),e.jsx(y,{className:"text-sm",children:"Notification Thresholds"})]}),e.jsx(D,{children:"Set alert thresholds for cost and error monitoring. A value of 0 means no alert."})]}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm text-muted-foreground w-48",children:"Daily Cost Alert ($)"}),e.jsx(p,{type:"number",min:"0",step:"0.01",value:i,onChange:a=>t(parseFloat(a.target.value)||0),className:"w-32 text-right font-mono"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm text-muted-foreground w-48",children:"Weekly Cost Alert ($)"}),e.jsx(p,{type:"number",min:"0",step:"0.01",value:c,onChange:a=>x(parseFloat(a.target.value)||0),className:"w-32 text-right font-mono"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm text-muted-foreground w-48",children:"Error Rate Alert (%)"}),e.jsx(p,{type:"number",min:"0",max:"100",step:"0.1",value:r,onChange:a=>j(parseFloat(a.target.value)||0),className:"w-32 text-right font-mono"})]})]})})]})}function Me(){const{data:i,isLoading:t,error:c,refetch:x}=oe(),r=me();if(t)return e.jsxs(B,{title:"Settings",subtitle:"Pricing, display preferences, and data management",children:[e.jsx(S,{className:"h-4 w-32 mb-6"}),e.jsx(S,{className:"h-64 w-full mb-6"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(S,{className:"h-48 w-full"}),e.jsx(S,{className:"h-48 w-full"})]})]});if(c)return e.jsx(ee,{message:c.message,onRetry:()=>x()});if(!i)return null;const{pricing:j,etl_status:a,db_stats:g,version:h}=i,f=s=>s<1024?`${s} B`:s<1048576?`${(s/1024).toFixed(1)} KB`:`${(s/1048576).toFixed(1)} MB`;return e.jsxs(B,{title:"Settings",subtitle:"Pricing, display preferences, and data management",children:[h&&e.jsxs(R,{variant:"secondary",className:"mb-6",children:["CCWAP v",h]}),e.jsxs(w,{className:"mb-6",children:[e.jsx(C,{children:e.jsx(y,{className:"text-sm",children:"Model Pricing (per million tokens)"})}),e.jsx(k,{children:e.jsx(xe,{pricing:j})})]}),e.jsx(_,{className:"my-6"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(w,{children:[e.jsx(C,{children:e.jsx(y,{className:"text-sm",children:"ETL Status"})}),e.jsx(k,{children:e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Files Processed"}),e.jsxs("span",{className:"font-mono",children:[a.files_processed," / ",a.files_total]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Last Run"}),e.jsx("span",{className:"font-mono",children:a.last_run||"Never"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Database Size"}),e.jsx("span",{className:"font-mono",children:f(a.database_size_bytes)})]})]})}),e.jsxs(se,{className:"flex-col items-start gap-2",children:[e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>r.mutate(),disabled:r.isPending,children:[e.jsx(X,{className:`mr-1.5 h-4 w-4 ${r.isPending?"animate-spin":""}`}),r.isPending?"Rebuilding...":"Rebuild Database"]}),r.isSuccess&&e.jsx(R,{variant:"secondary",className:"text-green-500",children:"Rebuild complete"}),r.isError&&e.jsx(R,{variant:"destructive",children:"Rebuild failed"})]})]}),e.jsxs(w,{children:[e.jsx(C,{children:e.jsx(y,{className:"text-sm",children:"Database Statistics"})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-2 text-sm",children:Object.entries(g).map(([s,u])=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground capitalize",children:s.replace(/_/g," ")}),e.jsx("span",{className:"font-mono",children:Z(u)})]},s))})})]})]}),e.jsx(_,{className:"my-6"}),e.jsx("div",{className:"mb-6",children:e.jsx(he,{})}),e.jsx(_,{className:"my-6"}),e.jsx("div",{className:"mb-6",children:e.jsx(ue,{})}),e.jsx(_,{className:"my-6"}),e.jsx("div",{className:"mb-6",children:e.jsx(je,{})})]})}export{Me as default};
