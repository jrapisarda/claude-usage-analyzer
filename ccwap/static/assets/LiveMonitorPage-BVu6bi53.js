import{j as e}from"./query-vendor-ChV-W4bE.js";import{r as n}from"./react-vendor-yhu9f3WU.js";import{P as A}from"./PageLayout-CKQ82rM8.js";import{u as T}from"./dashboard-Hug786eG.js";import{M as L,a as x}from"./MetricCardGrid-DAgrh55f.js";import{C as W}from"./ChartContainer-DT93XJhW.js";import{E as M}from"./EmptyState-DntujhHL.js";import{m as _,a as D,d as C,f as j,e as O}from"./index-Bpa7eUOS.js";import{B as v}from"./badge-Cn-RNLir.js";import{C as k,a as P,b as I,c as z}from"./card-BPiuFm8S.js";import{A as F,b as G}from"./chart-vendor-CnSh9PGG.js";import"./skeleton-DdhmaHDM.js";const $=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],S=_("activity",$);const B=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],V=_("wifi-off",B);const q=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],H=_("wifi",q),w=100,J=3e4,K=1e3,U=3e4;function X(s){const[u,r]=n.useState("disconnected"),[p,c]=n.useState(null),[i,l]=n.useState([]),a=n.useRef(null),m=n.useRef(null),h=n.useRef(null),g=n.useRef(0),d=n.useRef(!0),t=n.useCallback(()=>{if(d.current)try{const o=new WebSocket(s);a.current=o,r("connecting"),o.onopen=()=>{d.current&&(r("connected"),g.current=0,m.current=setInterval(()=>{o.readyState===WebSocket.OPEN&&o.send("ping")},J))},o.onmessage=R=>{if(d.current)try{const N=JSON.parse(R.data);if(N.type==="pong")return;c(N),l(E=>{const b=[N,...E];return b.length>w?b.slice(0,w):b})}catch{}},o.onclose=()=>{d.current&&(f(),r("disconnected"),y())},o.onerror=()=>{d.current&&r("error")}}catch{r("error"),y()}},[s]),f=n.useCallback(()=>{m.current&&(clearInterval(m.current),m.current=null),a.current&&(a.current.onopen=null,a.current.onmessage=null,a.current.onclose=null,a.current.onerror=null,a.current=null)},[]),y=n.useCallback(()=>{if(!d.current)return;const o=Math.min(K*Math.pow(2,g.current),U);g.current++,h.current=setTimeout(()=>{d.current&&t()},o)},[t]);return n.useEffect(()=>{d.current=!0,t();const o=()=>{document.hidden||a.current?.readyState!==WebSocket.OPEN&&t()};return document.addEventListener("visibilitychange",o),()=>{d.current=!1,document.removeEventListener("visibilitychange",o),h.current&&clearTimeout(h.current),f(),a.current?.readyState===WebSocket.OPEN&&a.current.close()}},[t,f]),{status:u,lastMessage:p,messages:i}}function Q({targetCost:s,className:u}){const[r,p]=n.useState(s),c=n.useRef(void 0),i=n.useRef(s);return i.current=s,n.useEffect(()=>{let l=r;const a=()=>{const m=i.current-l;Math.abs(m)<5e-5?l=i.current:l+=m*.1,p(l),c.current=requestAnimationFrame(a)};return c.current=requestAnimationFrame(a),()=>{c.current&&cancelAnimationFrame(c.current)}},[]),e.jsx("span",{className:C("font-mono tabular-nums text-2xl",u),children:D(r)})}function Y({projectDisplay:s,gitBranch:u,className:r}){return e.jsxs("div",{className:C("flex items-center gap-2 px-3 py-1.5 rounded-md bg-green-500/10 border border-green-500/30",r),children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",children:s}),u&&e.jsx("span",{className:"text-xs text-muted-foreground font-mono",children:u})]})}function Z(){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/live`}function ee(){const s=new Date().toISOString().split("T")[0];return{from:s,to:s}}function fe(){const{status:s,lastMessage:u,messages:r}=X(Z()),{data:p}=T(ee()),c=n.useMemo(()=>r.filter(t=>t.type==="etl_update"),[r]),i=n.useMemo(()=>r.find(t=>t.type==="daily_cost_update"),[r]),l=n.useMemo(()=>r.find(t=>t.type==="active_session"),[r]),a=n.useMemo(()=>{let t=0,f=0,y=0;for(const o of c)t+=o.turns_inserted||0,f+=o.tool_calls_inserted||0,y+=o.files_processed||0;return{turns:t,toolCalls:f,files:y}},[c]),m=n.useMemo(()=>c.slice(0,30).reverse().map((t,f)=>({i:f,turns:t.turns_inserted||0})),[c]),h=s==="connected"?"text-green-500":s==="connecting"?"text-yellow-500":"text-red-400",g=s==="connected"?H:V,d=s==="connected"?"default":s==="connecting"?"secondary":"destructive";return e.jsxs(A,{title:"Live Monitor",subtitle:"Real-time session tracking",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:C("flex items-center gap-2 text-sm",h),children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx(v,{variant:d,className:"capitalize",children:s}),s==="connected"&&u&&e.jsxs("span",{className:"text-muted-foreground ml-2 text-xs",children:["Last update: ",u.timestamp?new Date(u.timestamp).toLocaleTimeString():"N/A"]})]}),l&&l.project_display&&e.jsx(Y,{projectDisplay:l.project_display,gitBranch:l.git_branch})]}),s!=="connected"?e.jsx(M,{icon:e.jsx(S,{className:"h-12 w-12"}),title:s==="connecting"?"Connecting...":"Disconnected",message:s==="connecting"?"Establishing WebSocket connection to the server...":"WebSocket connection lost. Reconnecting automatically..."}):e.jsxs(e.Fragment,{children:[e.jsxs(L,{className:"mb-6",children:[e.jsxs(k,{className:"p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-1",children:"Cost Today"}),e.jsx(Q,{targetCost:i?.cost_today??p?.vitals.cost??0}),i&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[i.sessions_today," session",i.sessions_today!==1?"s":""]})]}),e.jsx(x,{title:"Sessions Today",value:j(i?.sessions_today??p?.vitals.sessions??0)}),e.jsx(x,{title:"Messages Today",value:j(p?.vitals.messages??0)}),e.jsx(x,{title:"Error Rate",value:p?.vitals.error_rate!=null?`${(p.vitals.error_rate*100).toFixed(1)}%`:"0.0%"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(x,{title:"Turns Received",value:j(a.turns)}),e.jsx(x,{title:"Tool Calls",value:j(a.toolCalls)}),e.jsx(x,{title:"Files Processed",value:j(a.files)})]}),m.length>1&&e.jsx(W,{title:"Recent Activity (turns/update)",height:80,className:"mb-6",children:e.jsxs(F,{data:m,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"liveGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-2)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-2)",stopOpacity:0})]})}),e.jsx(G,{type:"monotone",dataKey:"turns",stroke:"var(--color-chart-2)",fill:"url(#liveGrad)",strokeWidth:2,isAnimationActive:!1})]})}),e.jsxs(k,{children:[e.jsx(P,{children:e.jsx(I,{className:"text-sm font-medium text-muted-foreground",children:"Event Log"})}),e.jsx(z,{children:c.length===0?e.jsx(M,{icon:e.jsx(S,{className:"h-8 w-8 animate-pulse"}),message:"Waiting for activity... Start a Claude Code session to see live updates"}):e.jsx(O,{className:"h-96",children:e.jsx("div",{className:"space-y-1",children:c.map((t,f)=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-accent/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 shrink-0"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.timestamp?new Date(t.timestamp).toLocaleTimeString():""})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs font-mono",children:[(t.files_processed??0)>0&&e.jsxs(v,{variant:"outline",children:[t.files_processed," files"]}),(t.turns_inserted??0)>0&&e.jsxs(v,{variant:"outline",children:[t.turns_inserted," turns"]}),(t.tool_calls_inserted??0)>0&&e.jsxs(v,{variant:"outline",children:[t.tool_calls_inserted," tool calls"]})]})]},f))})})})]})]})]})}export{fe as default};
