import{u as H,j as e}from"./query-vendor-ChV-W4bE.js";import{r as i}from"./react-vendor-yhu9f3WU.js";import{r as T,h as D,i as M,u as E,a as S,f as L}from"./index-Bpa7eUOS.js";import{P as N}from"./PageLayout-CKQ82rM8.js";import{M as $,a as m}from"./MetricCardGrid-DAgrh55f.js";import{E as V}from"./ErrorState-DjaCiOCU.js";import{E as _}from"./ExportDropdown-DnSuL1-6.js";import{H as w}from"./HeatmapGrid-D8YUSNDW.js";import{C as A,a as P,b as R,c as F}from"./card-BPiuFm8S.js";import{T as q,a as G,b as I}from"./tabs-F-Ltb0QW.js";import"./chart-vendor-CnSh9PGG.js";import"./skeleton-DdhmaHDM.js";import"./index-CW8GAOI9.js";import"./index-DHRk0rsW.js";import"./check-CQsps3zJ.js";import"./download-C-raSRr6.js";function K(s,r){return H({queryKey:T.data(s,r),queryFn:()=>D(`/heatmap${M({from:s.from,to:s.to,metric:r})}`)})}const Q=["sessions","cost","loc","tool_calls"],p={sessions:"Sessions",cost:"Cost",loc:"Lines of Code",tool_calls:"Tool Calls"},d=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],B=Array.from({length:24},(s,r)=>`${r}`);function ua(){const{dateRange:s}=E(),[r,y]=i.useState("sessions"),{data:t,isLoading:f,error:x,refetch:j}=K(s,r),o=i.useMemo(()=>r==="cost"?a=>S(a):a=>L(a),[r]),b=i.useMemo(()=>t?t.cells.filter(a=>a.day>=0&&a.day<7&&a.hour>=0&&a.hour<24).map(a=>({row:a.day,col:a.hour,value:a.value})):[],[t]),{total:v,peakDay:C,peakHour:g,peakVal:h}=i.useMemo(()=>{if(!t||t.cells.length===0)return{total:0,peakDay:0,peakHour:0,peakVal:0};let a=0,u=0,n=0,c=0;for(const l of t.cells)a+=l.value,l.value>c&&(c=l.value,u=l.day,n=l.hour);return{total:a,peakDay:u,peakHour:n,peakVal:c}},[t]),k=i.useCallback(()=>t?t.cells.map(a=>({day:d[a.day]||a.day,hour:a.hour,value:a.value,metric:r})):[],[t,r]);return x?e.jsx(V,{message:x.message,onRetry:()=>j()}):e.jsxs(N,{title:"Activity Heatmap",subtitle:"Hourly activity patterns across days of the week",actions:e.jsx(_,{page:"heatmap",getData:k}),children:[e.jsx(q,{value:r,onValueChange:a=>y(a),className:"mb-6",children:e.jsx(G,{children:Q.map(a=>e.jsx(I,{value:a,children:p[a]},a))})}),e.jsxs(A,{className:"mb-4",children:[e.jsx(P,{className:"pb-2",children:e.jsxs(R,{className:"text-sm font-medium text-muted-foreground",children:[p[r]," by Day & Hour"]})}),e.jsx(F,{children:f?e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):t?e.jsx(w,{data:b,rowLabels:d,colLabels:B,maxValue:t.max_value,formatValue:o,formatTooltip:(a,u,n)=>`${a} ${u}:00 - ${o(n)}`}):null})]}),e.jsx($,{skeleton:f,count:4,children:t&&e.jsxs(e.Fragment,{children:[e.jsx(m,{title:`Total ${p[r]}`,value:o(v)}),e.jsx(m,{title:"Peak Day",value:d[C]||"N/A",subtitle:o(h)}),e.jsx(m,{title:"Peak Hour",value:`${g}:00`,subtitle:o(h)}),e.jsx(m,{title:"Max Cell",value:o(t.max_value)})]})})]})}export{ua as default};
