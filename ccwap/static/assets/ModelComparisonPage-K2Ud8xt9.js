import{u as q,j as e}from"./query-vendor-ChV-W4bE.js";import{r as i}from"./react-vendor-yhu9f3WU.js";import{r as U,i as Y,j as I,u as X,f as g,a as y}from"./index-DCX10x8R.js";import{P as Z}from"./PageLayout-DpNVgws2.js";import{M as H,a as _}from"./MetricCardGrid-CkxpAq0G.js";import{C as M}from"./ChartContainer-BU7sgYBD.js";import{D as Q}from"./DataTable-BhI4kP-j.js";import{E as W}from"./ErrorState-xs03gdYo.js";import{E as B}from"./ExportDropdown-C33ixUcc.js";import{T as V,a as J,b as T,c as S}from"./tabs-jQjykS5e.js";import{f as ee,A as x,C as l,T as N}from"./chartConfig-CHOlO3Nn.js";import{l as te,m as se,n as oe,o as ae,p as re,L as w,T as A,S as ne,X as P,Y as z,Z as le,q as ie,A as ce,b as de}from"./chart-vendor-CnSh9PGG.js";import"./skeleton-B0hp-ihd.js";import"./table-BAjcSz7P.js";import"./index-DsmW-0bT.js";import"./index-B8m4KhFQ.js";import"./check-BxFiCOSl.js";import"./download-BMSCv_PW.js";function me(a){return q({queryKey:U.data(a),queryFn:()=>Y(`/models${I({from:a.from,to:a.to})}`)})}function h(a,s,c){const d=[...a];return d.sort((v,C)=>{const m=v[s],p=C[s];return typeof m=="string"&&typeof p=="string"?p.localeCompare(m):p-m}),d}const pe=[{accessorKey:"model",header:"Model",cell:({row:a})=>e.jsx("span",{className:"font-medium truncate max-w-[200px] block",children:a.original.model})},{accessorKey:"sessions",header:()=>e.jsx("span",{className:"text-right block",children:"Sessions"}),cell:({row:a})=>e.jsx("span",{className:"font-mono text-right block",children:g(a.original.sessions)})},{accessorKey:"turns",header:()=>e.jsx("span",{className:"text-right block",children:"Turns"}),cell:({row:a})=>e.jsx("span",{className:"font-mono text-right block",children:g(a.original.turns)})},{accessorKey:"total_cost",header:()=>e.jsx("span",{className:"text-right block",children:"Cost"}),cell:({row:a})=>e.jsx("span",{className:"font-mono text-right block",children:y(a.original.total_cost)})},{accessorKey:"avg_turn_cost",header:()=>e.jsx("span",{className:"text-right block",children:"Avg Turn Cost"}),cell:({row:a})=>e.jsx("span",{className:"font-mono text-right block",children:y(a.original.avg_turn_cost)})},{accessorKey:"loc_written",header:()=>e.jsx("span",{className:"text-right block",children:"LOC"}),cell:({row:a})=>e.jsx("span",{className:"font-mono text-right block",children:g(a.original.loc_written)})}];function Ke(){const{dateRange:a}=X(),{data:s,isLoading:c,error:d,refetch:v}=me(a),[C,m]=i.useState("radar"),p=i.useMemo(()=>s?h(s.models,"total_cost"):[],[s]),L=i.useMemo(()=>{if(!s||s.models.length===0)return[];const t=h(s.models,"sessions").slice(0,4);return[{axis:"Sessions",getter:r=>r.sessions,invert:!1},{axis:"Cost",getter:r=>r.total_cost,invert:!0},{axis:"Tokens",getter:r=>r.total_input_tokens+r.total_output_tokens,invert:!1},{axis:"Thinking",getter:r=>r.avg_thinking_chars,invert:!1},{axis:"LOC",getter:r=>r.loc_written,invert:!1}].map(r=>{const n=t.map(j=>r.getter(j)),f=Math.min(...n),O=Math.max(...n)-f,D={axis:r.axis};for(const j of t){const G=r.getter(j),R=O===0?50:(G-f)/O*100;D[j.model]=Math.round(r.invert?100-R:R)}return D})},[s]),K=i.useMemo(()=>s?h(s.models,"sessions").slice(0,4).map(t=>t.model):[],[s]),u=i.useMemo(()=>{if(!s)return{points:[],models:[]};const t=[...new Set(s.usage_trend.map(n=>n.model))],o=new Map;for(const n of s.usage_trend)o.has(n.date)||o.set(n.date,{date:n.date}),o.get(n.date)[n.model]=n.count;return{points:ee([...o.values()].sort((n,f)=>n.date.localeCompare(f.date)),t),models:t}},[s]),E=i.useMemo(()=>{if(!s)return new Map;const t=new Map;for(const o of s.scatter)t.has(o.model)||t.set(o.model,[]),t.get(o.model).push({cost:o.cost,loc_written:o.loc_written});return t},[s]),$=i.useCallback(()=>s?s.models.map(t=>({model:t.model,sessions:t.sessions,turns:t.turns,total_cost:t.total_cost,avg_turn_cost:t.avg_turn_cost,loc_written:t.loc_written})):[],[s]);if(d)return e.jsx(W,{message:d.message,onRetry:()=>v()});const F=s?.models.length??0,b=s&&s.models.length>0?h(s.models,"sessions")[0]:null,k=s&&s.models.length>0?h(s.models,"total_cost")[0]:null;return e.jsxs(Z,{title:"Model Comparison",subtitle:"Compare performance and cost across models",actions:e.jsx(B,{page:"model-comparison",getData:$}),children:[e.jsx(H,{skeleton:c,count:3,className:"grid-cols-2 lg:grid-cols-3 mb-6",children:s&&e.jsxs(e.Fragment,{children:[e.jsx(_,{title:"Total Models",value:String(F)}),e.jsx(_,{title:"Most Used",value:b?.model||"N/A",subtitle:b?`${g(b.sessions)} sessions`:void 0}),e.jsx(_,{title:"Highest Cost",value:k?.model||"N/A",subtitle:k?y(k.total_cost):void 0})]})}),e.jsx("div",{className:"mb-6",children:e.jsx(Q,{columns:pe,data:p,isLoading:c,emptyMessage:"No model data available"})}),e.jsxs(V,{value:C,onValueChange:m,className:"mb-6",children:[e.jsxs(J,{children:[e.jsx(T,{value:"radar",children:"Radar"}),e.jsx(T,{value:"scatter",children:"Cost vs LOC"}),e.jsx(T,{value:"trend",children:"Usage Trend"})]}),e.jsx(S,{value:"radar",children:e.jsx(M,{title:"Model Comparison (Top 4) - Normalized metrics (0-100)",height:288,isLoading:c,isEmpty:L.length===0||K.length===0,emptyMessage:"Not enough data for radar comparison",children:e.jsxs(te,{data:L,children:[e.jsx(se,{stroke:"var(--color-border)"}),e.jsx(oe,{dataKey:"axis",tick:x}),e.jsx(ae,{tick:!1,domain:[0,100],axisLine:!1}),K.map((t,o)=>e.jsx(re,{name:t,dataKey:t,stroke:l[o%l.length],fill:l[o%l.length],fillOpacity:.15,strokeWidth:2},t)),e.jsx(w,{wrapperStyle:{fontSize:"11px"}}),e.jsx(A,{contentStyle:N})]})})}),e.jsx(S,{value:"scatter",children:e.jsx(M,{title:"Cost vs LOC per Session - Each point is a session",height:288,isLoading:c,isEmpty:E.size===0,emptyMessage:"No scatter data available",children:e.jsxs(ne,{children:[e.jsx(P,{type:"number",dataKey:"cost",name:"Cost",tick:x,tickFormatter:t=>`$${t}`,stroke:"var(--color-muted-foreground)"}),e.jsx(z,{type:"number",dataKey:"loc_written",name:"LOC",tick:x,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(le,{range:[30,30]}),e.jsx(A,{contentStyle:N,formatter:(t,o)=>[o==="Cost"?y(t??0):g(t??0),o??""]}),e.jsx(w,{wrapperStyle:{fontSize:"11px"}}),[...E.entries()].map(([t,o],r)=>e.jsx(ie,{name:t,data:o,fill:l[r%l.length],opacity:.7},t))]})})}),e.jsx(S,{value:"trend",children:e.jsx(M,{title:"Model Usage Over Time - Sessions per day by model",height:288,isLoading:c,isEmpty:u.points.length===0,emptyMessage:"No usage trend data available",children:e.jsxs(ce,{data:u.points,children:[e.jsx("defs",{children:u.models.map((t,o)=>e.jsxs("linearGradient",{id:`modelGrad-${o}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:l[o%l.length],stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:l[o%l.length],stopOpacity:.05})]},t))}),e.jsx(P,{dataKey:"date",tick:x,tickFormatter:t=>t.slice(5),stroke:"var(--color-muted-foreground)"}),e.jsx(z,{tick:x,stroke:"var(--color-muted-foreground)",width:40}),e.jsx(A,{contentStyle:N}),e.jsx(w,{wrapperStyle:{fontSize:"11px"}}),u.models.map((t,o)=>e.jsx(de,{type:"monotone",dataKey:t,stackId:"1",stroke:l[o%l.length],fill:`url(#modelGrad-${o})`,strokeWidth:1.5,isAnimationActive:u.points.length<365},t))]})})})]})]})}export{Ke as default};
