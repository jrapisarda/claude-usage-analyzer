import{u as D,j as e}from"./query-vendor-DAETOSEH.js";import{P as B}from"./PageLayout-DEtLmFLB.js";import{i as T,g as $,h as K,a as r,b as w,u as G,L as q}from"./index-DZMFuYgm.js";import{E as W}from"./ErrorState-xqkb_4mP.js";import{M as _}from"./MetricCard-BoawkqIY.js";import{E as I}from"./ExportDropdown-B2A0w648.js";import{r as C}from"./react-vendor-CGr-4ZyM.js";import{u as M}from"./useLocalStorage-iD_z970y.js";import{T as O}from"./chartConfig-CHOlO3Nn.js";import{b as v,A as z,X as N,Y as k,T as y,d as E,P as Y,f as H,C as Q,B as R,e as P,g as L,h as X}from"./chart-vendor-Df4oWUqu.js";import"./download-Bat12fqC.js";function J(s){return D({queryKey:T.data(s),queryFn:()=>$(`/cost${K({from:s.from,to:s.to})}`)})}function U(s){return D({queryKey:T.anomalies(s),queryFn:()=>$(`/cost/anomalies${K({from:s.from,to:s.to})}`)})}function V(s){return D({queryKey:T.cumulative(s),queryFn:()=>$(`/cost/cumulative${K({from:s.from,to:s.to})}`)})}function Z(s,o){return D({queryKey:T.cacheSimulation(s,o),queryFn:()=>$(`/cost/cache-simulation${K({target_hit_rate:s,from:o.from,to:o.to})}`)})}function ee({spent:s}){const[o,b]=M("ccwap:monthly-budget",0),[a,d]=C.useState(!1),[c,x]=C.useState(""),n=C.useRef(null);C.useEffect(()=>{a&&n.current&&(n.current.focus(),n.current.select())},[a]);const u=()=>{x(o>0?o.toString():""),d(!0)},h=()=>{const t=parseFloat(c);!isNaN(t)&&t>=0&&b(t),d(!1)},g=t=>{t.key==="Enter"&&h(),t.key==="Escape"&&d(!1)},f=o-s,l=o>0?s/o*100:0,i=new Date(new Date().getFullYear(),new Date().getMonth()+1,0).getDate(),m=new Date().getDate(),j=m>0?s/m:0,p=j*i,A=l>90?"bg-red-500":l>70?"bg-yellow-500":"bg-green-500";return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Budget Tracker"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Monthly Budget"}),a?e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"text-lg font-mono",children:"$"}),e.jsx("input",{ref:n,type:"number",min:"0",step:"0.01",value:c,onChange:t=>x(t.target.value),onBlur:h,onKeyDown:g,className:"font-mono text-lg w-28 bg-transparent border-b border-border outline-none focus:border-primary"})]}):e.jsx("p",{className:"font-mono text-lg cursor-pointer hover:text-primary transition-colors",onClick:u,title:"Click to edit budget",children:o>0?r(o):"Set budget..."})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Spent"}),e.jsx("p",{className:"font-mono text-lg",children:r(s)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Remaining"}),e.jsx("p",{className:`font-mono text-lg ${o>0&&f<0?"text-red-500":""}`,children:o>0?r(f):"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Burn Rate"}),e.jsxs("p",{className:"font-mono text-lg",children:[r(j),"/day"]}),o>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Projected: ",r(p)]})]})]}),o>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsxs("span",{children:[Math.min(l,100).toFixed(1),"% used"]}),e.jsxs("span",{children:[r(s)," / ",r(o)]})]}),e.jsx("div",{className:"w-full h-3 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${A}`,style:{width:`${Math.min(l,100)}%`}})})]})]})}function te({dateRange:s}){const[o,b]=C.useState(80),{data:a,isLoading:d}=Z(o/100,s);return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Cache What-If Calculator"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Target Cache Hit Rate"}),e.jsxs("span",{className:"font-mono text-sm",children:[o,"%"]})]}),e.jsx("input",{type:"range",min:0,max:100,step:1,value:o,onChange:c=>b(Number(c.target.value)),className:"w-full accent-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"})]})]}),d&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Calculating..."}),a&&e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Actual Cost"}),e.jsx("p",{className:"font-mono text-lg",children:r(a.actual_cost)}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Hit rate: ",w(a.actual_cache_rate)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Simulated Cost"}),e.jsx("p",{className:"font-mono text-lg",children:r(a.simulated_cost)}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Hit rate: ",w(a.simulated_cache_rate)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Savings"}),e.jsx("p",{className:`font-mono text-lg ${a.savings>0?"text-green-500":a.savings<0?"text-red-500":""}`,children:r(a.savings)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Savings %"}),e.jsx("p",{className:`font-mono text-lg ${a.savings>0?"text-green-500":a.savings<0?"text-red-500":""}`,children:a.actual_cost>0?w(a.savings/a.actual_cost):"0.0%"})]})]})]})}const S={input:"var(--color-token-input)",output:"var(--color-token-output)",cache_read:"var(--color-token-cache-read)",cache_write:"var(--color-token-cache-write)"};function ue(){const{dateRange:s}=G(),{data:o,isLoading:b,error:a}=J(s),{data:d}=U(s),{data:c}=V(s),[x]=M("ccwap:monthly-budget",0);if(b)return e.jsx(q,{message:"Loading cost analysis..."});if(a)return e.jsx(W,{message:a.message});if(!o)return null;const{summary:n,by_token_type:u,by_model:h,trend:g,by_project:f,cache_savings:l,forecast:i}=o,m=d?.filter(t=>t.is_anomaly)??[],j=d&&d.length>0?d[0].threshold:0,p=[{name:"Input",value:u.input_cost,color:S.input},{name:"Output",value:u.output_cost,color:S.output},{name:"Cache Read",value:u.cache_read_cost,color:S.cache_read},{name:"Cache Write",value:u.cache_write_cost,color:S.cache_write}].filter(t=>t.value>0),A=i.trend_direction==="increasing"?"up":i.trend_direction==="decreasing"?"down":"neutral";return e.jsxs(B,{title:"Cost Analysis",subtitle:"Detailed cost breakdowns and forecasting",actions:e.jsx(I,{page:"cost",getData:()=>[...g.map(t=>({date:t.date,cost:t.cost})),...h.map(t=>({type:"by_model",model:t.model,cost:t.cost})),...f.map(t=>({type:"by_project",project:t.project_display,cost:t.cost}))]}),children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(_,{title:"Total Cost",value:r(n.total_cost)}),e.jsx(_,{title:"Avg Daily",value:r(n.avg_daily_cost)}),e.jsx(_,{title:"Today",value:r(n.cost_today)}),e.jsx(_,{title:"Projected Monthly",value:r(n.projected_monthly),trend:A})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Spend Forecast"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Daily Avg"}),e.jsx("p",{className:"font-mono text-lg",children:r(i.daily_avg)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"7-Day"}),e.jsx("p",{className:"font-mono text-lg",children:r(i.projected_7d)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"14-Day"}),e.jsx("p",{className:"font-mono text-lg",children:r(i.projected_14d)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"30-Day"}),e.jsx("p",{className:"font-mono text-lg",children:r(i.projected_30d)})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[g.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Cost Trend"}),e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(z,{data:g,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"costTrendGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-1)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-1)",stopOpacity:0})]})}),e.jsx(N,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t.slice(5),stroke:"var(--color-muted-foreground)"}),e.jsx(k,{tick:{fontSize:11},tickFormatter:t=>`$${t}`,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(y,{contentStyle:{backgroundColor:"var(--color-card)",color:"var(--color-card-foreground)",border:"1px solid var(--color-border)",borderRadius:"6px"},formatter:t=>[t!=null?r(t):"","Cost"]}),e.jsx(E,{type:"monotone",dataKey:"cost",stroke:"var(--color-chart-1)",fill:"url(#costTrendGrad)",strokeWidth:2,isAnimationActive:g.length<365})]})})})]}),p.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Cost by Token Type"}),e.jsx("div",{className:"h-48",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(Y,{children:[e.jsx(H,{data:p,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,strokeWidth:0,children:p.map((t,F)=>e.jsx(Q,{fill:t.color},F))}),e.jsx(y,{contentStyle:{backgroundColor:"var(--color-card)",color:"var(--color-card-foreground)",border:"1px solid var(--color-border)",borderRadius:"6px",fontSize:"12px"},formatter:t=>[t!=null?r(t):""]})]})})}),e.jsx("div",{className:"flex flex-wrap gap-3 mt-2",children:p.map(t=>e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),t.name,": ",r(t.value)]},t.name))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[h.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Cost by Model"}),e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(R,{data:h.slice(0,10),layout:"vertical",children:[e.jsx(N,{type:"number",tick:{fontSize:11},tickFormatter:t=>`$${t}`,stroke:"var(--color-muted-foreground)"}),e.jsx(k,{type:"category",dataKey:"model",tick:{fontSize:10},width:120,stroke:"var(--color-muted-foreground)"}),e.jsx(y,{contentStyle:{backgroundColor:"var(--color-card)",color:"var(--color-card-foreground)",border:"1px solid var(--color-border)",borderRadius:"6px",fontSize:"12px"},formatter:t=>[t!=null?r(t):"","Cost"]}),e.jsx(P,{dataKey:"cost",fill:"var(--color-chart-1)",radius:[0,4,4,0]})]})})})]}),f.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Cost by Project (Top 10)"}),e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(R,{data:f.slice(0,10),layout:"vertical",children:[e.jsx(N,{type:"number",tick:{fontSize:11},tickFormatter:t=>`$${t}`,stroke:"var(--color-muted-foreground)"}),e.jsx(k,{type:"category",dataKey:"project_display",tick:{fontSize:10},width:120,stroke:"var(--color-muted-foreground)"}),e.jsx(y,{contentStyle:{backgroundColor:"var(--color-card)",color:"var(--color-card-foreground)",border:"1px solid var(--color-border)",borderRadius:"6px",fontSize:"12px"},formatter:t=>[t!=null?r(t):"","Cost"]}),e.jsx(P,{dataKey:"cost",fill:"var(--color-chart-2)",radius:[0,4,4,0]})]})})})]})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Cache Savings"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Cache Hit Rate"}),e.jsx("p",{className:"font-mono text-lg",children:w(l.cache_hit_rate)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Estimated Savings"}),e.jsx("p",{className:"font-mono text-lg text-green-500",children:r(l.estimated_savings)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Cost w/o Cache"}),e.jsx("p",{className:"font-mono text-lg",children:r(l.cost_without_cache)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Actual Cost"}),e.jsx("p",{className:"font-mono text-lg",children:r(l.actual_cost)})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(ee,{spent:n.cost_this_month})}),d&&d.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Anomaly Detection"}),e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(z,{data:d,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"anomalyGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-1)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-1)",stopOpacity:0})]})}),e.jsx(N,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(k,{tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(y,{contentStyle:O,formatter:t=>[r(t??0),"Cost"]}),e.jsx(E,{type:"monotone",dataKey:"cost",stroke:"var(--color-chart-1)",fill:"url(#anomalyGrad)",strokeWidth:2,isAnimationActive:d.length<365}),j>0&&e.jsx(L,{y:j,stroke:"var(--color-chart-4)",strokeDasharray:"5 5",label:{value:"Threshold",position:"right",fill:"var(--color-muted-foreground)",fontSize:10}}),m.map(t=>e.jsx(X,{x:t.date,y:t.cost,r:5,fill:"var(--color-destructive, #ef4444)",stroke:"none"},t.date))]})})}),m.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:[m.length," anomal",m.length===1?"y":"ies"," detected above ",r(j)," threshold"]})]}),c&&c.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Cumulative Cost"}),e.jsx("div",{className:"h-64",children:e.jsx(v,{width:"100%",height:"100%",children:e.jsxs(z,{data:c,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"cumulativeGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-2)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-2)",stopOpacity:0})]})}),e.jsx(N,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(k,{tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)",width:60}),e.jsx(y,{contentStyle:O,formatter:(t,F)=>[r(t??0),F==="cumulative"?"Cumulative":"Daily"]}),e.jsx(E,{type:"monotone",dataKey:"cumulative",stroke:"var(--color-chart-2)",fill:"url(#cumulativeGrad)",strokeWidth:2,name:"cumulative",isAnimationActive:c.length<365}),x>0&&e.jsx(L,{y:x,stroke:"var(--color-chart-4)",strokeDasharray:"5 5",label:{value:`Budget: ${r(x)}`,position:"right",fill:"var(--color-muted-foreground)",fontSize:10}})]})})})]}),e.jsx("div",{className:"mb-6",children:e.jsx(te,{dateRange:s})})]})}export{ue as default};
