import{j as e}from"./query-vendor-DAETOSEH.js";import{r as n,L as b}from"./react-vendor-CGr-4ZyM.js";import{P as N}from"./PageLayout-DEtLmFLB.js";import{d as v,u as S,S as L,L as E,f as a,a as i,b as h,e as R,c as P}from"./index-DZMFuYgm.js";import{u as D}from"./projects-CXgDD7CH.js";import{E as O}from"./ErrorState-xqkb_4mP.js";import{E as T}from"./EmptyState-D7Ng6sxx.js";import{E as U}from"./ExportDropdown-B2A0w648.js";import{C as F}from"./chevron-up-J1QIQPXH.js";import{C as I}from"./chevron-down-CG6zLN1w.js";import{C as M}from"./chevron-left-CNcf3mbC.js";import{C as $}from"./chevron-right-DICnz5OL.js";import"./chart-vendor-Df4oWUqu.js";import"./download-Bat12fqC.js";const A=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],H=v("chevrons-up-down",A),p=[{key:"sessions",label:"Sessions",format:a,align:"right"},{key:"cost",label:"Cost",format:i,align:"right"},{key:"loc_written",label:"LOC",format:a,align:"right"},{key:"messages",label:"Messages",format:a,align:"right"},{key:"tool_calls",label:"Tool Calls",format:a,align:"right"},{key:"error_rate",label:"Error Rate",format:h,align:"right"},{key:"cost_per_kloc",label:"$/kLOC",format:i,align:"right"},{key:"cache_hit_rate",label:"Cache Hit",format:h,align:"right"}];function W({project:t}){const l=[["Sessions",a(t.sessions)],["Messages",a(t.messages)],["User Turns",a(t.user_turns)],["Duration",P(t.duration_seconds)],["Cost",i(t.cost)],["Avg Turn Cost",i(t.avg_turn_cost)],["Cost/kLOC",i(t.cost_per_kloc)],["Tokens/LOC",a(t.tokens_per_loc)],["LOC Written",a(t.loc_written)],["LOC Delivered",a(t.loc_delivered)],["Lines Added",a(t.lines_added)],["Lines Deleted",a(t.lines_deleted)],["Files Created",a(t.files_created)],["Files Edited",a(t.files_edited)],["Input Tokens",a(t.input_tokens)],["Output Tokens",a(t.output_tokens)],["Cache Read",a(t.cache_read_tokens)],["Cache Write",a(t.cache_write_tokens)],["Cache Hit Rate",h(t.cache_hit_rate)],["Thinking Chars",a(t.thinking_chars)],["Tool Calls",a(t.tool_calls)],["Errors",a(t.error_count)],["Error Rate",h(t.error_rate)],["Agent Spawns",a(t.agent_spawns)]];return e.jsx("tr",{children:e.jsx("td",{colSpan:p.length+1,className:"p-0",children:e.jsxs("div",{className:"bg-accent/30 p-4 border-t border-border",children:[e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-6 gap-x-6 gap-y-2",children:l.map(([c,d])=>e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:c}),e.jsx("span",{className:"font-mono",children:d})]},c))}),e.jsx("div",{className:"mt-3",children:e.jsx(b,{to:`/sessions?project=${encodeURIComponent(t.project_path)}`,className:"text-sm text-primary hover:underline",children:"View Sessions â†’"})})]})})})}function ae(){const{dateRange:t}=S(),[l,c]=n.useState("cost"),[d,u]=n.useState("desc"),[g,m]=n.useState(1),[x,j]=n.useState(""),[_,k]=n.useState(null),{data:r,isLoading:C,error:f}=D(t,l,d,g,x||void 0),w=n.useCallback(s=>{l===s?u(o=>o==="asc"?"desc":"asc"):(c(s),u("desc")),m(1)},[l]),y=n.useCallback(s=>{k(o=>o===s?null:s)},[]);return e.jsxs(N,{title:"Projects",subtitle:"Project-level metrics and drill-down",actions:r?.projects&&e.jsx(U,{page:"projects",getData:()=>(r?.projects||[]).map(s=>({project:s.project_display,sessions:s.sessions,cost:s.cost,loc_written:s.loc_written,error_rate:s.error_rate,messages:s.messages,tool_calls:s.tool_calls,cost_per_kloc:s.cost_per_kloc})),columns:["project","sessions","cost","loc_written","error_rate","messages","tool_calls","cost_per_kloc"]}),children:[e.jsxs("div",{className:"mb-4 relative max-w-sm",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx("input",{type:"text",value:x,onChange:s=>{j(s.target.value),m(1)},placeholder:"Search projects...",className:"w-full pl-9 pr-3 py-2 text-sm rounded-md border border-border bg-background focus:outline-none focus:ring-2 focus:ring-ring"})]}),C?e.jsx(E,{message:"Loading projects..."}):f?e.jsx(O,{message:f.message}):!r||r.projects.length===0?e.jsx(T,{message:"No projects found"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-lg border border-border overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50 border-b border-border",children:[e.jsx("th",{className:"text-left px-4 py-3 font-medium text-muted-foreground",children:"Project"}),p.map(s=>e.jsx("th",{onClick:()=>w(s.key),className:"px-4 py-3 font-medium text-muted-foreground cursor-pointer hover:text-foreground transition-colors text-right whitespace-nowrap",children:e.jsxs("span",{className:"inline-flex items-center gap-1",children:[s.label,l===s.key?d==="asc"?e.jsx(F,{className:"h-3 w-3"}):e.jsx(I,{className:"h-3 w-3"}):e.jsx(H,{className:"h-3 w-3 opacity-30"})]})},s.key))]})}),e.jsx("tbody",{children:r.projects.map(s=>e.jsxs(e.Fragment,{children:[e.jsxs("tr",{onClick:()=>y(s.project_path),className:R("border-b border-border cursor-pointer transition-colors",_===s.project_path?"bg-accent/20":"hover:bg-accent/10"),children:[e.jsx("td",{className:"px-4 py-3 font-medium truncate max-w-xs",children:e.jsx(b,{to:`/projects/${btoa(unescape(encodeURIComponent(s.project_path)))}`,onClick:o=>o.stopPropagation(),className:"text-primary hover:underline",children:s.project_display})}),p.map(o=>e.jsx("td",{className:"px-4 py-3 font-mono text-right whitespace-nowrap",children:o.format(s[o.key])},o.key))]},s.project_path),_===s.project_path&&e.jsx(W,{project:s},`${s.project_path}-expanded`)]}))})]})})}),r.pagination.total_pages>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4",children:[e.jsxs("span",{className:"text-sm text-muted-foreground",children:["Page ",r.pagination.page," of ",r.pagination.total_pages," (",r.pagination.total_count," projects)"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>m(s=>Math.max(1,s-1)),disabled:g<=1,className:"p-2 rounded border border-border hover:bg-accent disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx(M,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>m(s=>Math.min(r.pagination.total_pages,s+1)),disabled:g>=r.pagination.total_pages,className:"p-2 rounded border border-border hover:bg-accent disabled:opacity-30 disabled:cursor-not-allowed",children:e.jsx($,{className:"h-4 w-4"})})]})]})]})]})}export{ae as default};
