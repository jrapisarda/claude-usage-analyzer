import{j as e}from"./query-vendor-DAETOSEH.js";import{r}from"./react-vendor-CGr-4ZyM.js";import{P as R}from"./PageLayout-DEtLmFLB.js";import{u as C}from"./dashboard-CzYlxRYi.js";import{M as h}from"./MetricCard-BoawkqIY.js";import{d as N,a as E,e as _,f as j}from"./index-DZMFuYgm.js";import{b as A,A as T,d as L}from"./chart-vendor-Df4oWUqu.js";const W=[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]],M=N("activity",W);const D=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],O=N("wifi-off",D);const P=[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]],I=N("wifi",P),k=100,z=3e4,F=1e3,G=3e4;function $(s){const[u,n]=r.useState("disconnected"),[f,a]=r.useState(null),[l,d]=r.useState([]),o=r.useRef(null),m=r.useRef(null),g=r.useRef(null),y=r.useRef(0),t=r.useRef(!0),c=r.useCallback(()=>{if(t.current)try{const i=new WebSocket(s);o.current=i,n("connecting"),i.onopen=()=>{t.current&&(n("connected"),y.current=0,m.current=setInterval(()=>{i.readyState===WebSocket.OPEN&&i.send("ping")},z))},i.onmessage=w=>{if(t.current)try{const b=JSON.parse(w.data);if(b.type==="pong")return;a(b),d(S=>{const v=[b,...S];return v.length>k?v.slice(0,k):v})}catch{}},i.onclose=()=>{t.current&&(x(),n("disconnected"),p())},i.onerror=()=>{t.current&&n("error")}}catch{n("error"),p()}},[s]),x=r.useCallback(()=>{m.current&&(clearInterval(m.current),m.current=null),o.current&&(o.current.onopen=null,o.current.onmessage=null,o.current.onclose=null,o.current.onerror=null,o.current=null)},[]),p=r.useCallback(()=>{if(!t.current)return;const i=Math.min(F*Math.pow(2,y.current),G);y.current++,g.current=setTimeout(()=>{t.current&&c()},i)},[c]);return r.useEffect(()=>{t.current=!0,c();const i=()=>{document.hidden||o.current?.readyState!==WebSocket.OPEN&&c()};return document.addEventListener("visibilitychange",i),()=>{t.current=!1,document.removeEventListener("visibilitychange",i),g.current&&clearTimeout(g.current),x(),o.current?.readyState===WebSocket.OPEN&&o.current.close()}},[c,x]),{status:u,lastMessage:f,messages:l}}function q({targetCost:s,className:u}){const[n,f]=r.useState(s),a=r.useRef(void 0),l=r.useRef(s);return l.current=s,r.useEffect(()=>{let d=n;const o=()=>{const m=l.current-d;Math.abs(m)<5e-5?d=l.current:d+=m*.1,f(d),a.current=requestAnimationFrame(o)};return a.current=requestAnimationFrame(o),()=>{a.current&&cancelAnimationFrame(a.current)}},[]),e.jsx("span",{className:_("font-mono tabular-nums text-2xl",u),children:E(n)})}function B({projectDisplay:s,gitBranch:u,className:n}){return e.jsxs("div",{className:_("flex items-center gap-2 px-3 py-1.5 rounded-md bg-green-500/10 border border-green-500/30",n),children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"}),e.jsx("span",{className:"text-xs font-medium",children:s}),u&&e.jsx("span",{className:"text-xs text-muted-foreground font-mono",children:u})]})}function V(){return`${window.location.protocol==="https:"?"wss:":"ws:"}//${window.location.host}/ws/live`}function H(){const s=new Date().toISOString().split("T")[0];return{from:s,to:s}}function ee(){const{status:s,lastMessage:u,messages:n}=$(V()),{data:f}=C(H()),a=r.useMemo(()=>n.filter(t=>t.type==="etl_update"),[n]),l=r.useMemo(()=>n.find(t=>t.type==="daily_cost_update"),[n]),d=r.useMemo(()=>n.find(t=>t.type==="active_session"),[n]),o=r.useMemo(()=>{let t=0,c=0,x=0;for(const p of a)t+=p.turns_inserted||0,c+=p.tool_calls_inserted||0,x+=p.files_processed||0;return{turns:t,toolCalls:c,files:x}},[a]),m=r.useMemo(()=>a.slice(0,30).reverse().map((t,c)=>({i:c,turns:t.turns_inserted||0})),[a]),g=s==="connected"?"text-green-500":s==="connecting"?"text-yellow-500":"text-red-400",y=s==="connected"?I:O;return e.jsxs(R,{title:"Live Monitor",subtitle:"Real-time session tracking",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:_("flex items-center gap-2 text-sm",g),children:[e.jsx(y,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium capitalize",children:s}),s==="connected"&&u&&e.jsxs("span",{className:"text-muted-foreground ml-2",children:["Last update: ",u.timestamp?new Date(u.timestamp).toLocaleTimeString():"N/A"]})]}),d&&d.project_display&&e.jsx(B,{projectDisplay:d.project_display,gitBranch:d.git_branch})]}),s!=="connected"?e.jsxs("div",{className:"rounded-lg border border-border bg-card p-8 text-center",children:[e.jsx(M,{className:"h-12 w-12 text-muted-foreground mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:s==="connecting"?"Connecting...":"Disconnected"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:s==="connecting"?"Establishing WebSocket connection to the server...":"WebSocket connection lost. Reconnecting automatically..."})]}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Cost Today"}),e.jsx("div",{className:"mt-1",children:e.jsx(q,{targetCost:l?.cost_today??f?.vitals.cost??0})}),l&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[l.sessions_today," session",l.sessions_today!==1?"s":""]})]}),e.jsx(h,{title:"Sessions Today",value:j(l?.sessions_today??f?.vitals.sessions??0)}),e.jsx(h,{title:"Messages Today",value:j(f?.vitals.messages??0)}),e.jsx(h,{title:"Error Rate",value:f?.vitals.error_rate!=null?`${(f.vitals.error_rate*100).toFixed(1)}%`:"0.0%"})]}),e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(h,{title:"Turns Received",value:j(o.turns)}),e.jsx(h,{title:"Tool Calls",value:j(o.toolCalls)}),e.jsx(h,{title:"Files Processed",value:j(o.files)})]}),m.length>1&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Recent Activity (turns/update)"}),e.jsx("div",{className:"h-20",children:e.jsx(A,{width:"100%",height:"100%",children:e.jsxs(T,{data:m,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"liveGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-2)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-2)",stopOpacity:0})]})}),e.jsx(L,{type:"monotone",dataKey:"turns",stroke:"var(--color-chart-2)",fill:"url(#liveGrad)",strokeWidth:2,isAnimationActive:!1})]})})})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Event Log"}),a.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx(M,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2 animate-pulse"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Waiting for activity..."}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Start a Claude Code session to see live updates"})]}):e.jsx("div",{className:"space-y-1 max-h-96 overflow-y-auto",children:a.map((t,c)=>e.jsxs("div",{className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-accent/10",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 shrink-0"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.timestamp?new Date(t.timestamp).toLocaleTimeString():""})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs font-mono",children:[(t.files_processed??0)>0&&e.jsxs("span",{children:[t.files_processed," files"]}),(t.turns_inserted??0)>0&&e.jsxs("span",{children:[t.turns_inserted," turns"]}),(t.tool_calls_inserted??0)>0&&e.jsxs("span",{children:[t.tool_calls_inserted," tool calls"]})]})]},c))})]})]})]})}export{ee as default};
