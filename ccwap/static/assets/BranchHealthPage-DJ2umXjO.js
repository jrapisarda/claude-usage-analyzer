import{j as e}from"./query-vendor-ChV-W4bE.js";import{r as n}from"./react-vendor-yhu9f3WU.js";import{P as g}from"./PageLayout-DNcy9VzK.js";import{C as _}from"./ChartContainer-BVfquKWB.js";import{M as y,a as l}from"./MetricCardGrid-DncIdQee.js";import{E as M}from"./ErrorState-D6SGc0M3.js";import{u as k,f as x,a as u,b as v}from"./index-DOoA8ygH.js";import{a as H}from"./advanced-BunkG_h-.js";import{f as w,T as A,C as N}from"./chartConfig-C_qPkli-.js";import{I as F}from"./input-Bcp6nXqr.js";import{T as O,a as R,b as i}from"./tabs-D_mtJQl8.js";import{i as $,X as P,Y as D,T as z,L as I,j as Y,h as q}from"./chart-vendor-Dwd1Lo9s.js";import"./skeleton-4dVV08Mr.js";import"./index-B8TGfkCk.js";import"./index-yuhgJcXM.js";function ce(){const{dateRange:C}=k(),[p,T]=n.useState(""),[s,B]=n.useState("cost"),{data:a,isLoading:L,error:f}=H(C,p.trim()||null),d=n.useMemo(()=>(a?.branches??[]).map(t=>t.branch),[a?.branches]),b=n.useMemo(()=>{if(!a)return[];const t=new Map;for(const r of a.trend)t.has(r.date)||t.set(r.date,{date:r.date}),t.get(r.date)[r.branch]=r[s];return w(Array.from(t.values()).sort((r,h)=>String(r.date).localeCompare(String(h.date))),d)},[a,d,s]),j=t=>s==="cost"?u(t):s==="cache_hit_rate"?v(t):x(t),m=n.useMemo(()=>{const t=a?.branches??[],r=t.reduce((o,c)=>o+c.cost,0),h=t.reduce((o,c)=>o+c.errors,0),S=t.reduce((o,c)=>o+c.loc_written,0),E=t.length>0?t.reduce((o,c)=>o+c.cache_hit_rate,0)/t.length:0;return{totalCost:r,totalErrors:h,totalLoc:S,avgCache:E}},[a?.branches]);return f?e.jsx(M,{message:f.message}):L||!a?e.jsx(g,{title:"Branch Health",subtitle:"Branch cost/quality/productivity before merge",children:e.jsx(y,{skeleton:!0,count:4,className:"mb-6"})}):e.jsxs(g,{title:"Branch Health",subtitle:"Branch cost/quality/productivity before merge",children:[e.jsxs(y,{className:"mb-6",children:[e.jsx(l,{title:"Branches",value:x(a.branches.length)}),e.jsx(l,{title:"Total Cost",value:u(m.totalCost)}),e.jsx(l,{title:"Total Errors",value:x(m.totalErrors)}),e.jsx(l,{title:"Avg Cache Hit",value:v(m.avgCache)})]}),e.jsxs("div",{className:"rounded-md border border-border p-3 mb-4 flex items-center gap-3",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Branch Filter"}),e.jsx(F,{value:p,onChange:t=>T(t.target.value),placeholder:"main, develop, feat-x (comma-separated)",className:"max-w-sm h-8"}),e.jsx(O,{value:s,onValueChange:t=>B(t),children:e.jsxs(R,{children:[e.jsx(i,{value:"cost",children:"Cost"}),e.jsx(i,{value:"errors",children:"Errors"}),e.jsx(i,{value:"loc_written",children:"LOC"}),e.jsx(i,{value:"cache_hit_rate",children:"Cache Hit"})]})})]}),e.jsx(_,{title:"Branch Trend Overlay",height:320,isEmpty:b.length===0,children:e.jsxs($,{data:b,children:[e.jsx(P,{dataKey:"date",tick:{fontSize:10}}),e.jsx(D,{tick:{fontSize:10},tickFormatter:t=>j(Number(t??0))}),e.jsx(z,{contentStyle:A,formatter:t=>j(Number(t??0))}),e.jsx(I,{}),d.map((t,r)=>e.jsx(Y,{dataKey:t,stroke:N[r%N.length],strokeWidth:2,dot:!1,name:t},t)),a.anomalies.map((t,r)=>e.jsx(q,{x:t.date,y:s==="cost"?t.cost:0,r:s==="cost"?4:0,fill:"var(--color-destructive, #ef4444)"},`${t.branch}-${t.date}-${r}`))]})}),e.jsxs("div",{className:"rounded-md border border-border overflow-hidden mt-6",children:[e.jsx("div",{className:"px-4 py-2 border-b border-border text-sm font-medium text-muted-foreground",children:"Branch Anomaly Markers"}),e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-border",children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"Branch"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Cost"}),e.jsx("th",{className:"px-3 py-2 text-right",children:"Z-Score"})]})}),e.jsx("tbody",{children:a.anomalies.length===0?e.jsx("tr",{children:e.jsx("td",{className:"px-3 py-3 text-muted-foreground",colSpan:4,children:"No anomalies detected."})}):a.anomalies.map((t,r)=>e.jsxs("tr",{className:"border-b border-border/60",children:[e.jsx("td",{className:"px-3 py-2 font-mono",children:t.date}),e.jsx("td",{className:"px-3 py-2",children:t.branch}),e.jsx("td",{className:"px-3 py-2 text-right font-mono",children:u(t.cost)}),e.jsx("td",{className:"px-3 py-2 text-right font-mono",children:t.zscore.toFixed(2)})]},`${t.branch}-${t.date}-${r}`))})]})]})]})}export{ce as default};
