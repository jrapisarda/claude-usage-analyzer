import{u as K,j as e}from"./query-vendor-ChV-W4bE.js";import{r as y,c as M}from"./react-vendor-yhu9f3WU.js";import{P as F}from"./PageLayout-CKQ82rM8.js";import{D as H,h as W,i as q,E as I,a as N,u as Y,f as j,b as B,e as C}from"./index-Bpa7eUOS.js";import{M as z,a as p}from"./MetricCardGrid-DAgrh55f.js";import{C as k}from"./ChartContainer-DT93XJhW.js";import{E as Q}from"./ErrorState-DjaCiOCU.js";import{E as X}from"./ExportDropdown-DnSuL1-6.js";import{C as U}from"./chevron-down-CDKZgXf3.js";import{C as w,a as b,b as S,e as T,c as A}from"./card-BPiuFm8S.js";import{B as V}from"./badge-Cn-RNLir.js";import{f as Z,C as l,T as E}from"./chartConfig-CHOlO3Nn.js";import{P as J,f as ee,C as se,T as P,L as O,A as te,X as ae,Y as re,b as D}from"./chart-vendor-CnSh9PGG.js";import"./skeleton-DdhmaHDM.js";import"./index-CW8GAOI9.js";import"./index-DHRk0rsW.js";import"./check-CQsps3zJ.js";import"./download-C-raSRr6.js";function oe(t){return K({queryKey:H.data(t),queryFn:()=>W(`/workflows${q({from:t.from,to:t.to})}`)})}function $({node:t,depth:a=0}){const[i,m]=y.useState(a===0),x=M(),c=t.children.length>0,u=t.user_type==="agent";return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 py-1.5 px-2 rounded hover:bg-accent/50 text-sm cursor-pointer",style:{paddingLeft:`${a*20+8}px`},onClick:()=>c?m(!i):x(`/sessions/${t.session_id}`),children:[c?e.jsx("button",{onClick:n=>{n.stopPropagation(),m(!i)},className:"p-0.5",children:i?e.jsx(U,{className:"h-3 w-3"}):e.jsx(I,{className:"h-3 w-3"})}):e.jsx("span",{className:"w-4"}),u&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-purple-500/20 text-purple-400 rounded",children:"agent"}),e.jsxs("span",{className:"text-xs font-mono text-muted-foreground hover:text-foreground hover:underline",onClick:n=>{n.stopPropagation(),x(`/sessions/${t.session_id}`)},children:[t.session_id.slice(0,8),"..."]}),e.jsx("span",{className:"text-xs truncate",children:t.project_display}),e.jsx("span",{className:"text-xs text-muted-foreground ml-auto",children:N(t.total_cost)})]}),i&&c&&e.jsx("div",{children:t.children.map(n=>e.jsx($,{node:n,depth:a+1},n.session_id))})]})}function ne({trees:t}){return t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No agent session trees found"}):e.jsx("div",{className:"space-y-1",children:t.map(a=>e.jsx($,{node:a},a.session_id))})}const ie={human:l[0],agent:l[2]};function be(){const{dateRange:t}=Y(),{data:a,isLoading:i,error:m,refetch:x}=oe(t),c=y.useMemo(()=>{if(!a?.user_type_trend)return[];const s={};for(const o of a.user_type_trend)s[o.date]||(s[o.date]={}),s[o.date][o.user_type]=o.sessions;const r=Object.entries(s).map(([o,d])=>({date:o,...d})).sort((o,d)=>o.date.localeCompare(d.date));return Z(r,["human","agent"])},[a?.user_type_trend]),u=y.useCallback(()=>a?a.user_types.map(s=>({user_type:s.user_type,sessions:s.sessions,total_cost:s.total_cost,total_turns:s.total_turns})):[],[a]);if(m)return e.jsx(Q,{message:m.message,onRetry:()=>x()});const n=a?.user_types??[],L=a?.agent_trees??[],_=a?.tool_sequences??[],h=n.reduce((s,r)=>s+r.sessions,0),R=n.reduce((s,r)=>s+r.total_cost,0),f=n.find(s=>s.user_type==="agent"),v=n.find(s=>s.user_type==="human"),G=h>0&&f?f.sessions/h:0,g=n.map(s=>({name:s.user_type,value:s.sessions,color:ie[s.user_type]||l[4]}));return e.jsxs(F,{title:"Workflows",subtitle:"Human vs Agent sessions, agent trees, and tool patterns",actions:e.jsx(X,{page:"workflows",getData:u}),children:[e.jsx(z,{skeleton:i,count:4,className:"mb-6",children:a&&e.jsxs(e.Fragment,{children:[e.jsx(p,{title:"Total Sessions",value:j(h)}),e.jsx(p,{title:"Total Cost",value:N(R)}),e.jsx(p,{title:"Human Sessions",value:j(v?.sessions??0),subtitle:`${N(v?.total_cost??0)} cost`}),e.jsx(p,{title:"Agent Sessions",value:j(f?.sessions??0),subtitle:`${B(G)} of total`})]})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(k,{title:"Session Breakdown - Human vs Agent",height:256,isLoading:i,isEmpty:g.length===0,emptyMessage:"No session data",children:e.jsxs(J,{children:[e.jsx(ee,{data:g,dataKey:"value",nameKey:"name",innerRadius:50,outerRadius:80,paddingAngle:2,label:({name:s,value:r,percent:o})=>`${s??""}: ${r??0} (${((o??0)*100).toFixed(0)}%)`,children:g.map((s,r)=>e.jsx(se,{fill:s.color},r))}),e.jsx(P,{contentStyle:E}),e.jsx(O,{})]})}),e.jsx(k,{title:"Session Trend - Stacked by user type",height:256,isLoading:i,isEmpty:c.length===0,emptyMessage:"No trend data",children:e.jsxs(te,{data:c,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"humanGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:l[0],stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:l[0],stopOpacity:0})]}),e.jsxs("linearGradient",{id:"agentGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:l[2],stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:l[2],stopOpacity:0})]})]}),e.jsx(ae,{dataKey:"date",tick:{fontSize:11},tickFormatter:s=>s.slice(5),stroke:"var(--color-muted-foreground)"}),e.jsx(re,{tick:{fontSize:11},stroke:"var(--color-muted-foreground)",allowDecimals:!1}),e.jsx(P,{contentStyle:E}),e.jsx(O,{}),e.jsx(D,{type:"monotone",dataKey:"human",stackId:"1",stroke:l[0],fill:"url(#humanGrad)",strokeWidth:2,name:"Human"}),e.jsx(D,{type:"monotone",dataKey:"agent",stackId:"1",stroke:l[2],fill:"url(#agentGrad)",strokeWidth:2,name:"Agent"})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsxs(w,{children:[e.jsxs(b,{children:[e.jsx(S,{className:"text-sm",children:"Agent Session Trees"}),e.jsx(T,{children:"Parent-child session hierarchy"})]}),e.jsx(A,{children:i?e.jsx("div",{className:"space-y-2",children:Array.from({length:3}).map((s,r)=>e.jsx("div",{className:"animate-pulse rounded bg-primary/10 h-8 w-full"},r))}):e.jsx(C,{className:"h-96",children:e.jsx(ne,{trees:L})})})]}),e.jsxs(w,{children:[e.jsxs(b,{children:[e.jsx(S,{className:"text-sm",children:"Tool Sequences"}),e.jsx(T,{children:"Most common tool call patterns"})]}),e.jsx(A,{children:i?e.jsx("div",{className:"space-y-2",children:Array.from({length:5}).map((s,r)=>e.jsx("div",{className:"animate-pulse rounded bg-primary/10 h-8 w-full"},r))}):_.length>0?e.jsx(C,{className:"h-96",children:e.jsx("div",{className:"space-y-2",children:_.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-muted-foreground w-6 text-right shrink-0",children:[r+1,"."]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:s.sequence.map((o,d)=>e.jsxs("span",{children:[e.jsx(V,{variant:"secondary",className:"font-mono text-xs",children:o}),d<s.sequence.length-1&&e.jsx("span",{className:"text-muted-foreground mx-0.5",children:"â†’"})]},d))}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-accent/30 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full",style:{width:`${s.pct}%`,backgroundColor:l[1]}})}),e.jsxs("span",{className:"text-xs text-muted-foreground shrink-0",children:[s.count,"x (",s.pct.toFixed(1),"%)"]})]})]})]},r))})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No tool sequence data"})})]})]})]})}export{be as default};
