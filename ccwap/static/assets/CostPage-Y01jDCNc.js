import{u as M,j as e}from"./query-vendor-ChV-W4bE.js";import{r as h}from"./react-vendor-yhu9f3WU.js";import{P as R}from"./PageLayout-D9m6_tUv.js";import{M as V,a as T}from"./MetricCardGrid-B_H6C3FR.js";import{C as y}from"./ChartContainer-CZHP22W9.js";import{E as ce}from"./ErrorState-BLJWzcFK.js";import{E as ne}from"./ExportDropdown-B5mNqhEJ.js";import{S as ie}from"./SavedViewsBar-CKmMXSOA.js";import{C as W,a as I,b as H,c as Y}from"./card-Cst7U1OL.js";import{S as Q,a as X,b as J,c as U,d as F}from"./select-DEp9fouH.js";import{h as E,i as O,j as P,k as se,a as s,b as K,u as de}from"./index-fSpeN2Hc.js";import{T as v}from"./chartConfig-C_qPkli-.js";import{A as q,X as S,Y as w,T as _,b as L,P as me,f as xe,C as ue,B as Z,e as ee,g as te,h as he}from"./chart-vendor-CnSh9PGG.js";import"./skeleton-D4mSERnM.js";import"./index-CAqHlzL7.js";import"./index-BPwOh6t0.js";import"./check-C4JeTEY1.js";import"./download-CBeYuC7_.js";import"./chevron-down-CiMRQC6p.js";function pe(o){return M({queryKey:E.data(o),queryFn:()=>O(`/cost${P({from:o.from,to:o.to})}`)})}function je(o){return M({queryKey:E.anomalies(o),queryFn:()=>O(`/cost/anomalies${P({from:o.from,to:o.to})}`)})}function fe(o){return M({queryKey:E.cumulative(o),queryFn:()=>O(`/cost/cumulative${P({from:o.from,to:o.to})}`)})}function ge(o,a){return M({queryKey:E.cacheSimulation(o,a),queryFn:()=>O(`/cost/cache-simulation${P({target_hit_rate:o,from:a.from,to:a.to})}`)})}function ye({spent:o}){const[a,N]=se("ccwap:monthly-budget",0),[r,l]=h.useState(!1),[n,p]=h.useState(""),i=h.useRef(null);h.useEffect(()=>{r&&i.current&&(i.current.focus(),i.current.select())},[r]);const A=()=>{p(a>0?a.toString():""),l(!0)},x=()=>{const c=parseFloat(n);!isNaN(c)&&c>=0&&N(c),l(!1)},D=c=>{c.key==="Enter"&&x(),c.key==="Escape"&&l(!1)},m=a-o,d=a>0?o/a*100:0,b=new Date(new Date().getFullYear(),new Date().getMonth()+1,0).getDate(),u=new Date().getDate(),j=u>0?o/u:0,f=j*b,g=d>90?"bg-red-500":d>70?"bg-yellow-500":"bg-green-500";return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Budget Tracker"}),e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Monthly Budget"}),r?e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[e.jsx("span",{className:"text-lg font-mono",children:"$"}),e.jsx("input",{ref:i,type:"number",min:"0",step:"0.01",value:n,onChange:c=>p(c.target.value),onBlur:x,onKeyDown:D,className:"font-mono text-lg w-28 bg-transparent border-b border-border outline-none focus:border-primary"})]}):e.jsx("p",{className:"font-mono text-lg cursor-pointer hover:text-primary transition-colors",onClick:A,title:"Click to edit budget",children:a>0?s(a):"Set budget..."})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Spent"}),e.jsx("p",{className:"font-mono text-lg",children:s(o)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Remaining"}),e.jsx("p",{className:`font-mono text-lg ${a>0&&m<0?"text-red-500":""}`,children:a>0?s(m):"--"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Burn Rate"}),e.jsxs("p",{className:"font-mono text-lg",children:[s(j),"/day"]}),a>0&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Projected: ",s(f)]})]})]}),a>0&&e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsxs("span",{children:[Math.min(d,100).toFixed(1),"% used"]}),e.jsxs("span",{children:[s(o)," / ",s(a)]})]}),e.jsx("div",{className:"w-full h-3 bg-muted rounded-full overflow-hidden",children:e.jsx("div",{className:`h-full rounded-full transition-all ${g}`,style:{width:`${Math.min(d,100)}%`}})})]})]})}function ve({dateRange:o}){const[a,N]=h.useState(80),{data:r,isLoading:l}=ge(a/100,o);return e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Cache What-If Calculator"}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Target Cache Hit Rate"}),e.jsxs("span",{className:"font-mono text-sm",children:[a,"%"]})]}),e.jsx("input",{type:"range",min:0,max:100,step:1,value:a,onChange:n=>N(Number(n.target.value)),className:"w-full accent-primary"}),e.jsxs("div",{className:"flex justify-between text-xs text-muted-foreground mt-1",children:[e.jsx("span",{children:"0%"}),e.jsx("span",{children:"50%"}),e.jsx("span",{children:"100%"})]})]}),l&&e.jsx("div",{className:"text-sm text-muted-foreground",children:"Calculating..."}),r&&e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Actual Cost"}),e.jsx("p",{className:"font-mono text-lg",children:s(r.actual_cost)}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Hit rate: ",K(r.actual_cache_rate)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Simulated Cost"}),e.jsx("p",{className:"font-mono text-lg",children:s(r.simulated_cost)}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:["Hit rate: ",K(r.simulated_cache_rate)]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Savings"}),e.jsx("p",{className:`font-mono text-lg ${r.savings>0?"text-green-500":r.savings<0?"text-red-500":""}`,children:s(r.savings)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Savings %"}),e.jsx("p",{className:`font-mono text-lg ${r.savings>0?"text-green-500":r.savings<0?"text-red-500":""}`,children:r.actual_cost>0?K(r.savings/r.actual_cost):"0.0%"})]})]})]})}const $={input:"var(--color-token-input)",output:"var(--color-token-output)",cache_read:"var(--color-token-cache-read)",cache_write:"var(--color-token-cache-write)"};function Ge(){const{dateRange:o}=de(),{data:a,isLoading:N,error:r}=pe(o),{data:l}=je(o),{data:n}=fe(o),[p]=se("ccwap:monthly-budget",0),[i,A]=h.useState("__all__"),[x,D]=h.useState("__all__");if(r)return e.jsx(ce,{message:r.message});if(N||!a)return e.jsx(R,{title:"Cost Analysis",subtitle:"Detailed cost breakdowns and forecasting",children:e.jsx(V,{skeleton:!0,count:4,className:"mb-6"})});const{summary:m,by_token_type:d,by_model:b,trend:u,by_project:j,cache_savings:f,forecast:g}=a,c=l?.filter(t=>t.is_anomaly)??[],B=l&&l.length>0?l[0].threshold:0,oe=b.map(t=>t.model),ae=j.map(t=>t.project_display),z=i==="__all__"?b:b.filter(t=>t.model===i),G=x==="__all__"?j:j.filter(t=>t.project_display===x),re=t=>{const k=typeof t.focus_model=="string"?t.focus_model:"__all__",le=typeof t.focus_project=="string"?t.focus_project:"__all__";A(k),D(le)},C=[{name:"Input",value:d.input_cost,color:$.input},{name:"Output",value:d.output_cost,color:$.output},{name:"Cache Read",value:d.cache_read_cost,color:$.cache_read},{name:"Cache Write",value:d.cache_write_cost,color:$.cache_write}].filter(t=>t.value>0);return e.jsxs(R,{title:"Cost Analysis",subtitle:"Detailed cost breakdowns and forecasting",actions:e.jsx(ne,{page:"cost",getData:()=>[...u.map(t=>({date:t.date,cost:t.cost})),...z.map(t=>({type:"by_model",model:t.model,cost:t.cost})),...G.map(t=>({type:"by_project",project:t.project_display,cost:t.cost}))]}),children:[e.jsx(ie,{page:"cost",currentFilters:{focus_model:i,focus_project:x},onApply:re,from:o.from,to:o.to,defaultMetricForAlert:"total_cost"}),e.jsxs("div",{className:"rounded-md border border-border p-3 mb-6 flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"View Filters"}),e.jsxs(Q,{value:i,onValueChange:A,children:[e.jsx(X,{className:"h-8 w-[240px]",children:e.jsx(J,{placeholder:"All models"})}),e.jsxs(U,{children:[e.jsx(F,{value:"__all__",children:"All models"}),oe.map(t=>e.jsx(F,{value:t,children:t},t))]})]}),e.jsxs(Q,{value:x,onValueChange:D,children:[e.jsx(X,{className:"h-8 w-[240px]",children:e.jsx(J,{placeholder:"All projects"})}),e.jsxs(U,{children:[e.jsx(F,{value:"__all__",children:"All projects"}),ae.map(t=>e.jsx(F,{value:t,children:t},t))]})]})]}),e.jsxs(V,{className:"mb-6",children:[e.jsx(T,{title:"Total Cost",value:s(m.total_cost)}),e.jsx(T,{title:"Avg Daily",value:s(m.avg_daily_cost)}),e.jsx(T,{title:"Today",value:s(m.cost_today)}),e.jsx(T,{title:"Projected Monthly",value:s(m.projected_monthly)})]}),e.jsxs(W,{className:"mb-6",children:[e.jsx(I,{className:"pb-3",children:e.jsx(H,{className:"text-sm font-medium text-muted-foreground",children:"Spend Forecast"})}),e.jsx(Y,{children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Daily Avg"}),e.jsx("p",{className:"font-mono text-lg",children:s(g.daily_avg)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"7-Day"}),e.jsx("p",{className:"font-mono text-lg",children:s(g.projected_7d)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"14-Day"}),e.jsx("p",{className:"font-mono text-lg",children:s(g.projected_14d)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"30-Day"}),e.jsx("p",{className:"font-mono text-lg",children:s(g.projected_30d)})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(y,{title:"Cost Trend",height:256,isEmpty:u.length===0,emptyMessage:"No cost trend data",children:e.jsxs(q,{data:u,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"costTrendGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-1)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-1)",stopOpacity:0})]})}),e.jsx(S,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(w,{tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(_,{contentStyle:v,formatter:t=>[t!=null?s(t):"","Cost"]}),e.jsx(L,{type:"monotone",dataKey:"cost",stroke:"var(--color-chart-1)",fill:"url(#costTrendGrad)",strokeWidth:2,isAnimationActive:u.length<365})]})}),e.jsx(y,{title:"Cost by Token Type",height:192,isEmpty:C.length===0,emptyMessage:"No token type data",children:e.jsxs(me,{children:[e.jsx(xe,{data:C,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:70,strokeWidth:0,children:C.map((t,k)=>e.jsx(ue,{fill:t.color},k))}),e.jsx(_,{contentStyle:{...v},formatter:t=>[t!=null?s(t):""]})]})})]}),C.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3 -mt-4 mb-6 ml-4",children:C.map(t=>e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:t.color}}),t.name,": ",s(t.value)]},t.name))}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(y,{title:"Cost by Model",height:256,isEmpty:z.length===0,emptyMessage:"No model data",children:e.jsxs(Z,{data:z.slice(0,10),layout:"vertical",children:[e.jsx(S,{type:"number",tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)"}),e.jsx(w,{type:"category",dataKey:"model",tick:{fontSize:10},width:120,stroke:"var(--color-muted-foreground)"}),e.jsx(_,{contentStyle:v,formatter:t=>[t!=null?s(t):"","Cost"]}),e.jsx(ee,{dataKey:"cost",fill:"var(--color-chart-1)",radius:[0,4,4,0]})]})}),e.jsx(y,{title:"Cost by Project (Top 10)",height:256,isEmpty:G.length===0,emptyMessage:"No project data",children:e.jsxs(Z,{data:G.slice(0,10),layout:"vertical",children:[e.jsx(S,{type:"number",tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)"}),e.jsx(w,{type:"category",dataKey:"project_display",tick:{fontSize:10},width:120,stroke:"var(--color-muted-foreground)"}),e.jsx(_,{contentStyle:v,formatter:t=>[t!=null?s(t):"","Cost"]}),e.jsx(ee,{dataKey:"cost",fill:"var(--color-chart-2)",radius:[0,4,4,0]})]})})]}),e.jsxs(W,{className:"mb-6",children:[e.jsx(I,{className:"pb-3",children:e.jsx(H,{className:"text-sm font-medium text-muted-foreground",children:"Cache Savings"})}),e.jsx(Y,{children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Cache Hit Rate"}),e.jsx("p",{className:"font-mono text-lg",children:K(f.cache_hit_rate)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Estimated Savings"}),e.jsx("p",{className:"font-mono text-lg text-green-500",children:s(f.estimated_savings)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Cost w/o Cache"}),e.jsx("p",{className:"font-mono text-lg",children:s(f.cost_without_cache)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Actual Cost"}),e.jsx("p",{className:"font-mono text-lg",children:s(f.actual_cost)})]})]})})]}),e.jsx("div",{className:"mb-6",children:e.jsx(ye,{spent:m.cost_this_month})}),l&&l.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsx(y,{title:"Anomaly Detection",height:256,children:e.jsxs(q,{data:l,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"anomalyGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-1)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-1)",stopOpacity:0})]})}),e.jsx(S,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(w,{tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(_,{contentStyle:v,formatter:t=>[s(t??0),"Cost"]}),e.jsx(L,{type:"monotone",dataKey:"cost",stroke:"var(--color-chart-1)",fill:"url(#anomalyGrad)",strokeWidth:2,isAnimationActive:l.length<365}),B>0&&e.jsx(te,{y:B,stroke:"var(--color-chart-4)",strokeDasharray:"5 5",label:{value:"Threshold",position:"right",fill:"var(--color-muted-foreground)",fontSize:10}}),c.map(t=>e.jsx(he,{x:t.date,y:t.cost,r:5,fill:"var(--color-destructive, #ef4444)",stroke:"none"},t.date))]})}),c.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2 ml-4",children:[c.length," anomal",c.length===1?"y":"ies"," detected above ",s(B)," threshold"]})]}),n&&n.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(y,{title:"Cumulative Cost",height:256,children:e.jsxs(q,{data:n,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"cumulativeGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-2)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-2)",stopOpacity:0})]})}),e.jsx(S,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(w,{tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)",width:60}),e.jsx(_,{contentStyle:v,formatter:(t,k)=>[s(t??0),k==="cumulative"?"Cumulative":"Daily"]}),e.jsx(L,{type:"monotone",dataKey:"cumulative",stroke:"var(--color-chart-2)",fill:"url(#cumulativeGrad)",strokeWidth:2,name:"cumulative",isAnimationActive:n.length<365}),p>0&&e.jsx(te,{y:p,stroke:"var(--color-chart-4)",strokeDasharray:"5 5",label:{value:`Budget: ${s(p)}`,position:"right",fill:"var(--color-muted-foreground)",fontSize:10}})]})})}),e.jsx("div",{className:"mb-6",children:e.jsx(ve,{dateRange:o})})]})}export{Ge as default};
