import{j as e}from"./query-vendor-DAETOSEH.js";import{r as $,L as D}from"./react-vendor-CGr-4ZyM.js";import{P as S}from"./PageLayout-DEtLmFLB.js";import{u as M,L as A,f as b,a as v,b as E,c as O,t as R}from"./index-DZMFuYgm.js";import{u as T,a as F,b as W}from"./dashboard-CzYlxRYi.js";import{E as G}from"./ErrorState-xqkb_4mP.js";import{E as w}from"./EmptyState-D7Ng6sxx.js";import{M as y}from"./MetricCard-BoawkqIY.js";import{H as P}from"./HeatmapGrid-C-s6UJOE.js";import{E as V}from"./ExportDropdown-B2A0w648.js";import{b as k,A as C,d as L,X as H,Y as z,T as B}from"./chart-vendor-Df4oWUqu.js";import"./download-Bat12fqC.js";function J(p){if(p.length===0)return{data:[],maxValue:0,colLabels:[]};const u=[...p].sort((s,o)=>s.date.localeCompare(o.date)),g=new Date(u[0].date+"T00:00:00"),f=(g.getDay()+6)%7,c=new Date(g);c.setDate(c.getDate()-f);const d=new Map;let i=0;for(const s of u)d.set(s.date,s.sessions),s.sessions>i&&(i=s.sessions);const a=[],h=[],m=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];for(let s=0;s<13;s++){const o=new Date(c);if(o.setDate(o.getDate()+s*7),s===0)a.push(m[o.getMonth()]);else{const r=new Date(c);r.setDate(r.getDate()+(s-1)*7),o.getMonth()!==r.getMonth()?a.push(m[o.getMonth()]):a.push("")}for(let r=0;r<7;r++){const n=new Date(c);n.setDate(n.getDate()+s*7+r);const x=R(n),l=d.get(x)??0;l>0&&h.push({row:r,col:s,value:l})}}return{data:h,maxValue:i,colLabels:a}}const K=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"];function oe(){const{dateRange:p}=M(),{data:u,isLoading:g,error:f}=T(p),{data:c}=F(p),{data:d}=W(90),i=$.useMemo(()=>J(d??[]),[d]);if(g)return e.jsx(A,{message:"Loading dashboard..."});if(f)return e.jsx(G,{message:f.message});if(!u)return null;const{vitals:a,sparkline_7d:h,top_projects:m,cost_trend:s,recent_sessions:o}=u,r=new Map((c??[]).map(t=>[t.metric,{pct_change:t.pct_change}])),n=r.get("sessions"),x=r.get("cost"),l=r.get("loc_written"),j=r.get("error_rate");return e.jsxs(S,{title:"Dashboard",subtitle:"Overview of your Claude Code usage",actions:e.jsx(V,{page:"dashboard",getData:()=>[{metric:"Sessions",value:a.sessions},{metric:"Cost",value:a.cost},{metric:"LOC Written",value:a.loc_written},{metric:"Error Rate",value:a.error_rate},...m.map(t=>({metric:`Project: ${t.project_display}`,value:t.cost,sessions:t.sessions,loc:t.loc_written}))]}),children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(y,{title:"Sessions",value:b(a.sessions),subtitle:`${b(a.user_turns)} user turns`,delta:n?.pct_change,deltaLabel:n?`${n.pct_change>0?"+":""}${n.pct_change.toFixed(1)}%`:void 0}),e.jsx(y,{title:"Total Cost",value:v(a.cost),delta:x?.pct_change,deltaLabel:x?`${x.pct_change>0?"+":""}${x.pct_change.toFixed(1)}%`:void 0,isLowerBetter:!0}),e.jsx(y,{title:"LOC Written",value:b(a.loc_written),delta:l?.pct_change,deltaLabel:l?`${l.pct_change>0?"+":""}${l.pct_change.toFixed(1)}%`:void 0}),e.jsx(y,{title:"Error Rate",value:E(a.error_rate),delta:j?.pct_change,deltaLabel:j?`${j.pct_change>0?"+":""}${j.pct_change.toFixed(1)}%`:void 0,isLowerBetter:!0})]}),d&&d.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Activity (last 90 days)"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsx(P,{data:i.data,maxValue:i.maxValue,rowLabels:K,colLabels:i.colLabels,cellSize:18,formatValue:t=>`${t} session${t!==1?"s":""}`,formatTooltip:(t,N,_)=>`${t}${N?` ${N}`:""}: ${_} session${_!==1?"s":""}`})})]}),h.length>1&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"7-Day Cost"}),e.jsx("div",{className:"h-16",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(C,{data:h,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"sparkGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-1)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-1)",stopOpacity:0})]})}),e.jsx(L,{type:"monotone",dataKey:"value",stroke:"var(--color-chart-1)",fill:"url(#sparkGrad)",strokeWidth:2})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[s.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Cost Trend"}),e.jsx("div",{className:"h-64",children:e.jsx(k,{width:"100%",height:"100%",children:e.jsxs(C,{data:s,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"costGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-1)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-1)",stopOpacity:0})]})}),e.jsx(H,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t.slice(5),stroke:"var(--color-muted-foreground)"}),e.jsx(z,{tick:{fontSize:11},tickFormatter:t=>`$${t}`,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(B,{contentStyle:{backgroundColor:"var(--color-card)",color:"var(--color-card-foreground)",border:"1px solid var(--color-border)",borderRadius:"6px"},labelStyle:{color:"var(--color-foreground)"},formatter:t=>[t!=null?v(t):"","Cost"]}),e.jsx(L,{type:"monotone",dataKey:"cost",stroke:"var(--color-chart-1)",fill:"url(#costGrad)",strokeWidth:2,isAnimationActive:s.length<365})]})})})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Top Projects"}),m.length===0?e.jsx(w,{message:"No project data"}):e.jsx("div",{className:"space-y-1",children:m.map(t=>e.jsxs(D,{to:`/projects?search=${encodeURIComponent(t.project_display)}`,className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"truncate font-medium",children:t.project_display}),e.jsxs("span",{className:"text-xs text-muted-foreground shrink-0",children:[t.sessions," sessions"]})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[b(t.loc_written)," LOC"]}),e.jsx("span",{className:"font-mono text-sm",children:v(t.cost)})]})]},t.project_path))})]})]}),e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Recent Sessions"}),o.length===0?e.jsx(w,{message:"No sessions"}):e.jsx("div",{className:"space-y-1",children:o.map(t=>e.jsxs(D,{to:`/sessions/${t.session_id}`,className:"flex items-center justify-between text-sm py-1.5 px-2 rounded hover:bg-accent/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[e.jsx("span",{className:"truncate font-medium",children:t.project_display||"Unknown"}),t.is_agent&&e.jsx("span",{className:"text-xs bg-purple-500/20 text-purple-400 px-1.5 py-0.5 rounded",children:"agent"}),e.jsx("span",{className:"text-xs text-muted-foreground shrink-0",children:t.model})]}),e.jsxs("div",{className:"flex items-center gap-3 shrink-0",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.turns," turns"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:O(t.duration_seconds)}),e.jsx("span",{className:"font-mono text-sm",children:v(t.cost)})]})]},t.session_id))})]})]})}export{oe as default};
