import{u as N,j as e}from"./query-vendor-ChV-W4bE.js";import{r as d}from"./react-vendor-yhu9f3WU.js";import{P as Z}from"./PageLayout-D9m6_tUv.js";import{M as J,a as E}from"./MetricCardGrid-B_H6C3FR.js";import{C as h}from"./ChartContainer-CZHP22W9.js";import{D as ue}from"./DataTable-DaAT2w4Q.js";import{E as xe}from"./ErrorState-BLJWzcFK.js";import{E as he}from"./ExportDropdown-B5mNqhEJ.js";import{S as fe}from"./SavedViewsBar-CKmMXSOA.js";import{C as ee,a as te,b as se,c as ae}from"./card-Cst7U1OL.js";import{T as ge,a as pe,b as F,c as D}from"./tabs-BvDJMBb6.js";import{I as je}from"./input-B1u03xxg.js";import{S as ye,a as ve,b as _e,c as Ce,d as re}from"./select-DEp9fouH.js";import{p as k,i as b,j as S,u as Ne,f as n,a as oe,b as f}from"./index-fSpeN2Hc.js";import{f as le,C as o,T as y}from"./chartConfig-C_qPkli-.js";import{A as ne,X as v,Y as _,T as C,b as B,B as ke,e as be,i as ie,j as ce,k as Se}from"./chart-vendor-CnSh9PGG.js";import"./skeleton-D4mSERnM.js";import"./table-ClnvA-zJ.js";import"./index-CAqHlzL7.js";import"./index-BPwOh6t0.js";import"./check-C4JeTEY1.js";import"./download-CBeYuC7_.js";import"./chevron-down-CiMRQC6p.js";function Te(s){return N({queryKey:k.data(s),queryFn:()=>b(`/productivity${S({from:s.from,to:s.to})}`)})}function Le(s){return N({queryKey:k.efficiencyTrend(s),queryFn:()=>b(`/productivity/efficiency-trend${S({from:s.from,to:s.to})}`)})}function we(s){return N({queryKey:k.languageTrend(s),queryFn:()=>b(`/productivity/language-trend${S({from:s.from,to:s.to})}`)})}function Ke(s){return N({queryKey:k.toolSuccessTrend(s),queryFn:()=>b(`/productivity/tool-success-trend${S({from:s.from,to:s.to})}`)})}function Oe(s){return N({queryKey:k.fileChurn(s),queryFn:()=>b(`/productivity/file-churn${S({from:s.from,to:s.to})}`)})}function Ae({x:s,y:i,width:g,height:x,name:c,size:T}){if(g<40||x<30)return null;const m=c?.length>20?"..."+c.slice(-17):c;return e.jsxs("g",{children:[e.jsx("text",{x:s+g/2,y:i+x/2-6,textAnchor:"middle",fill:"var(--color-card-foreground)",fontSize:11,dominantBaseline:"central",children:m??""}),e.jsxs("text",{x:s+g/2,y:i+x/2+10,textAnchor:"middle",fill:"var(--color-muted-foreground)",fontSize:10,dominantBaseline:"central",children:[T??0," edits"]})]})}const Ee=[{accessorKey:"tool_name",header:"Tool",cell:({getValue:s})=>e.jsx("span",{className:"font-medium",children:s()})},{accessorKey:"total_calls",header:()=>e.jsx("div",{className:"text-right",children:"Calls"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:n(s())})},{accessorKey:"success_count",header:()=>e.jsx("div",{className:"text-right",children:"Success"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:n(s())})},{accessorKey:"error_count",header:()=>e.jsx("div",{className:"text-right",children:"Errors"}),cell:({getValue:s})=>{const i=s();return e.jsx("div",{className:"text-right font-mono",children:i>0?e.jsx("span",{className:"text-red-400",children:n(i)}):"0"})}},{accessorKey:"success_rate",header:()=>e.jsx("div",{className:"text-right",children:"Success Rate"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:f(s())})},{accessorKey:"loc_written",header:()=>e.jsx("div",{className:"text-right",children:"LOC"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:n(s())})}];function at(){const{dateRange:s}=Ne(),{data:i,isLoading:g,error:x}=Te(s),{data:c}=Le(s),{data:T}=we(s),{data:m}=Ke(s),{data:L}=Oe(s),[u,V]=d.useState("__all__"),[M,I]=d.useState(""),[H,Y]=d.useState("efficiency"),de=d.useCallback(t=>{V(typeof t.focus_language=="string"?t.focus_language:"__all__"),I(typeof t.tool_search=="string"?t.tool_search:""),Y(typeof t.active_tab=="string"?t.active_tab:"efficiency")},[]),p=d.useMemo(()=>{const t=T??[];return u==="__all__"?t:t.filter(a=>a.language===u)},[T,u]),{pivotedLangData:z,langKeys:q}=d.useMemo(()=>{if(!p||p.length===0)return{pivotedLangData:[],langKeys:[]};const t=[...new Set(p.map(l=>l.language))],a={};for(const l of p)a[l.date]||(a[l.date]={date:l.date}),a[l.date][l.language]=l.loc_written;return{pivotedLangData:le(Object.values(a).sort((l,r)=>l.date.localeCompare(r.date)),t),langKeys:t}},[p]),{pivotedToolData:P,toolKeys:G}=d.useMemo(()=>{if(!m||m.length===0)return{pivotedToolData:[],toolKeys:[]};const t={};for(const r of m)t[r.tool_name]=(t[r.tool_name]??0)+r.total;const a=Object.entries(t).sort((r,$)=>$[1]-r[1]).slice(0,5).map(([r])=>r),j={};for(const r of m)a.includes(r.tool_name)&&(j[r.date]||(j[r.date]={date:r.date}),j[r.date][r.tool_name]=r.success_rate);return{pivotedToolData:le(Object.values(j).sort((r,$)=>r.date.localeCompare($.date)),a),toolKeys:a}},[m]),w=d.useMemo(()=>!L||L.length===0?[]:L.slice(0,50).map((t,a)=>({name:t.file_path.split("/").pop()||t.file_path,size:t.edit_count,fill:o[a%o.length]})),[L]);if(x)return e.jsx(xe,{message:x.message});if(g||!i)return e.jsx(Z,{title:"Productivity",subtitle:"LOC trends, tool usage, and error analysis",children:e.jsx(J,{skeleton:!0,count:4,className:"mb-6"})});const{summary:K,loc_trend:O,languages:W,tool_usage:Q,error_analysis:A,file_hotspots:X}=i,me=W.map(t=>t.language),R=u==="__all__"?W:W.filter(t=>t.language===u),U=Q.filter(t=>t.tool_name.toLowerCase().includes(M.trim().toLowerCase()));return e.jsxs(Z,{title:"Productivity",subtitle:"LOC trends, tool usage, and error analysis",actions:e.jsx(he,{page:"productivity",getData:()=>[...(i?.loc_trend||[]).map(t=>({date:t.date,loc_written:t.loc_written,loc_delivered:t.loc_delivered})),...U.map(t=>({type:"tool",tool_name:t.tool_name,total_calls:t.total_calls,success_rate:t.success_rate}))]}),children:[e.jsx(fe,{page:"productivity",currentFilters:{focus_language:u,tool_search:M,active_tab:H},onApply:de,from:s.from,to:s.to,defaultMetricForAlert:"error_rate"}),e.jsxs("div",{className:"rounded-md border border-border p-3 mb-6 flex flex-wrap items-center gap-3",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"View Filters"}),e.jsxs(ye,{value:u,onValueChange:V,children:[e.jsx(ve,{className:"h-8 w-[220px]",children:e.jsx(_e,{placeholder:"All languages"})}),e.jsxs(Ce,{children:[e.jsx(re,{value:"__all__",children:"All languages"}),me.map(t=>e.jsx(re,{value:t,children:t},t))]})]}),e.jsx(je,{value:M,onChange:t=>I(t.target.value),placeholder:"Filter tools...",className:"h-8 w-[220px]"})]}),e.jsxs(J,{className:"mb-6",children:[e.jsx(E,{title:"LOC Written",value:n(K.total_loc_written)}),e.jsx(E,{title:"LOC Delivered",value:n(K.total_loc_delivered)}),e.jsx(E,{title:"Cost/kLOC",value:oe(K.cost_per_kloc)}),e.jsx(E,{title:"Error Rate",value:f(K.error_rate)})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(h,{title:"LOC Trend",height:256,isEmpty:O.length===0,emptyMessage:"No LOC trend data",children:e.jsxs(ne,{data:O,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"locGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-2)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-2)",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"locDeliveredGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-3)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-3)",stopOpacity:0})]})]}),e.jsx(v,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(_,{tick:{fontSize:11},stroke:"var(--color-muted-foreground)",width:50}),e.jsx(C,{contentStyle:y}),e.jsx(B,{type:"monotone",dataKey:"loc_written",stroke:"var(--color-chart-2)",fill:"url(#locGrad)",strokeWidth:2,name:"LOC Written",isAnimationActive:O.length<365}),e.jsx(B,{type:"monotone",dataKey:"loc_delivered",stroke:"var(--color-chart-3)",fill:"url(#locDeliveredGrad)",strokeWidth:2,name:"LOC Delivered",isAnimationActive:O.length<365})]})}),e.jsx(h,{title:"Languages",height:256,isEmpty:R.length===0,emptyMessage:"No language data",children:e.jsxs(ke,{data:R.slice(0,10),layout:"vertical",children:[e.jsx(v,{type:"number",tick:{fontSize:11},stroke:"var(--color-muted-foreground)"}),e.jsx(_,{type:"category",dataKey:"language",tick:{fontSize:10},width:80,stroke:"var(--color-muted-foreground)"}),e.jsx(C,{contentStyle:y}),e.jsx(be,{dataKey:"loc_written",fill:"var(--color-chart-3)",radius:[0,4,4,0],name:"LOC"})]})})]}),Q.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(ue,{columns:Ee,data:U,emptyMessage:"No tool usage data"})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(ee,{children:[e.jsx(te,{className:"pb-3",children:e.jsx(se,{className:"text-sm font-medium text-muted-foreground",children:"Error Analysis"})}),e.jsxs(ae,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Errors"}),e.jsx("p",{className:"font-mono text-lg",children:n(A.total_errors)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Error Rate"}),e.jsx("p",{className:"font-mono text-lg",children:f(A.error_rate)})]})]}),A.categories.length>0&&e.jsx("div",{className:"space-y-2",children:A.categories.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"truncate",children:t.category}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono",children:n(t.count)}),e.jsx("span",{className:"text-xs text-muted-foreground w-12 text-right",children:f(t.percentage)})]})]},t.category))})]})]}),X.length>0&&e.jsxs(ee,{children:[e.jsx(te,{className:"pb-3",children:e.jsx(se,{className:"text-sm font-medium text-muted-foreground",children:"File Hotspots"})}),e.jsx(ae,{children:e.jsx("div",{className:"space-y-2",children:X.slice(0,15).map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"truncate font-mono text-xs flex-1 min-w-0",children:t.file_path}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 ml-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.total_touches," touches"]}),e.jsxs("span",{className:"font-mono text-xs",children:[n(t.loc_written)," LOC"]})]})]},t.file_path))})})]})]}),e.jsxs(ge,{value:H,onValueChange:Y,className:"mb-6",children:[e.jsxs(pe,{children:[e.jsx(F,{value:"efficiency",children:"LOC Efficiency"}),e.jsx(F,{value:"language",children:"Language Trend"}),e.jsx(F,{value:"toolsuccess",children:"Tool Success Rate"}),e.jsx(F,{value:"filechurn",children:"File Churn"})]}),e.jsx(D,{value:"efficiency",children:e.jsx(h,{title:"LOC Efficiency Trend",height:256,isEmpty:!c||c.length===0,emptyMessage:"No efficiency trend data",children:e.jsxs(ie,{data:c??[],children:[e.jsx(v,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(_,{tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(C,{contentStyle:y,formatter:t=>[oe(t??0),"Cost/kLOC"]}),e.jsx(ce,{type:"monotone",dataKey:"cost_per_kloc",stroke:"var(--color-chart-1)",strokeWidth:2,dot:!1,name:"Cost/kLOC",isAnimationActive:(c??[]).length<365})]})})}),e.jsxs(D,{value:"language",children:[e.jsx(h,{title:"Language Trend",height:256,isEmpty:z.length===0,emptyMessage:"No language trend data",children:e.jsxs(ne,{data:z,children:[e.jsx(v,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(_,{tick:{fontSize:11},stroke:"var(--color-muted-foreground)",width:50}),e.jsx(C,{contentStyle:y,formatter:(t,a)=>[n(t??0),a??""]}),q.map((t,a)=>e.jsx(B,{type:"monotone",dataKey:t,stackId:"lang",stroke:o[a%o.length],fill:o[a%o.length],fillOpacity:.6,strokeWidth:1,isAnimationActive:z.length<365},t))]})}),q.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3 mt-2",children:q.map((t,a)=>e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:o[a%o.length]}}),t]},t))})]}),e.jsxs(D,{value:"toolsuccess",children:[e.jsx(h,{title:"Tool Success Rate Trend",height:256,isEmpty:P.length===0,emptyMessage:"No tool success trend data",children:e.jsxs(ie,{data:P,children:[e.jsx(v,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(_,{tick:{fontSize:11},tickFormatter:t=>f(t??0),stroke:"var(--color-muted-foreground)",width:50,domain:[0,1]}),e.jsx(C,{contentStyle:y,formatter:(t,a)=>[f(t??0),a??""]}),G.map((t,a)=>e.jsx(ce,{type:"monotone",dataKey:t,stroke:o[a%o.length],strokeWidth:2,dot:!1,name:t,isAnimationActive:P.length<365},t))]})}),G.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3 mt-2",children:G.map((t,a)=>e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:o[a%o.length]}}),t]},t))})]}),e.jsxs(D,{value:"filechurn",children:[e.jsx(h,{title:"File Churn",height:320,isEmpty:w.length===0,emptyMessage:"No file churn data",children:e.jsx(Se,{data:w,dataKey:"size",aspectRatio:4/3,stroke:"var(--color-border)",content:e.jsx(Ae,{})})}),w.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Showing top ",w.length," files by edit count"]})]})]})]})}export{at as default};
