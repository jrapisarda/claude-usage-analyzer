import{u as N,j as e}from"./query-vendor-ChV-W4bE.js";import{r as q}from"./react-vendor-yhu9f3WU.js";import{P as B}from"./PageLayout-DPasqS-O.js";import{M as H,a as O}from"./MetricCardGrid-GOuSrQkO.js";import{C as x}from"./ChartContainer-B3BCIAzK.js";import{D as ee}from"./DataTable-CGiFMBH3.js";import{E as te}from"./ErrorState-C7Oppa98.js";import{E as se}from"./ExportDropdown-pO8U-Rrj.js";import{C as Y,a as I,b as Q,c as X}from"./card-Byyeu849.js";import{T as re,a as ae,b as w,c as E}from"./tabs-BRXr9TnN.js";import{p as C,h as _,i as k,u as oe,f as i,a as R,b as h}from"./index-nDEx28AN.js";import{f as V,C as o,T as g}from"./chartConfig-CHOlO3Nn.js";import{A as Z,X as j,Y as y,T as v,b as P,B as le,e as ne,i as J,j as U,k as ie}from"./chart-vendor-CnSh9PGG.js";import"./skeleton-CAkgKQJz.js";import"./table-h59HnL4K.js";import"./index-DJw7Jyye.js";import"./index-B0KDN0qm.js";import"./check-rFaXumxH.js";import"./download-BJY-9Kou.js";function ce(s){return N({queryKey:C.data(s),queryFn:()=>_(`/productivity${k({from:s.from,to:s.to})}`)})}function de(s){return N({queryKey:C.efficiencyTrend(s),queryFn:()=>_(`/productivity/efficiency-trend${k({from:s.from,to:s.to})}`)})}function me(s){return N({queryKey:C.languageTrend(s),queryFn:()=>_(`/productivity/language-trend${k({from:s.from,to:s.to})}`)})}function ue(s){return N({queryKey:C.toolSuccessTrend(s),queryFn:()=>_(`/productivity/tool-success-trend${k({from:s.from,to:s.to})}`)})}function xe(s){return N({queryKey:C.fileChurn(s),queryFn:()=>_(`/productivity/file-churn${k({from:s.from,to:s.to})}`)})}function he({x:s,y:n,width:f,height:u,name:c,size:d}){if(f<40||u<30)return null;const m=c?.length>20?"..."+c.slice(-17):c;return e.jsxs("g",{children:[e.jsx("text",{x:s+f/2,y:n+u/2-6,textAnchor:"middle",fill:"var(--color-card-foreground)",fontSize:11,dominantBaseline:"central",children:m??""}),e.jsxs("text",{x:s+f/2,y:n+u/2+10,textAnchor:"middle",fill:"var(--color-muted-foreground)",fontSize:10,dominantBaseline:"central",children:[d??0," edits"]})]})}const fe=[{accessorKey:"tool_name",header:"Tool",cell:({getValue:s})=>e.jsx("span",{className:"font-medium",children:s()})},{accessorKey:"total_calls",header:()=>e.jsx("div",{className:"text-right",children:"Calls"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:i(s())})},{accessorKey:"success_count",header:()=>e.jsx("div",{className:"text-right",children:"Success"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:i(s())})},{accessorKey:"error_count",header:()=>e.jsx("div",{className:"text-right",children:"Errors"}),cell:({getValue:s})=>{const n=s();return e.jsx("div",{className:"text-right font-mono",children:n>0?e.jsx("span",{className:"text-red-400",children:i(n)}):"0"})}},{accessorKey:"success_rate",header:()=>e.jsx("div",{className:"text-right",children:"Success Rate"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:h(s())})},{accessorKey:"loc_written",header:()=>e.jsx("div",{className:"text-right",children:"LOC"}),cell:({getValue:s})=>e.jsx("div",{className:"text-right font-mono",children:i(s())})}];function Fe(){const{dateRange:s}=oe(),{data:n,isLoading:f,error:u}=ce(s),{data:c}=de(s),{data:d}=me(s),{data:m}=ue(s),{data:T}=xe(s),{pivotedLangData:D,langKeys:A}=q.useMemo(()=>{if(!d||d.length===0)return{pivotedLangData:[],langKeys:[]};const t=[...new Set(d.map(l=>l.language))],r={};for(const l of d)r[l.date]||(r[l.date]={date:l.date}),r[l.date][l.language]=l.loc_written;return{pivotedLangData:V(Object.values(r).sort((l,a)=>l.date.localeCompare(a.date)),t),langKeys:t}},[d]),{pivotedToolData:F,toolKeys:z}=q.useMemo(()=>{if(!m||m.length===0)return{pivotedToolData:[],toolKeys:[]};const t={};for(const a of m)t[a.tool_name]=(t[a.tool_name]??0)+a.total;const r=Object.entries(t).sort((a,M)=>M[1]-a[1]).slice(0,5).map(([a])=>a),p={};for(const a of m)r.includes(a.tool_name)&&(p[a.date]||(p[a.date]={date:a.date}),p[a.date][a.tool_name]=a.success_rate);return{pivotedToolData:V(Object.values(p).sort((a,M)=>a.date.localeCompare(M.date)),r),toolKeys:r}},[m]),b=q.useMemo(()=>!T||T.length===0?[]:T.slice(0,50).map((t,r)=>({name:t.file_path.split("/").pop()||t.file_path,size:t.edit_count,fill:o[r%o.length]})),[T]);if(u)return e.jsx(te,{message:u.message});if(f||!n)return e.jsx(B,{title:"Productivity",subtitle:"LOC trends, tool usage, and error analysis",children:e.jsx(H,{skeleton:!0,count:4,className:"mb-6"})});const{summary:L,loc_trend:K,languages:G,tool_usage:W,error_analysis:S,file_hotspots:$}=n;return e.jsxs(B,{title:"Productivity",subtitle:"LOC trends, tool usage, and error analysis",actions:e.jsx(se,{page:"productivity",getData:()=>[...(n?.loc_trend||[]).map(t=>({date:t.date,loc_written:t.loc_written,loc_delivered:t.loc_delivered})),...(n?.tool_usage||[]).map(t=>({type:"tool",tool_name:t.tool_name,total_calls:t.total_calls,success_rate:t.success_rate}))]}),children:[e.jsxs(H,{className:"mb-6",children:[e.jsx(O,{title:"LOC Written",value:i(L.total_loc_written)}),e.jsx(O,{title:"LOC Delivered",value:i(L.total_loc_delivered)}),e.jsx(O,{title:"Cost/kLOC",value:R(L.cost_per_kloc)}),e.jsx(O,{title:"Error Rate",value:h(L.error_rate)})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx(x,{title:"LOC Trend",height:256,isEmpty:K.length===0,emptyMessage:"No LOC trend data",children:e.jsxs(Z,{data:K,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"locGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-2)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-2)",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"locDeliveredGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-3)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-3)",stopOpacity:0})]})]}),e.jsx(j,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(y,{tick:{fontSize:11},stroke:"var(--color-muted-foreground)",width:50}),e.jsx(v,{contentStyle:g}),e.jsx(P,{type:"monotone",dataKey:"loc_written",stroke:"var(--color-chart-2)",fill:"url(#locGrad)",strokeWidth:2,name:"LOC Written",isAnimationActive:K.length<365}),e.jsx(P,{type:"monotone",dataKey:"loc_delivered",stroke:"var(--color-chart-3)",fill:"url(#locDeliveredGrad)",strokeWidth:2,name:"LOC Delivered",isAnimationActive:K.length<365})]})}),e.jsx(x,{title:"Languages",height:256,isEmpty:G.length===0,emptyMessage:"No language data",children:e.jsxs(le,{data:G.slice(0,10),layout:"vertical",children:[e.jsx(j,{type:"number",tick:{fontSize:11},stroke:"var(--color-muted-foreground)"}),e.jsx(y,{type:"category",dataKey:"language",tick:{fontSize:10},width:80,stroke:"var(--color-muted-foreground)"}),e.jsx(v,{contentStyle:g}),e.jsx(ne,{dataKey:"loc_written",fill:"var(--color-chart-3)",radius:[0,4,4,0],name:"LOC"})]})})]}),W.length>0&&e.jsx("div",{className:"mb-6",children:e.jsx(ee,{columns:fe,data:W,emptyMessage:"No tool usage data"})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs(Y,{children:[e.jsx(I,{className:"pb-3",children:e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"Error Analysis"})}),e.jsxs(X,{children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Errors"}),e.jsx("p",{className:"font-mono text-lg",children:i(S.total_errors)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Error Rate"}),e.jsx("p",{className:"font-mono text-lg",children:h(S.error_rate)})]})]}),S.categories.length>0&&e.jsx("div",{className:"space-y-2",children:S.categories.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"truncate",children:t.category}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono",children:i(t.count)}),e.jsx("span",{className:"text-xs text-muted-foreground w-12 text-right",children:h(t.percentage)})]})]},t.category))})]})]}),$.length>0&&e.jsxs(Y,{children:[e.jsx(I,{className:"pb-3",children:e.jsx(Q,{className:"text-sm font-medium text-muted-foreground",children:"File Hotspots"})}),e.jsx(X,{children:e.jsx("div",{className:"space-y-2",children:$.slice(0,15).map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"truncate font-mono text-xs flex-1 min-w-0",children:t.file_path}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 ml-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.total_touches," touches"]}),e.jsxs("span",{className:"font-mono text-xs",children:[i(t.loc_written)," LOC"]})]})]},t.file_path))})})]})]}),e.jsxs(re,{defaultValue:"efficiency",className:"mb-6",children:[e.jsxs(ae,{children:[e.jsx(w,{value:"efficiency",children:"LOC Efficiency"}),e.jsx(w,{value:"language",children:"Language Trend"}),e.jsx(w,{value:"toolsuccess",children:"Tool Success Rate"}),e.jsx(w,{value:"filechurn",children:"File Churn"})]}),e.jsx(E,{value:"efficiency",children:e.jsx(x,{title:"LOC Efficiency Trend",height:256,isEmpty:!c||c.length===0,emptyMessage:"No efficiency trend data",children:e.jsxs(J,{data:c??[],children:[e.jsx(j,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(y,{tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(v,{contentStyle:g,formatter:t=>[R(t??0),"Cost/kLOC"]}),e.jsx(U,{type:"monotone",dataKey:"cost_per_kloc",stroke:"var(--color-chart-1)",strokeWidth:2,dot:!1,name:"Cost/kLOC",isAnimationActive:(c??[]).length<365})]})})}),e.jsxs(E,{value:"language",children:[e.jsx(x,{title:"Language Trend",height:256,isEmpty:D.length===0,emptyMessage:"No language trend data",children:e.jsxs(Z,{data:D,children:[e.jsx(j,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(y,{tick:{fontSize:11},stroke:"var(--color-muted-foreground)",width:50}),e.jsx(v,{contentStyle:g,formatter:(t,r)=>[i(t??0),r??""]}),A.map((t,r)=>e.jsx(P,{type:"monotone",dataKey:t,stackId:"lang",stroke:o[r%o.length],fill:o[r%o.length],fillOpacity:.6,strokeWidth:1,isAnimationActive:D.length<365},t))]})}),A.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3 mt-2",children:A.map((t,r)=>e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:o[r%o.length]}}),t]},t))})]}),e.jsxs(E,{value:"toolsuccess",children:[e.jsx(x,{title:"Tool Success Rate Trend",height:256,isEmpty:F.length===0,emptyMessage:"No tool success trend data",children:e.jsxs(J,{data:F,children:[e.jsx(j,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(y,{tick:{fontSize:11},tickFormatter:t=>h(t??0),stroke:"var(--color-muted-foreground)",width:50,domain:[0,1]}),e.jsx(v,{contentStyle:g,formatter:(t,r)=>[h(t??0),r??""]}),z.map((t,r)=>e.jsx(U,{type:"monotone",dataKey:t,stroke:o[r%o.length],strokeWidth:2,dot:!1,name:t,isAnimationActive:F.length<365},t))]})}),z.length>0&&e.jsx("div",{className:"flex flex-wrap gap-3 mt-2",children:z.map((t,r)=>e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:o[r%o.length]}}),t]},t))})]}),e.jsxs(E,{value:"filechurn",children:[e.jsx(x,{title:"File Churn",height:320,isEmpty:b.length===0,emptyMessage:"No file churn data",children:e.jsx(ie,{data:b,dataKey:"size",aspectRatio:4/3,stroke:"var(--color-border)",content:e.jsx(he,{})})}),b.length>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Showing top ",b.length," files by edit count"]})]})]})]})}export{Fe as default};
