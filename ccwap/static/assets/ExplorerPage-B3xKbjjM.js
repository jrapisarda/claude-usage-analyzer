import{u as fe,j as e}from"./query-vendor-ChV-W4bE.js";import{r as x}from"./react-vendor-yhu9f3WU.js";import{P as Ke}from"./PageLayout-CP8ZAjnu.js";import{M as ne,a as P}from"./MetricCardGrid-BMhtdYel.js";import{C as j}from"./ChartContainer-BK_oE6Jh.js";import{D as Re}from"./DataTable-DqBtd-Wo.js";import{E as re}from"./EmptyState-Cd9vj59h.js";import{E as Me}from"./ErrorState-DPtgyu34.js";import{C as oe,a as ie,b as ce,c as de}from"./card-B4TCiekP.js";import{h as be,i as ye,Y as _e,u as Ae,f as B,a as Le,c as Ee,_ as Oe,$ as Pe,B as $e,X as ze,d as Be,a0 as Ie,e as Ge}from"./index-BNVVTlCA.js";import{S as Fe}from"./skeleton-D4i8jAoN.js";import{S as Q,a as U,b as X,c as H,e as Ve,f as qe,d as $}from"./select-CVPjjUV4.js";import{f as ue,C as l,T as f}from"./chartConfig-CHOlO3Nn.js";import{i as pe,X as S,Y as T,T as b,j as me,A as xe,b as he,L,B as Z,e as J,P as We,f as Ye,C as Qe,d as Ue,k as Xe,l as He,m as Ze,n as Je,o as et,p as tt}from"./chart-vendor-CnSh9PGG.js";import{C as at}from"./chevron-down-DhfDx3KE.js";import"./table-BUskT_TB.js";import"./index-CR7wKcdR.js";import"./check-Cz8gpq5W.js";function st(s){return fe({queryKey:_e.query(s),queryFn:()=>be(`/explorer${ye({metric:s.metric,group_by:s.group_by,split_by:s.split_by,from:s.from,to:s.to,projects:s.projects,models:s.models,branches:s.branches,languages:s.languages})}`),enabled:!!s.metric&&!!s.group_by})}function lt(s,n){return fe({queryKey:_e.filters(s,n),queryFn:()=>be(`/explorer/filters${ye({from:s,to:n})}`)})}const ge=[{value:"cost",label:"Cost ($)",group:"Turns"},{value:"input_tokens",label:"Input Tokens",group:"Turns"},{value:"output_tokens",label:"Output Tokens",group:"Turns"},{value:"cache_read_tokens",label:"Cache Read Tokens",group:"Turns"},{value:"cache_write_tokens",label:"Cache Write Tokens",group:"Turns"},{value:"ephemeral_5m_tokens",label:"Ephemeral 5m Tokens",group:"Turns"},{value:"ephemeral_1h_tokens",label:"Ephemeral 1h Tokens",group:"Turns"},{value:"thinking_chars",label:"Thinking Chars",group:"Turns"},{value:"turns_count",label:"Turns Count",group:"Turns"},{value:"loc_written",label:"LOC Written",group:"Tools"},{value:"tool_calls_count",label:"Tool Calls",group:"Tools"},{value:"errors",label:"Errors",group:"Tools"},{value:"lines_added",label:"Lines Added",group:"Tools"},{value:"lines_deleted",label:"Lines Deleted",group:"Tools"},{value:"sessions_count",label:"Sessions",group:"Sessions"},{value:"duration_seconds",label:"Duration (s)",group:"Sessions"}],je=[{value:"date",label:"Date"},{value:"model",label:"Model"},{value:"project",label:"Project"},{value:"branch",label:"Branch"},{value:"language",label:"Language"},{value:"tool_name",label:"Tool Name"},{value:"cc_version",label:"CC Version"},{value:"entry_type",label:"Entry Type"},{value:"is_agent",label:"Agent/User"}],nt=new Set(["date","model","project","branch","cc_version","entry_type","is_agent"]),rt=new Set(["date","model","project","branch","language","tool_name","cc_version","entry_type","is_agent"]),ot=new Set(["date","project","branch","cc_version","is_agent"]),it=new Set(["cost","input_tokens","output_tokens","cache_read_tokens","cache_write_tokens","ephemeral_5m_tokens","ephemeral_1h_tokens","thinking_chars","turns_count"]),ct=new Set(["loc_written","tool_calls_count","errors","lines_added","lines_deleted"]);function dt(s){return s?it.has(s)?nt:ct.has(s)?rt:ot:new Set}function ee(s,n){return n==="cost"?Le(s):n==="duration_seconds"?Ee(s):B(s)}function z({label:s,options:n,selected:p,onChange:_}){const[D,k]=x.useState(!1),E=x.useCallback(o=>{_(p.includes(o)?p.filter(I=>I!==o):[...p,o])},[p,_]);return e.jsxs(Oe,{open:D,onOpenChange:k,children:[e.jsx(Pe,{asChild:!0,children:e.jsxs($e,{variant:"outline",role:"combobox","aria-expanded":D,className:Be("w-full justify-between text-sm font-normal h-9",p.length>0&&"ring-1 ring-primary/30"),children:[e.jsx("span",{className:"truncate",children:p.length>0?`${s} (${p.length})`:s}),e.jsxs("div",{className:"flex items-center gap-1 shrink-0 ml-1",children:[p.length>0&&e.jsx(ze,{className:"h-3 w-3 text-muted-foreground hover:text-foreground",onClick:o=>{o.stopPropagation(),_([])}}),e.jsx(at,{className:"h-3.5 w-3.5 text-muted-foreground"})]})]})}),e.jsx(Ie,{className:"w-64 p-0",align:"start",children:e.jsx(Ge,{className:"max-h-60",children:e.jsx("div",{className:"p-1",children:n.length===0?e.jsx("p",{className:"px-3 py-2 text-xs text-muted-foreground",children:"No options"}):n.map(o=>e.jsxs("label",{className:"flex items-center gap-2 px-3 py-1.5 hover:bg-accent/50 cursor-pointer text-sm rounded-sm",children:[e.jsx("input",{type:"checkbox",checked:p.includes(o.value),onChange:()=>E(o.value),className:"rounded border-border"}),e.jsx("span",{className:"flex-1 truncate",children:o.label}),e.jsx("span",{className:"text-xs text-muted-foreground",children:o.count})]},o.value))})})})]})}function wt(){const{dateRange:s}=Ae(),[n,p]=x.useState(null),[_,D]=x.useState(null),[k,E]=x.useState(null),[o,I]=x.useState([]),[G,ve]=x.useState([]),[F,Se]=x.useState([]),[V,Te]=x.useState([]),C=dt(n),h=_&&C.has(_)?_:null,N=k&&C.has(k)&&k!==h?k:null,ke={metric:n,group_by:h,split_by:N,from:s.from,to:s.to,projects:o.length?o.join(","):null,models:G.length?G.join(","):null,branches:F.length?F.join(","):null,languages:V.length?V.join(","):null},{data:c,isLoading:Ce,error:te}=st(ke),{data:w}=lt(s.from,s.to),v=h==="date",m=!!N,i=ge.find(t=>t.value===n)?.label??n??"",{timeData:O,catData:q,pieData:ae,treemapData:Ne,radarData:W,splitKeys:K,tableRows:se}=x.useMemo(()=>{if(!c||c.rows.length===0)return{timeData:[],catData:[],pieData:[],treemapData:[],radarData:[],splitKeys:[],tableRows:[]};const t=c.rows,a=c.metadata.splits;if(v&&m){const r=new Map;for(const u of t){r.has(u.group)||r.set(u.group,{date:u.group});const M=r.get(u.group);M[u.split??""]=u.value}return{timeData:ue(Array.from(r.values()).sort((u,M)=>u.date.localeCompare(M.date)),a),catData:[],pieData:[],treemapData:[],radarData:[],splitKeys:a,tableRows:t}}if(v)return{timeData:[...t].map(d=>({date:d.group,value:d.value})).sort((d,u)=>d.date.localeCompare(u.date)),catData:[],pieData:[],treemapData:[],radarData:[],splitKeys:[],tableRows:t};if(m){const r=new Map;for(const g of t){r.has(g.group)||r.set(g.group,{name:g.group,total:0});const A=r.get(g.group);A[g.split??""]=g.value,A.total=(A.total||0)+g.value}const d=ue(Array.from(r.values()).sort((g,A)=>A.total-g.total),a),u=d.slice(0,20),M=d.slice(0,8);return{timeData:[],catData:u,pieData:[],treemapData:[],radarData:M,splitKeys:a,tableRows:t}}const y=[...t].map(r=>({name:r.group,value:r.value})).sort((r,d)=>d.value-r.value),R=y.slice(0,20),Y=y.slice(0,10),we=y.slice(0,30).map((r,d)=>({...r,fill:l[d%l.length]}));return{timeData:[],catData:R,pieData:Y,treemapData:we,radarData:[],splitKeys:[],tableRows:t}},[c,v,m]),De=x.useMemo(()=>{const t=[{accessorKey:"group",header:h??"Group",cell:({row:a})=>e.jsx("span",{children:a.original.group})}];return m&&t.push({accessorKey:"split",header:N??"Split",cell:({row:a})=>e.jsx("span",{children:a.original.split})}),t.push({accessorKey:"value",header:()=>e.jsx("span",{className:"text-right block",children:i}),cell:({row:a})=>e.jsx("span",{className:"font-mono text-right block",children:ee(a.original.value,n)})}),t},[h,N,m,i,n]);return e.jsxs(Ke,{title:"Data Explorer",subtitle:"Query any metric by any dimension",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-3 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Metric"}),e.jsxs(Q,{value:n??"__none__",onValueChange:t=>{p(t==="__none__"?null:t),D(null),E(null)},children:[e.jsx(U,{children:e.jsx(X,{placeholder:"Select metric..."})}),e.jsx(H,{children:["Turns","Tools","Sessions"].map(t=>e.jsxs(Ve,{children:[e.jsx(qe,{children:t}),ge.filter(a=>a.group===t).map(a=>e.jsx($,{value:a.value,children:a.label},a.value))]},t))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Group By"}),e.jsxs(Q,{value:h??"__none__",onValueChange:t=>D(t==="__none__"?null:t),disabled:!n,children:[e.jsx(U,{children:e.jsx(X,{placeholder:"Select dimension..."})}),e.jsx(H,{children:je.map(t=>e.jsxs($,{value:t.value,disabled:!C.has(t.value),children:[t.label,C.has(t.value)?"":" (N/A)"]},t.value))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-muted-foreground mb-1",children:"Split By (optional)"}),e.jsxs(Q,{value:N??"__none__",onValueChange:t=>E(t==="__none__"?null:t),disabled:!n||!h,children:[e.jsx(U,{children:e.jsx(X,{placeholder:"None"})}),e.jsxs(H,{children:[e.jsx($,{value:"__none__",children:"None"}),je.filter(t=>t.value!==h).map(t=>e.jsxs($,{value:t.value,disabled:!C.has(t.value),children:[t.label,C.has(t.value)?"":" (N/A)"]},t.value))]})]})]})]}),w&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-6",children:[e.jsx(z,{label:"Projects",options:w.projects,selected:o,onChange:I}),e.jsx(z,{label:"Models",options:w.models,selected:G,onChange:ve}),e.jsx(z,{label:"Branches",options:w.branches,selected:F,onChange:Se}),e.jsx(z,{label:"Languages",options:w.languages,selected:V,onChange:Te})]}),!n||!h?e.jsx(re,{message:"Select a metric and dimension to explore"}):Ce?e.jsxs("div",{className:"space-y-4",children:[e.jsx(ne,{skeleton:!0,count:4}),e.jsx(Fe,{className:"h-80 w-full"})]}):te?e.jsx(Me,{message:te.message}):!c||c.rows.length===0?e.jsx(re,{message:"No data for current selection"}):e.jsxs(e.Fragment,{children:[e.jsxs(ne,{className:"mb-6",children:[e.jsx(P,{title:"Total",value:ee(c.metadata.total,n)}),e.jsx(P,{title:"Data Points",value:B(c.metadata.row_count)}),e.jsx(P,{title:"Groups",value:B(c.metadata.groups.length)}),e.jsx(P,{title:m?"Splits":"Avg per Group",value:m?B(c.metadata.splits.length):ee(c.metadata.total/Math.max(c.metadata.groups.length,1),n)})]}),v&&!m&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(j,{title:`${i} Over Time`,height:320,children:e.jsxs(pe,{data:O,children:[e.jsx(S,{dataKey:"date",tick:{fontSize:10}}),e.jsx(T,{tick:{fontSize:10}}),e.jsx(b,{contentStyle:f}),e.jsx(me,{type:"monotone",dataKey:"value",stroke:l[0],strokeWidth:2,dot:{r:3},name:i})]})}),e.jsx(j,{title:`${i} Over Time`,height:320,children:e.jsxs(xe,{data:O,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"explorerGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:l[0],stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:l[0],stopOpacity:0})]})}),e.jsx(S,{dataKey:"date",tick:{fontSize:10}}),e.jsx(T,{tick:{fontSize:10}}),e.jsx(b,{contentStyle:f}),e.jsx(he,{type:"monotone",dataKey:"value",stroke:l[0],fill:"url(#explorerGrad)",name:i})]})})]}),v&&m&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(j,{title:`${i} by ${N}`,height:320,children:e.jsxs(pe,{data:O,children:[e.jsx(S,{dataKey:"date",tick:{fontSize:10}}),e.jsx(T,{tick:{fontSize:10}}),e.jsx(b,{contentStyle:f}),e.jsx(L,{}),K.map((t,a)=>e.jsx(me,{type:"monotone",dataKey:t,stroke:l[a%l.length],strokeWidth:2,dot:!1,name:t},t))]})}),e.jsx(j,{title:`${i} Stacked`,height:320,children:e.jsxs(xe,{data:O,children:[e.jsx(S,{dataKey:"date",tick:{fontSize:10}}),e.jsx(T,{tick:{fontSize:10}}),e.jsx(b,{contentStyle:f}),e.jsx(L,{}),K.map((t,a)=>e.jsx(he,{type:"monotone",dataKey:t,stackId:"1",stroke:l[a%l.length],fill:l[a%l.length],fillOpacity:.4,name:t},t))]})})]}),!v&&!m&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(j,{title:`${i} by ${h}`,height:320,children:e.jsxs(Z,{data:q,layout:"vertical",children:[e.jsx(S,{type:"number",tick:{fontSize:10}}),e.jsx(T,{dataKey:"name",type:"category",width:100,tick:{fontSize:10}}),e.jsx(b,{contentStyle:f}),e.jsx(J,{dataKey:"value",fill:l[0],radius:[0,4,4,0],name:i})]})}),e.jsx(j,{title:`${i} Distribution`,height:320,children:e.jsxs(We,{children:[e.jsx(Ye,{data:ae,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",innerRadius:60,outerRadius:100,paddingAngle:2,label:({name:t,percent:a})=>`${t} ${(a*100).toFixed(0)}%`,labelLine:{strokeWidth:1},children:ae.map((t,a)=>e.jsx(Qe,{fill:l[a%l.length]},a))}),e.jsx(b,{contentStyle:f})]})}),e.jsxs(oe,{children:[e.jsxs(ie,{className:"pb-3 pt-4 px-4",children:[e.jsxs(ce,{className:"text-sm font-medium text-muted-foreground",children:[i," Treemap"]}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Top 30 by size"})]}),e.jsx(de,{className:"px-4 pb-4",children:e.jsx("div",{className:"h-80",children:e.jsx(Ue,{width:"100%",height:"100%",children:e.jsx(Xe,{data:Ne,dataKey:"value",nameKey:"name",stroke:"var(--color-border)",content:({x:t,y:a,width:y,height:R,name:Y,fill:le})=>e.jsxs("g",{children:[e.jsx("rect",{x:t,y:a,width:y,height:R,fill:le,rx:2}),y>=30&&R>=20&&e.jsx("text",{x:t+y/2,y:a+R/2,textAnchor:"middle",dominantBaseline:"middle",fill:"white",fontSize:10,children:String(Y??"").slice(0,Math.floor(y/7))})]})})})})})]})]}),!v&&m&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(j,{title:`${i} Grouped`,height:320,children:e.jsxs(Z,{data:q,children:[e.jsx(S,{dataKey:"name",tick:{fontSize:10},angle:-30,textAnchor:"end",height:60}),e.jsx(T,{tick:{fontSize:10}}),e.jsx(b,{contentStyle:f}),e.jsx(L,{}),K.map((t,a)=>e.jsx(J,{dataKey:t,fill:l[a%l.length],radius:[4,4,0,0],name:t},t))]})}),e.jsx(j,{title:`${i} Stacked`,height:320,children:e.jsxs(Z,{data:q,children:[e.jsx(S,{dataKey:"name",tick:{fontSize:10},angle:-30,textAnchor:"end",height:60}),e.jsx(T,{tick:{fontSize:10}}),e.jsx(b,{contentStyle:f}),e.jsx(L,{}),K.map((t,a)=>e.jsx(J,{dataKey:t,stackId:"stack",fill:l[a%l.length],name:t},t))]})}),W.length>0&&W.length<=8&&e.jsx(j,{title:`${i} Radar`,height:320,children:e.jsxs(He,{data:W,children:[e.jsx(Ze,{}),e.jsx(Je,{dataKey:"name",tick:{fontSize:10}}),e.jsx(et,{tick:{fontSize:9}}),K.map((t,a)=>e.jsx(tt,{dataKey:t,stroke:l[a%l.length],fill:l[a%l.length],fillOpacity:.2,name:t},t)),e.jsx(L,{}),e.jsx(b,{contentStyle:f})]})})]}),e.jsxs(oe,{children:[e.jsxs(ie,{className:"pb-3 pt-4 px-4",children:[e.jsx(ce,{className:"text-sm font-medium text-muted-foreground",children:"Raw Data"}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[se.length," rows (max 100 shown)"]})]}),e.jsx(de,{className:"px-4 pb-4",children:e.jsx(Re,{columns:De,data:se.slice(0,100),emptyMessage:"No data"})})]})]})]})}export{wt as default};
