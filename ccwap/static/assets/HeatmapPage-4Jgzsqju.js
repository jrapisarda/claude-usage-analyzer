import{u as H,j as e}from"./query-vendor-ChV-W4bE.js";import{r as i}from"./react-vendor-yhu9f3WU.js";import{q as T,i as D,j as M,u as E,a as S,f as L}from"./index-DOoA8ygH.js";import{P as N}from"./PageLayout-DNcy9VzK.js";import{M as $,a as m}from"./MetricCardGrid-DncIdQee.js";import{E as V}from"./ErrorState-D6SGc0M3.js";import{E as _}from"./ExportDropdown-CT7rv4rS.js";import{H as w}from"./HeatmapGrid-C4Wa4OOX.js";import{C as A,a as P,b as R,c as F}from"./card-D1bak8k5.js";import{T as q,a as G,b as I}from"./tabs-D_mtJQl8.js";import"./chart-vendor-Dwd1Lo9s.js";import"./skeleton-4dVV08Mr.js";import"./index-yuhgJcXM.js";import"./index-B8TGfkCk.js";import"./check-DFm9GFPS.js";import"./download-CnbNskfO.js";function K(r,s){return H({queryKey:T.data(r,s),queryFn:()=>D(`/heatmap${M({from:r.from,to:r.to,metric:s})}`)})}const Q=["sessions","cost","loc","tool_calls"],p={sessions:"Sessions",cost:"Cost",loc:"Lines of Code",tool_calls:"Tool Calls"},d=["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],B=Array.from({length:24},(r,s)=>`${s}`);function ua(){const{dateRange:r}=E(),[s,y]=i.useState("sessions"),{data:t,isLoading:f,error:x,refetch:j}=K(r,s),o=i.useMemo(()=>s==="cost"?a=>S(a):a=>L(a),[s]),b=i.useMemo(()=>t?t.cells.filter(a=>a.day>=0&&a.day<7&&a.hour>=0&&a.hour<24).map(a=>({row:a.day,col:a.hour,value:a.value})):[],[t]),{total:v,peakDay:C,peakHour:g,peakVal:h}=i.useMemo(()=>{if(!t||t.cells.length===0)return{total:0,peakDay:0,peakHour:0,peakVal:0};let a=0,u=0,n=0,c=0;for(const l of t.cells)a+=l.value,l.value>c&&(c=l.value,u=l.day,n=l.hour);return{total:a,peakDay:u,peakHour:n,peakVal:c}},[t]),k=i.useCallback(()=>t?t.cells.map(a=>({day:d[a.day]||a.day,hour:a.hour,value:a.value,metric:s})):[],[t,s]);return x?e.jsx(V,{message:x.message,onRetry:()=>j()}):e.jsxs(N,{title:"Activity Heatmap",subtitle:"Hourly activity patterns across days of the week",actions:e.jsx(_,{page:"heatmap",getData:k}),children:[e.jsx(q,{value:s,onValueChange:a=>y(a),className:"mb-6",children:e.jsx(G,{children:Q.map(a=>e.jsx(I,{value:a,children:p[a]},a))})}),e.jsxs(A,{className:"mb-4",children:[e.jsx(P,{className:"pb-2",children:e.jsxs(R,{className:"text-sm font-medium text-muted-foreground",children:[p[s]," by Day & Hour"]})}),e.jsx(F,{children:f?e.jsx("div",{className:"flex items-center justify-center h-48",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):t?e.jsx(w,{data:b,rowLabels:d,colLabels:B,maxValue:t.max_value,formatValue:o,formatTooltip:(a,u,n)=>`${a} ${u}:00 - ${o(n)}`}):null})]}),e.jsx($,{skeleton:f,count:4,children:t&&e.jsxs(e.Fragment,{children:[e.jsx(m,{title:`Total ${p[s]}`,value:o(v)}),e.jsx(m,{title:"Peak Day",value:d[C]||"N/A",subtitle:o(h)}),e.jsx(m,{title:"Peak Hour",value:`${g}:00`,subtitle:o(h)}),e.jsx(m,{title:"Max Cell",value:o(t.max_value)})]})})]})}export{ua as default};
