import{j as a}from"./query-vendor-DAETOSEH.js";import{r as u}from"./react-vendor-CGr-4ZyM.js";import{D as x}from"./download-Bat12fqC.js";function f(){const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`}function m(e,t){const o=URL.createObjectURL(e),n=document.createElement("a");n.href=o,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(o)}function b(e){if(e==null)return"";let t=String(e);return/^[=+\-@\t\r]/.test(t)&&(t="	"+t),t.includes(",")||t.includes('"')||t.includes(`
`)||t.includes("	")?`"${t.replace(/"/g,'""')}"`:t}function h(e){const{page:t,columns:o,data:n}=e;if(n.length===0)return;const r=o||Object.keys(n[0]),s=n.map(d=>r.map(l=>b(d[l])).join(",")),c="\uFEFF"+[r.join(","),...s].join(`\r
`),p=new Blob([c],{type:"text/csv;charset=utf-8"});m(p,`ccwap-${t}-${f()}.csv`)}function g(e){const{page:t,data:o,metadata:n}=e,r={exported_at:new Date().toISOString(),source:"CCWAP Dashboard",page:t,record_count:o.length,...n,data:o},s=JSON.stringify(r,null,2),c=new Blob([s],{type:"application/json"});m(c,`ccwap-${t}-${f()}.json`)}function j(){return{exportData:u.useCallback((t,o)=>{t==="csv"?h(o):g(o)},[])}}function S({page:e,getData:t,columns:o,metadata:n}){const[r,s]=u.useState(!1),c=u.useRef(null),{exportData:p}=j();u.useEffect(()=>{function l(i){c.current&&!c.current.contains(i.target)&&s(!1)}if(r)return document.addEventListener("mousedown",l),()=>document.removeEventListener("mousedown",l)},[r]);function d(l){const i=t();i.length!==0&&(p(l,{page:e,data:i,columns:o,metadata:n}),s(!1))}return a.jsxs("div",{ref:c,className:"relative",children:[a.jsxs("button",{onClick:()=>s(!r),className:"flex items-center gap-1.5 px-3 py-1.5 text-sm rounded-md border border-border hover:bg-accent/50 transition-colors text-muted-foreground hover:text-foreground",title:"Export data",children:[a.jsx(x,{className:"h-3.5 w-3.5"}),a.jsx("span",{children:"Export"})]}),r&&a.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-card border border-border rounded-md shadow-lg z-50 min-w-[140px]",children:[a.jsx("button",{onClick:()=>d("csv"),className:"w-full text-left px-3 py-2 text-sm hover:bg-accent/50 transition-colors rounded-t-md",children:"Export CSV"}),a.jsx("button",{onClick:()=>d("json"),className:"w-full text-left px-3 py-2 text-sm hover:bg-accent/50 transition-colors rounded-b-md",children:"Export JSON"})]})]})}export{S as E};
