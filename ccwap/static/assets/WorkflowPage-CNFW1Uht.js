import{u as L,j as e}from"./query-vendor-DAETOSEH.js";import{r as S,b as O}from"./react-vendor-CGr-4ZyM.js";import{P as $}from"./PageLayout-DEtLmFLB.js";import{w as R,g as E,h as K,a as v,u as G,L as D,f as y,b as F}from"./index-DZMFuYgm.js";import{E as H}from"./ErrorState-xqkb_4mP.js";import{M as u}from"./MetricCard-BoawkqIY.js";import{C as p}from"./ChartCard-Cn7QorEQ.js";import{C as W}from"./chevron-down-CG6zLN1w.js";import{C as I}from"./chevron-right-DICnz5OL.js";import{f as M,C as n,T as C}from"./chartConfig-CHOlO3Nn.js";import{b as _,P as Y,f as q,C as z,T as w,L as k,A as Q,X,Y as B,d as b}from"./chart-vendor-Df4oWUqu.js";function U(t){return L({queryKey:R.data(t),queryFn:()=>E(`/workflows${K({from:t.from,to:t.to})}`)})}function T({node:t,depth:o=0}){const[d,x]=S.useState(o===0),m=O(),i=t.children.length>0,h=t.user_type==="agent";return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 py-1.5 px-2 rounded hover:bg-accent/50 text-sm cursor-pointer",style:{paddingLeft:`${o*20+8}px`},onClick:()=>i?x(!d):m(`/sessions/${t.session_id}`),children:[i?e.jsx("button",{onClick:l=>{l.stopPropagation(),x(!d)},className:"p-0.5",children:d?e.jsx(W,{className:"h-3 w-3"}):e.jsx(I,{className:"h-3 w-3"})}):e.jsx("span",{className:"w-4"}),h&&e.jsx("span",{className:"px-1.5 py-0.5 text-[10px] font-medium bg-purple-500/20 text-purple-400 rounded",children:"agent"}),e.jsxs("span",{className:"text-xs font-mono text-muted-foreground hover:text-foreground hover:underline",onClick:l=>{l.stopPropagation(),m(`/sessions/${t.session_id}`)},children:[t.session_id.slice(0,8),"..."]}),e.jsx("span",{className:"text-xs truncate",children:t.project_display}),e.jsx("span",{className:"text-xs text-muted-foreground ml-auto",children:v(t.total_cost)})]}),d&&i&&e.jsx("div",{children:t.children.map(l=>e.jsx(T,{node:l,depth:o+1},l.session_id))})]})}function V({trees:t}){return t.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No agent session trees found"}):e.jsx("div",{className:"space-y-1",children:t.map(o=>e.jsx(T,{node:o},o.session_id))})}const Z={human:n[0],agent:n[2]};function ce(){const{dateRange:t}=G(),{data:o,isLoading:d,error:x}=U(t),m=S.useMemo(()=>{if(!o?.user_type_trend)return[];const s={};for(const a of o.user_type_trend)s[a.date]||(s[a.date]={}),s[a.date][a.user_type]=a.sessions;const r=Object.entries(s).map(([a,c])=>({date:a,...c})).sort((a,c)=>a.date.localeCompare(c.date));return M(r,["human","agent"])},[o?.user_type_trend]);if(d)return e.jsx(D,{message:"Loading workflow data..."});if(x)return e.jsx(H,{message:x.message});if(!o)return null;const{user_types:i,agent_trees:h,tool_sequences:l}=o,f=i.reduce((s,r)=>s+r.sessions,0),A=i.reduce((s,r)=>s+r.total_cost,0),g=i.find(s=>s.user_type==="agent"),N=i.find(s=>s.user_type==="human"),P=f>0&&g?g.sessions/f:0,j=i.map(s=>({name:s.user_type,value:s.sessions,color:Z[s.user_type]||n[4]}));return e.jsxs($,{title:"Workflows",subtitle:"Human vs Agent sessions, agent trees, and tool patterns",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(u,{title:"Total Sessions",value:y(f)}),e.jsx(u,{title:"Total Cost",value:v(A)}),e.jsx(u,{title:"Human Sessions",value:y(N?.sessions??0),subtitle:`${v(N?.total_cost??0)} cost`}),e.jsx(u,{title:"Agent Sessions",value:y(g?.sessions??0),subtitle:`${F(P)} of total`})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4 mb-6",children:[e.jsx(p,{title:"Session Breakdown",subtitle:"Human vs Agent",children:j.length>0?e.jsx("div",{className:"h-64",children:e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(Y,{children:[e.jsx(q,{data:j,dataKey:"value",nameKey:"name",innerRadius:50,outerRadius:80,paddingAngle:2,label:({name:s,value:r,percent:a})=>`${s??""}: ${r??0} (${((a??0)*100).toFixed(0)}%)`,children:j.map((s,r)=>e.jsx(z,{fill:s.color},r))}),e.jsx(w,{contentStyle:C}),e.jsx(k,{})]})})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No session data"})}),e.jsx(p,{title:"Session Trend",subtitle:"Stacked by user type over time",children:m.length>0?e.jsx("div",{className:"h-64",children:e.jsx(_,{width:"100%",height:"100%",children:e.jsxs(Q,{data:m,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"humanGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:n[0],stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:n[0],stopOpacity:0})]}),e.jsxs("linearGradient",{id:"agentGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:n[2],stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:n[2],stopOpacity:0})]})]}),e.jsx(X,{dataKey:"date",tick:{fontSize:11},tickFormatter:s=>s.slice(5),stroke:"var(--color-muted-foreground)"}),e.jsx(B,{tick:{fontSize:11},stroke:"var(--color-muted-foreground)",allowDecimals:!1}),e.jsx(w,{contentStyle:C}),e.jsx(k,{}),e.jsx(b,{type:"monotone",dataKey:"human",stackId:"1",stroke:n[0],fill:"url(#humanGrad)",strokeWidth:2,name:"Human"}),e.jsx(b,{type:"monotone",dataKey:"agent",stackId:"1",stroke:n[2],fill:"url(#agentGrad)",strokeWidth:2,name:"Agent"})]})})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No trend data"})})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(p,{title:"Agent Session Trees",subtitle:"Parent-child session hierarchy",children:e.jsx("div",{className:"max-h-96 overflow-y-auto",children:e.jsx(V,{trees:h})})}),e.jsx(p,{title:"Tool Sequences",subtitle:"Most common tool call patterns",children:l.length>0?e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",children:l.map((s,r)=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-xs text-muted-foreground w-6 text-right shrink-0",children:[r+1,"."]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-1 flex-wrap",children:s.sequence.map((a,c)=>e.jsxs("span",{children:[e.jsx("span",{className:"text-xs font-mono bg-accent/50 px-1.5 py-0.5 rounded",children:a}),c<s.sequence.length-1&&e.jsx("span",{className:"text-muted-foreground mx-0.5",children:"â†’"})]},c))}),e.jsxs("div",{className:"mt-1 flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 h-1.5 bg-accent/30 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full rounded-full",style:{width:`${s.pct}%`,backgroundColor:n[1]}})}),e.jsxs("span",{className:"text-xs text-muted-foreground shrink-0",children:[s.count,"x (",s.pct.toFixed(1),"%)"]})]})]})]},r))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No tool sequence data"})})]})]})}export{ce as default};
