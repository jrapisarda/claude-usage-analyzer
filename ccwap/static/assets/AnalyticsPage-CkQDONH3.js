import{u as K,j as e}from"./query-vendor-ChV-W4bE.js";import{P as L}from"./PageLayout-CP8ZAjnu.js";import{M as g,a as n}from"./MetricCardGrid-BMhtdYel.js";import{C as l}from"./ChartContainer-BK_oE6Jh.js";import{E as B}from"./ErrorState-DPtgyu34.js";import{C as I,a as D,b as R,c as V}from"./card-B4TCiekP.js";import{T as Y,a as H,b as k,c as b}from"./tabs-DwWJWSAi.js";import{l as E,h as z,i as F,u as Q,f as s,b as O}from"./index-BNVVTlCA.js";import{T as c,C as i,f as X}from"./chartConfig-CHOlO3Nn.js";import{B as N,X as j,Y as u,T as o,e as _,A as w,b as v,P as G,f as W,C as Z,L as A,i as J,j as U}from"./chart-vendor-CnSh9PGG.js";import"./react-vendor-yhu9f3WU.js";import"./skeleton-D4i8jAoN.js";import"./index-BUO-8FAh.js";import"./index-CR7wKcdR.js";function ee(t){return K({queryKey:E.data(t),queryFn:()=>z(`/analytics${F({from:t.from,to:t.to})}`)})}function te(t){return K({queryKey:E.thinkingTrend(t),queryFn:()=>z(`/analytics/thinking-trend${F({from:t.from,to:t.to})}`)})}function ae(t){return K({queryKey:E.cacheTrend(t),queryFn:()=>z(`/analytics/cache-trend${F({from:t.from,to:t.to})}`)})}function pe(){const{dateRange:t}=Q(),{data:d,isLoading:r,error:h}=ee(t),{data:T}=te(t),{data:S}=ae(t);if(h)return e.jsx(B,{message:h.message});if(r||!d)return e.jsx(L,{title:"Deep Analytics",subtitle:"Advanced metrics and analysis",children:e.jsx(g,{skeleton:!0,count:4,className:"mb-6"})});const{thinking:m,truncation:p,sidechains:f,cache_tiers:C,branches:M,versions:$,skills_agents:x}=d;return e.jsx(L,{title:"Deep Analytics",subtitle:"Advanced metrics and analysis",children:e.jsxs(Y,{defaultValue:"thinking",className:"space-y-6",children:[e.jsxs(H,{children:[e.jsx(k,{value:"thinking",children:"Thinking"}),e.jsx(k,{value:"cache",children:"Cache"}),e.jsx(k,{value:"sidechains",children:"Sidechains"}),e.jsx(k,{value:"branches",children:"Branches & Versions"})]}),e.jsxs(b,{value:"thinking",className:"space-y-6",children:[e.jsxs(g,{children:[e.jsx(n,{title:"Total Thinking",value:s(m.total_thinking_chars),subtitle:"characters"}),e.jsx(n,{title:"Avg / Turn",value:s(m.avg_thinking_per_turn)}),e.jsx(n,{title:"Turns w/ Thinking",value:s(m.turns_with_thinking)}),e.jsx(n,{title:"Thinking Rate",value:O(m.thinking_rate)})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(l,{title:"Thinking by Model",height:256,isEmpty:m.by_model.length===0,emptyMessage:"No thinking data",children:e.jsxs(N,{data:m.by_model,layout:"vertical",margin:{left:80},children:[e.jsx(j,{type:"number",tick:{fontSize:10},tickFormatter:s}),e.jsx(u,{type:"category",dataKey:"model",tick:{fontSize:10},width:75}),e.jsx(o,{contentStyle:c,formatter:a=>s(a??0)}),e.jsx(_,{dataKey:"thinking_chars",fill:i[0],name:"Thinking Chars",radius:[0,4,4,0]})]})}),e.jsx(l,{title:"Thinking Trend",height:288,isEmpty:!T||T.length===0,emptyMessage:"No trend data",children:e.jsxs(w,{data:se(T??[]),children:[e.jsx(j,{dataKey:"date",tick:{fontSize:10}}),e.jsx(u,{tick:{fontSize:10},tickFormatter:s}),e.jsx(o,{contentStyle:c,formatter:a=>s(a??0)}),e.jsx(v,{type:"monotone",dataKey:"thinking_chars",stroke:i[0],fill:i[0],fillOpacity:.2})]})})]}),e.jsx(l,{title:`Truncation Analysis (${p.total_turns} total turns)`,height:256,isEmpty:p.by_stop_reason.length===0,emptyMessage:"No truncation data",children:e.jsxs(G,{children:[e.jsx(W,{data:p.by_stop_reason,dataKey:"count",nameKey:"stop_reason",innerRadius:50,outerRadius:80,paddingAngle:2,label:({name:a,percent:y})=>`${a??""} ${((y??0)*100).toFixed(0)}%`,children:p.by_stop_reason.map((a,y)=>e.jsx(Z,{fill:i[y%i.length]},y))}),e.jsx(o,{contentStyle:c}),e.jsx(A,{})]})})]}),e.jsxs(b,{value:"cache",className:"space-y-6",children:[e.jsxs(g,{className:"lg:grid-cols-3",children:[e.jsx(n,{title:"Ephemeral 5m",value:s(C.ephemeral_5m_tokens),subtitle:"tokens"}),e.jsx(n,{title:"Ephemeral 1h",value:s(C.ephemeral_1h_tokens),subtitle:"tokens"}),e.jsx(n,{title:"Standard Cache",value:s(C.standard_cache_tokens),subtitle:"tokens"})]}),e.jsx(l,{title:"Cache Tier Trend",height:256,isEmpty:!S||S.length===0,emptyMessage:"No cache trend data",children:e.jsxs(w,{data:X(S??[],["ephemeral_5m","ephemeral_1h","standard_cache"]),children:[e.jsx(j,{dataKey:"date",tick:{fontSize:10}}),e.jsx(u,{tick:{fontSize:10},tickFormatter:s}),e.jsx(o,{contentStyle:c,formatter:a=>s(a??0)}),e.jsx(v,{type:"monotone",dataKey:"ephemeral_5m",stackId:"1",stroke:i[0],fill:i[0],fillOpacity:.6,name:"5min Ephemeral"}),e.jsx(v,{type:"monotone",dataKey:"ephemeral_1h",stackId:"1",stroke:i[1],fill:i[1],fillOpacity:.6,name:"1hr Ephemeral"}),e.jsx(v,{type:"monotone",dataKey:"standard_cache",stackId:"1",stroke:i[2],fill:i[2],fillOpacity:.6,name:"Standard Cache"}),e.jsx(A,{})]})})]}),e.jsxs(b,{value:"sidechains",className:"space-y-6",children:[e.jsxs(g,{className:"lg:grid-cols-2",children:[e.jsx(n,{title:"Total Sidechains",value:s(f.total_sidechains)}),e.jsx(n,{title:"Sidechain Rate",value:O(f.sidechain_rate)})]}),e.jsx(l,{title:"Sidechains by Project",height:256,isEmpty:f.by_project.length===0,emptyMessage:"No sidechain data",children:e.jsxs(N,{data:f.by_project.slice(0,10),children:[e.jsx(j,{dataKey:"project",tick:{fontSize:9},interval:0,angle:-20,textAnchor:"end",height:50}),e.jsx(u,{tick:{fontSize:10}}),e.jsx(o,{contentStyle:c}),e.jsx(_,{dataKey:"sidechain_count",fill:i[3],name:"Sidechains",radius:[4,4,0,0]})]})}),e.jsxs(g,{className:"lg:grid-cols-3",children:[e.jsx(n,{title:"Agent Spawns",value:s(x.total_agent_spawns)}),e.jsx(n,{title:"Skill Invocations",value:s(x.total_skill_invocations)}),e.jsx(n,{title:"Agent Cost",value:`$${x.agent_cost.toFixed(4)}`})]}),e.jsxs(I,{children:[e.jsx(D,{className:"pb-3",children:e.jsx(R,{className:"text-sm font-medium text-muted-foreground",children:"Skills & Agents by Date"})}),e.jsx(V,{children:x.by_date.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-xs",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b border-border",children:Object.keys(x.by_date[0]).map(a=>e.jsx("th",{className:"text-left px-3 py-2 font-medium text-muted-foreground",children:a},a))})}),e.jsx("tbody",{children:x.by_date.slice(0,20).map((a,y)=>e.jsx("tr",{className:"border-b border-border hover:bg-accent/10",children:Object.values(a).map((P,q)=>e.jsx("td",{className:"px-3 py-2 font-mono",children:String(P??"")},q))},y))})]})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No skills data"})})]})]}),e.jsx(b,{value:"branches",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsx(l,{title:"Branch Analytics",height:256,isEmpty:M.branches.length===0,emptyMessage:"No branch data",children:e.jsxs(N,{data:M.branches.slice(0,10),layout:"vertical",margin:{left:80},children:[e.jsx(j,{type:"number",tick:{fontSize:10}}),e.jsx(u,{type:"category",dataKey:"branch",tick:{fontSize:10},width:75}),e.jsx(o,{contentStyle:c}),e.jsx(_,{dataKey:"cost",fill:i[0],name:"Cost",radius:[0,4,4,0]}),e.jsx(_,{dataKey:"sessions",fill:i[1],name:"Sessions",radius:[0,4,4,0]}),e.jsx(A,{})]})}),e.jsx(l,{title:"CC Version Impact",height:256,isEmpty:$.versions.length===0,emptyMessage:"No version data",children:e.jsxs(J,{data:$.versions,children:[e.jsx(j,{dataKey:"version",tick:{fontSize:9},interval:0,angle:-20,textAnchor:"end",height:50}),e.jsx(u,{tick:{fontSize:10},tickFormatter:a=>`$${(a??0).toFixed(3)}`}),e.jsx(o,{contentStyle:c,formatter:a=>`$${(a??0).toFixed(4)}`}),e.jsx(U,{type:"monotone",dataKey:"avg_turn_cost",stroke:i[4],strokeWidth:2,dot:{r:3},name:"Avg Turn Cost"})]})})]})})]})})}function se(t){const d=new Map;for(const r of t)d.set(r.date,(d.get(r.date)||0)+r.thinking_chars);return Array.from(d,([r,h])=>({date:r,thinking_chars:h})).sort((r,h)=>r.date.localeCompare(h.date))}export{pe as default};
