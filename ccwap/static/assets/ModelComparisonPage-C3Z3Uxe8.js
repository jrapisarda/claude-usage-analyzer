import{u as G,j as e}from"./query-vendor-DAETOSEH.js";import{r as c}from"./react-vendor-CGr-4ZyM.js";import{o as Y,g as H,h as I,u as U,L as X,f as u,a as v}from"./index-DZMFuYgm.js";import{P as Z}from"./PageLayout-DEtLmFLB.js";import{M as _}from"./MetricCard-BoawkqIY.js";import{C as M}from"./ChartCard-Cn7QorEQ.js";import{E as Q}from"./ErrorState-xqkb_4mP.js";import{f as W,A as h,C as n,T as w}from"./chartConfig-CHOlO3Nn.js";import{b as N,l as B,m as J,n as V,o as ee,p as te,L as A,T as L,S as se,X as P,Y as $,Z as oe,q as re,A as ae,d as ne}from"./chart-vendor-Df4oWUqu.js";function ie(d){return G({queryKey:Y.data(d),queryFn:()=>H(`/models${I({from:d.from,to:d.to})}`)})}const le=[{key:"model",label:"Model",align:"left"},{key:"sessions",label:"Sessions",align:"right"},{key:"turns",label:"Turns",align:"right"},{key:"total_cost",label:"Cost",align:"right"},{key:"avg_turn_cost",label:"Avg Turn Cost",align:"right"},{key:"loc_written",label:"LOC",align:"right"}];function g(d,o,f){const x=[...d];return x.sort((m,C)=>{const i=m[o],l=C[o];return typeof i=="string"&&typeof l=="string"?f==="asc"?i.localeCompare(l):l.localeCompare(i):f==="asc"?i-l:l-i}),x}function ye(){const{dateRange:d}=U(),{data:o,isLoading:f,error:x}=ie(d),[m,C]=c.useState("total_cost"),[i,l]=c.useState("desc"),j=c.useMemo(()=>o?g(o.models,m,i):[],[o,m,i]),T=c.useMemo(()=>{if(!o||o.models.length===0)return[];const t=g(o.models,"sessions","desc").slice(0,4);return[{axis:"Sessions",getter:r=>r.sessions,invert:!1},{axis:"Cost",getter:r=>r.total_cost,invert:!0},{axis:"Tokens",getter:r=>r.total_input_tokens+r.total_output_tokens,invert:!1},{axis:"Thinking",getter:r=>r.avg_thinking_chars,invert:!1},{axis:"LOC",getter:r=>r.loc_written,invert:!1}].map(r=>{const a=t.map(b=>r.getter(b)),y=Math.min(...a),E=Math.max(...a)-y,R={axis:r.axis};for(const b of t){const q=r.getter(b),K=E===0?50:(q-y)/E*100;R[b.model]=Math.round(r.invert?100-K:K)}return R})},[o]),O=c.useMemo(()=>o?g(o.models,"sessions","desc").slice(0,4).map(t=>t.model):[],[o]),p=c.useMemo(()=>{if(!o)return{points:[],models:[]};const t=[...new Set(o.usage_trend.map(a=>a.model))],s=new Map;for(const a of o.usage_trend)s.has(a.date)||s.set(a.date,{date:a.date}),s.get(a.date)[a.model]=a.count;return{points:W([...s.values()].sort((a,y)=>a.date.localeCompare(y.date)),t),models:t}},[o]),D=c.useMemo(()=>{if(!o)return new Map;const t=new Map;for(const s of o.scatter)t.has(s.model)||t.set(s.model,[]),t.get(s.model).push({cost:s.cost,loc_written:s.loc_written});return t},[o]);function z(t){t===m?l(s=>s==="asc"?"desc":"asc"):(C(t),l("desc"))}if(f)return e.jsx(X,{message:"Loading model comparison..."});if(x)return e.jsx(Q,{message:x.message});if(!o)return null;const F=o.models.length,k=j.length>0?g(o.models,"sessions","desc")[0]:null,S=j.length>0?g(o.models,"total_cost","desc")[0]:null;return e.jsxs(Z,{title:"Model Comparison",subtitle:"Compare performance and cost across models",children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:[e.jsx(_,{title:"Total Models",value:String(F)}),e.jsx(_,{title:"Most Used",value:k?.model||"N/A",subtitle:k?`${u(k.sessions)} sessions`:void 0}),e.jsx(_,{title:"Highest Cost",value:S?.model||"N/A",subtitle:S?v(S.total_cost):void 0})]}),j.length>0&&e.jsx("div",{className:"rounded-lg border border-border overflow-hidden mb-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-muted/50 border-b border-border",children:le.map(t=>e.jsxs("th",{onClick:()=>z(t.key),className:`px-4 py-3 font-medium text-muted-foreground cursor-pointer hover:text-foreground select-none ${t.align==="right"?"text-right":"text-left"}`,children:[t.label,m===t.key&&e.jsx("span",{className:"ml-1",children:i==="asc"?"▲":"▼"})]},t.key))})}),e.jsx("tbody",{children:j.map(t=>e.jsxs("tr",{className:"border-b border-border hover:bg-accent/10",children:[e.jsx("td",{className:"px-4 py-3 font-medium truncate max-w-[200px]",children:t.model}),e.jsx("td",{className:"px-4 py-3 font-mono text-right",children:u(t.sessions)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right",children:u(t.turns)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right",children:v(t.total_cost)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right",children:v(t.avg_turn_cost)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right",children:u(t.loc_written)})]},t.model))})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[T.length>0&&O.length>0&&e.jsx(M,{title:"Model Comparison (Top 4)",subtitle:"Normalized metrics (0-100)",children:e.jsx("div",{className:"h-72",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(B,{data:T,children:[e.jsx(J,{stroke:"var(--color-border)"}),e.jsx(V,{dataKey:"axis",tick:h}),e.jsx(ee,{tick:!1,domain:[0,100],axisLine:!1}),O.map((t,s)=>e.jsx(te,{name:t,dataKey:t,stroke:n[s%n.length],fill:n[s%n.length],fillOpacity:.15,strokeWidth:2},t)),e.jsx(A,{wrapperStyle:{fontSize:"11px"}}),e.jsx(L,{contentStyle:w})]})})})}),D.size>0&&e.jsx(M,{title:"Cost vs LOC per Session",subtitle:"Each point is a session",children:e.jsx("div",{className:"h-72",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(se,{children:[e.jsx(P,{type:"number",dataKey:"cost",name:"Cost",tick:h,tickFormatter:t=>`$${t}`,stroke:"var(--color-muted-foreground)"}),e.jsx($,{type:"number",dataKey:"loc_written",name:"LOC",tick:h,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(oe,{range:[30,30]}),e.jsx(L,{contentStyle:w,formatter:(t,s)=>[s==="Cost"?v(t??0):u(t??0),s??""]}),e.jsx(A,{wrapperStyle:{fontSize:"11px"}}),[...D.entries()].map(([t,s],r)=>e.jsx(re,{name:t,data:s,fill:n[r%n.length],opacity:.7},t))]})})})})]}),p.points.length>0&&e.jsx(M,{title:"Model Usage Over Time",subtitle:"Sessions per day by model",children:e.jsx("div",{className:"h-72",children:e.jsx(N,{width:"100%",height:"100%",children:e.jsxs(ae,{data:p.points,children:[e.jsx("defs",{children:p.models.map((t,s)=>e.jsxs("linearGradient",{id:`modelGrad-${s}`,x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:n[s%n.length],stopOpacity:.4}),e.jsx("stop",{offset:"95%",stopColor:n[s%n.length],stopOpacity:.05})]},t))}),e.jsx(P,{dataKey:"date",tick:h,tickFormatter:t=>t.slice(5),stroke:"var(--color-muted-foreground)"}),e.jsx($,{tick:h,stroke:"var(--color-muted-foreground)",width:40}),e.jsx(L,{contentStyle:w}),e.jsx(A,{wrapperStyle:{fontSize:"11px"}}),p.models.map((t,s)=>e.jsx(ne,{type:"monotone",dataKey:t,stackId:"1",stroke:n[s%n.length],fill:`url(#modelGrad-${s})`,strokeWidth:1.5,isAnimationActive:p.points.length<365},t))]})})})})]})}export{ye as default};
