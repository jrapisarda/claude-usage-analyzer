import{u as v,j as e}from"./query-vendor-DAETOSEH.js";import{r as D}from"./react-vendor-CGr-4ZyM.js";import{P as H}from"./PageLayout-DEtLmFLB.js";import{p as b,g as N,h as _,u as I,L as Q,f as n,a as G,b as u}from"./index-DZMFuYgm.js";import{E as X}from"./ErrorState-xqkb_4mP.js";import{M as S}from"./MetricCard-BoawkqIY.js";import{E as Z}from"./ExportDropdown-B2A0w648.js";import{f as B,C as a,T as z}from"./chartConfig-CHOlO3Nn.js";import{b as h,A as M,X as g,Y as j,T as y,d as F,B as J,e as U,i as R,j as Y,k as V}from"./chart-vendor-Df4oWUqu.js";import"./download-Bat12fqC.js";function ee(r){return v({queryKey:b.data(r),queryFn:()=>N(`/productivity${_({from:r.from,to:r.to})}`)})}function te(r){return v({queryKey:b.efficiencyTrend(r),queryFn:()=>N(`/productivity/efficiency-trend${_({from:r.from,to:r.to})}`)})}function re(r){return v({queryKey:b.languageTrend(r),queryFn:()=>N(`/productivity/language-trend${_({from:r.from,to:r.to})}`)})}function oe(r){return v({queryKey:b.toolSuccessTrend(r),queryFn:()=>N(`/productivity/tool-success-trend${_({from:r.from,to:r.to})}`)})}function se(r){return v({queryKey:b.fileChurn(r),queryFn:()=>N(`/productivity/file-churn${_({from:r.from,to:r.to})}`)})}function ae({x:r,y:i,width:f,height:x,name:l,size:c}){if(f<40||x<30)return null;const m=l?.length>20?"..."+l.slice(-17):l;return e.jsxs("g",{children:[e.jsx("text",{x:r+f/2,y:i+x/2-6,textAnchor:"middle",fill:"var(--color-card-foreground)",fontSize:11,dominantBaseline:"central",children:m??""}),e.jsxs("text",{x:r+f/2,y:i+x/2+10,textAnchor:"middle",fill:"var(--color-muted-foreground)",fontSize:10,dominantBaseline:"central",children:[c??0," edits"]})]})}function pe(){const{dateRange:r}=I(),{data:i,isLoading:f,error:x}=ee(r),{data:l}=te(r),{data:c}=re(r),{data:m}=oe(r),{data:k}=se(r),{pivotedLangData:T,langKeys:E}=D.useMemo(()=>{if(!c||c.length===0)return{pivotedLangData:[],langKeys:[]};const t=[...new Set(c.map(d=>d.language))],o={};for(const d of c)o[d.date]||(o[d.date]={date:d.date}),o[d.date][d.language]=d.loc_written;return{pivotedLangData:B(Object.values(o).sort((d,s)=>d.date.localeCompare(s.date)),t),langKeys:t}},[c]),{pivotedToolData:O,toolKeys:q}=D.useMemo(()=>{if(!m||m.length===0)return{pivotedToolData:[],toolKeys:[]};const t={};for(const s of m)t[s.tool_name]=(t[s.tool_name]??0)+s.total;const o=Object.entries(t).sort((s,A)=>A[1]-s[1]).slice(0,5).map(([s])=>s),p={};for(const s of m)o.includes(s.tool_name)&&(p[s.date]||(p[s.date]={date:s.date}),p[s.date][s.tool_name]=s.success_rate);return{pivotedToolData:B(Object.values(p).sort((s,A)=>s.date.localeCompare(A.date)),o),toolKeys:o}},[m]),K=D.useMemo(()=>!k||k.length===0?[]:k.slice(0,50).map((t,o)=>({name:t.file_path.split("/").pop()||t.file_path,size:t.edit_count,fill:a[o%a.length]})),[k]);if(f)return e.jsx(Q,{message:"Loading productivity data..."});if(x)return e.jsx(X,{message:x.message});if(!i)return null;const{summary:C,loc_trend:w,languages:P,tool_usage:W,error_analysis:L,file_hotspots:$}=i;return e.jsxs(H,{title:"Productivity",subtitle:"LOC trends, tool usage, and error analysis",actions:e.jsx(Z,{page:"productivity",getData:()=>[...(i?.loc_trend||[]).map(t=>({date:t.date,loc_written:t.loc_written,loc_delivered:t.loc_delivered})),...(i?.tool_usage||[]).map(t=>({type:"tool",tool_name:t.tool_name,total_calls:t.total_calls,success_rate:t.success_rate}))]}),children:[e.jsxs("div",{className:"grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsx(S,{title:"LOC Written",value:n(C.total_loc_written)}),e.jsx(S,{title:"LOC Delivered",value:n(C.total_loc_delivered)}),e.jsx(S,{title:"Cost/kLOC",value:G(C.cost_per_kloc)}),e.jsx(S,{title:"Error Rate",value:u(C.error_rate)})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[w.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"LOC Trend"}),e.jsx("div",{className:"h-64",children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(M,{data:w,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"locGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-2)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-2)",stopOpacity:0})]}),e.jsxs("linearGradient",{id:"locDeliveredGrad",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"var(--color-chart-3)",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"var(--color-chart-3)",stopOpacity:0})]})]}),e.jsx(g,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t.slice(5),stroke:"var(--color-muted-foreground)"}),e.jsx(j,{tick:{fontSize:11},stroke:"var(--color-muted-foreground)",width:50}),e.jsx(y,{contentStyle:{backgroundColor:"var(--color-card)",color:"var(--color-card-foreground)",border:"1px solid var(--color-border)",borderRadius:"6px"}}),e.jsx(F,{type:"monotone",dataKey:"loc_written",stroke:"var(--color-chart-2)",fill:"url(#locGrad)",strokeWidth:2,name:"LOC Written",isAnimationActive:w.length<365}),e.jsx(F,{type:"monotone",dataKey:"loc_delivered",stroke:"var(--color-chart-3)",fill:"url(#locDeliveredGrad)",strokeWidth:2,name:"LOC Delivered",isAnimationActive:w.length<365})]})})})]}),P.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Languages"}),e.jsx("div",{className:"h-64",children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(J,{data:P.slice(0,10),layout:"vertical",children:[e.jsx(g,{type:"number",tick:{fontSize:11},stroke:"var(--color-muted-foreground)"}),e.jsx(j,{type:"category",dataKey:"language",tick:{fontSize:10},width:80,stroke:"var(--color-muted-foreground)"}),e.jsx(y,{contentStyle:{backgroundColor:"var(--color-card)",color:"var(--color-card-foreground)",border:"1px solid var(--color-border)",borderRadius:"6px",fontSize:"12px"}}),e.jsx(U,{dataKey:"loc_written",fill:"var(--color-chart-3)",radius:[0,4,4,0],name:"LOC"})]})})})]})]}),W.length>0&&e.jsx("div",{className:"rounded-lg border border-border overflow-hidden mb-6",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50 border-b border-border",children:[e.jsx("th",{className:"text-left px-4 py-3 font-medium text-muted-foreground",children:"Tool"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-muted-foreground",children:"Calls"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-muted-foreground",children:"Success"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-muted-foreground",children:"Errors"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-muted-foreground",children:"Success Rate"}),e.jsx("th",{className:"text-right px-4 py-3 font-medium text-muted-foreground",children:"LOC"})]})}),e.jsx("tbody",{children:W.map(t=>e.jsxs("tr",{className:"border-b border-border hover:bg-accent/10",children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:t.tool_name}),e.jsx("td",{className:"px-4 py-3 font-mono text-right",children:n(t.total_calls)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right",children:n(t.success_count)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right",children:t.error_count>0?e.jsx("span",{className:"text-red-400",children:n(t.error_count)}):"0"}),e.jsx("td",{className:"px-4 py-3 font-mono text-right",children:u(t.success_rate)}),e.jsx("td",{className:"px-4 py-3 font-mono text-right",children:n(t.loc_written)})]},t.tool_name))})]})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Error Analysis"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Errors"}),e.jsx("p",{className:"font-mono text-lg",children:n(L.total_errors)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Error Rate"}),e.jsx("p",{className:"font-mono text-lg",children:u(L.error_rate)})]})]}),L.categories.length>0&&e.jsx("div",{className:"space-y-2",children:L.categories.map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"truncate",children:t.category}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("span",{className:"font-mono",children:n(t.count)}),e.jsx("span",{className:"text-xs text-muted-foreground w-12 text-right",children:u(t.percentage)})]})]},t.category))})]}),$.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"File Hotspots"}),e.jsx("div",{className:"space-y-2",children:$.slice(0,15).map(t=>e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"truncate font-mono text-xs flex-1 min-w-0",children:t.file_path}),e.jsxs("div",{className:"flex items-center gap-2 shrink-0 ml-2",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[t.total_touches," touches"]}),e.jsxs("span",{className:"font-mono text-xs",children:[n(t.loc_written)," LOC"]})]})]},t.file_path))})]})]}),l&&l.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"LOC Efficiency Trend"}),e.jsx("div",{className:"h-64",children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(R,{data:l,children:[e.jsx(g,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(j,{tick:{fontSize:11},tickFormatter:t=>`$${t??0}`,stroke:"var(--color-muted-foreground)",width:50}),e.jsx(y,{contentStyle:z,formatter:t=>[G(t??0),"Cost/kLOC"]}),e.jsx(Y,{type:"monotone",dataKey:"cost_per_kloc",stroke:"var(--color-chart-1)",strokeWidth:2,dot:!1,name:"Cost/kLOC",isAnimationActive:l.length<365})]})})})]}),T.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Language Trend"}),e.jsx("div",{className:"h-64",children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(M,{data:T,children:[e.jsx(g,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(j,{tick:{fontSize:11},stroke:"var(--color-muted-foreground)",width:50}),e.jsx(y,{contentStyle:z,formatter:(t,o)=>[n(t??0),o??""]}),E.map((t,o)=>e.jsx(F,{type:"monotone",dataKey:t,stackId:"lang",stroke:a[o%a.length],fill:a[o%a.length],fillOpacity:.6,strokeWidth:1,isAnimationActive:T.length<365},t))]})})}),e.jsx("div",{className:"flex flex-wrap gap-3 mt-2",children:E.map((t,o)=>e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:a[o%a.length]}}),t]},t))})]}),O.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Tool Success Rate Trend"}),e.jsx("div",{className:"h-64",children:e.jsx(h,{width:"100%",height:"100%",children:e.jsxs(R,{data:O,children:[e.jsx(g,{dataKey:"date",tick:{fontSize:11},tickFormatter:t=>t?.slice(5)??"",stroke:"var(--color-muted-foreground)"}),e.jsx(j,{tick:{fontSize:11},tickFormatter:t=>u(t??0),stroke:"var(--color-muted-foreground)",width:50,domain:[0,1]}),e.jsx(y,{contentStyle:z,formatter:(t,o)=>[u(t??0),o??""]}),q.map((t,o)=>e.jsx(Y,{type:"monotone",dataKey:t,stroke:a[o%a.length],strokeWidth:2,dot:!1,name:t,isAnimationActive:O.length<365},t))]})})}),e.jsx("div",{className:"flex flex-wrap gap-3 mt-2",children:q.map((t,o)=>e.jsxs("span",{className:"text-xs flex items-center gap-1",children:[e.jsx("span",{className:"w-2 h-2 rounded-full",style:{backgroundColor:a[o%a.length]}}),t]},t))})]}),K.length>0&&e.jsxs("div",{className:"rounded-lg border border-border bg-card p-4 mb-6",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"File Churn"}),e.jsx("div",{className:"h-80",children:e.jsx(h,{width:"100%",height:"100%",children:e.jsx(V,{data:K,dataKey:"size",aspectRatio:4/3,stroke:"var(--color-border)",content:e.jsx(ae,{})})})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-2",children:["Showing top ",K.length," files by edit count"]})]})]})}export{pe as default};
